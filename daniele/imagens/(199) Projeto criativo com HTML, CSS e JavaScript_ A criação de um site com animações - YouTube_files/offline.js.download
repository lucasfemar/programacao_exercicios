(function(g){var window=this;'use strict';var qpu=function(f){var I=new g.SL("und",new g.B5("Default","und",!0));I.captionTracks=f.captionTracks;return I},jmk=function(f){return new g.Kd(function(I,G){var c=f.length,P=[];
if(c)for(var p=function(H,x){c--;P[H]=x;c==0&&I(P)},e=function(H){G(H)},O,N=0;N<f.length;N++)O=f[N],g.ss7(O,g.e2(p,N),e);
else I(P)})},Zj=function(f){this.U=f},gJ=function(){Zj.apply(this,arguments)},KtZ=function(){gJ.apply(this,arguments)},JgJ=function(){gJ.apply(this,arguments)},UXw=function(){gJ.apply(this,arguments)},zTL=function(){gJ.apply(this,arguments)},hTy=function(){gJ.apply(this,arguments)},Mgw=function(){gJ.apply(this,arguments)},DX7=function(){Zj.apply(this,arguments)},Ftk=function(){gJ.apply(this,arguments)},ZXk=function(){gJ.apply(this,arguments)},g62=function(){gJ.apply(this,arguments)},RTk=function(){gJ.apply(this,
arguments)},Vgr=function(){gJ.apply(this,arguments)},rg2=function(){gJ.apply(this,arguments)},v6y=function(){gJ.apply(this,arguments)},dXw=function(){gJ.apply(this,arguments)},ygJ=function(){gJ.apply(this,arguments)},Agu=function(){gJ.apply(this,arguments)},Tnr=function(){gJ.apply(this,arguments)},n6k=function(){gJ.apply(this,arguments)},smZ=function(){Zj.apply(this,arguments)},Xd7=function(){gJ.apply(this,arguments)},E6L=function(){gJ.apply(this,arguments)},mXV=function(){gJ.apply(this,arguments)},
CkZ=function(){gJ.apply(this,arguments)},Qmw=function(){gJ.apply(this,arguments)},bXU=function(){gJ.apply(this,arguments)},fTU=function(){gJ.apply(this,arguments)},ITU=function(){gJ.apply(this,arguments)},GJr=function(){gJ.apply(this,arguments)},c8y=function(){Zj.apply(this,arguments)},PHL=function(){Zj.apply(this,arguments)},pK$=function(){Zj.apply(this,arguments)},e6r=function(){gJ.apply(this,arguments)},tqU=function(){gJ.apply(this,arguments)},ON2=function(){gJ.apply(this,arguments)},NHu=function(){gJ.apply(this,
arguments)},HNw=function(){gJ.apply(this,arguments)},xkU=function(){gJ.apply(this,arguments)},iNZ=function(){gJ.apply(this,arguments)},Sqw=function(){gJ.apply(this,arguments)},ucu=function(){gJ.apply(this,arguments)},aT7=function(){gJ.apply(this,arguments)},kJr=function(){gJ.apply(this,arguments)},lTL=function(){gJ.apply(this,arguments)},wKL=function(){gJ.apply(this,arguments)},$kV=function(){gJ.apply(this,arguments)},YqL=function(){gJ.apply(this,arguments)},BHk=function(){gJ.apply(this,arguments)},
LfZ=function(){gJ.apply(this,arguments)},Wfy=function(){gJ.apply(this,arguments)},ohV=function(){gJ.apply(this,arguments)},qqw=function(){gJ.apply(this,arguments)},jeZ=function(){gJ.apply(this,arguments)},Kfw=function(){gJ.apply(this,arguments)},J8L=function(){gJ.apply(this,arguments)},Uk$=function(){gJ.apply(this,arguments)},z6J=function(){gJ.apply(this,arguments)},h6Z=function(){gJ.apply(this,arguments)},Mqw=function(){Zj.apply(this,arguments)},Dkw=function(){gJ.apply(this,arguments)},Ffu=function(){gJ.apply(this,
arguments)},ZN2=function(){gJ.apply(this,arguments)},ghw=function(){gJ.apply(this,arguments)},R6Z=function(){gJ.apply(this,arguments)},Vqw=function(){gJ.apply(this,arguments)},r8U=function(){gJ.apply(this,arguments)},vhV=function(){gJ.apply(this,arguments)},dkU=function(){gJ.apply(this,arguments)},y8J=function(){gJ.apply(this,arguments)},A82=function(){gJ.apply(this,arguments)},THE=function(){gJ.apply(this,arguments)},nh2=function(){gJ.apply(this,arguments)},seE=function(){gJ.apply(this,arguments)},
XK7=function(){gJ.apply(this,arguments)},Ehw=function(){gJ.apply(this,arguments)},mkk=function(){gJ.apply(this,arguments)},CHk=function(){gJ.apply(this,arguments)},Qer=function(){gJ.apply(this,arguments)},bN2=function(){gJ.apply(this,arguments)},fzu=function(){gJ.apply(this,arguments)},IzV=function(){gJ.apply(this,arguments)},GIu=function(){gJ.apply(this,arguments)},cpU=function(){gJ.apply(this,arguments)},PK7=function(){gJ.apply(this,arguments)},pjw=function(){gJ.apply(this,arguments)},eWJ=function(){gJ.apply(this,
arguments)},t9k=function(){gJ.apply(this,arguments)},OdE=function(){gJ.apply(this,arguments)},NxZ=function(){gJ.apply(this,arguments)},HdZ=function(){gJ.apply(this,arguments)},xsk=function(){gJ.apply(this,arguments)},idU=function(f){f=f.key||f.id;
if(!f)throw Error("Entity key is missing");return f},SPw=function(){if(RU)return RU();
var f={};RU=g.Po("PersistentEntityStoreDb",{E9:(f.EntityStore={F6:1},f.EntityAssociationStore={F6:2},f),shared:!1,upgrade:function(I,G){G(1)&&g.rm(g.Dn(I,"EntityStore",{keyPath:"key"}),"entityType","entityType");G(2)&&(I=g.Dn(I,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.rm(I,"byParentEntityKey","parentEntityKey"),g.rm(I,"byChildEntityKey","childEntityKey"))},
version:3});return RU()},usy=function(f){return g.Xv(SPw(),f)},azu=function(f){return g.Xv((0,g.IYL)(),f)},VR=function(f){this.token=f},rJ=function(f,I){I=I===void 0?{}:I;
g.Ct.call(this,g.GAy[f],Object.assign({},{name:"PESEncoderError",type:f},I));this.type=f;this.level="WARNING";Object.setPrototypeOf(this,rJ.prototype)},kIU=function(f){return new rJ("WRONG_DATA_TYPE",{ez:f})},lzV=function(f){return f instanceof Error?new rJ("UNKNOWN_ENCODE_ERROR",{originalMessage:f.message}):new rJ("UNKNOWN_ENCODE_ERROR")},wjw=function(f){return f instanceof Error?new rJ("UNKNOWN_DECODE_ERROR",{originalMessage:f.message}):new rJ("UNKNOWN_DECODE_ERROR")},$su=function(f,I){f=f instanceof
rJ?f:I(f);
g.ry(f);throw f;},YPw=function(){},Bx2=function(f,I,G){try{return f.Z(I,G)}catch(c){$su(c,lzV)}},Lnr=function(f){f=(new TextEncoder).encode(f).subarray(0,16);
var I=new Uint8Array(16);I.set(f);return I},vx=function(f){this.U=f},oFw=function(f){var I=WnJ[f];
if(I)return I;g.vP(new g.Ct("Entity model not found.",{entityType:f}))},qPr=function(f,I){this.U=f;
this.W=I;this.Z={}},KnU=function(f,I){a:{f=jVE(f.W,I.version);
try{var G=f.W(I.data,I.key);break a}catch(c){$su(c,wjw)}G=void 0}return G},dJ=function(f,I,G){return f.U.objectStore("EntityStore").get(I).then(function(c){if(c){if(G&&c.entityType!==G)throw Error("Incorrect entity type");
return KnU(f,c)}})},yR=function(f,I,G){return G?(G=G.map(function(c){return dJ(f,c,I)}),g.JF.all(G)):f.U.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(I)).then(function(c){return c.map(function(P){return KnU(f,P)})})},TQ=function(f,I,G){var c=idU(I),P=jVE(f.W,1),p=Object.assign({},I);
return f.U.objectStore("EntityStore").get(c).then(function(e){if(e){if(e.entityType!==G)throw Error("Incorrect entity type");p.entityMetadata||(e=KnU(f,e),p.entityMetadata=e.entityMetadata)}}).then(function(){var e={key:c,
entityType:G,data:Bx2(P,p,c),version:1};return g.JF.all([g.gm(f.U.objectStore("EntityStore"),e),Jp2(f,p,G)])}).then(function(){AR(f,c,G);
return c})},Usy=function(f,I,G){I=I.map(function(c){return TQ(f,c,G)});
return g.JF.all(I)},n2=function(f,I,G){if(G==null?0:G.Ex){var c=new Set;
return zWE(f,I,c).then(function(){for(var p=[],e=g.Y(c),O=e.next();!O.done;O=e.next())p.push(n2(f,O.value));return g.JF.all(p).then(function(){})})}var P=g.kw(I).entityType;
return g.JF.all([f.U.objectStore("EntityStore").delete(I),hWV(f,I)]).then(function(){AR(f,I,P)})},M9V=function(f,I){return g.AF(f.U.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(I)},function(G){return g.JF.all([G.delete(),
hWV(f,G.cursor.primaryKey)]).then(function(){AR(f,G.cursor.primaryKey,I);return g.dm(G)})})},DsL=function(f,I,G,c){var P=jVE(f.W,1);
return dJ(f,I,c).then(function(p){if(p){p=g.Wz(p,G);var e={key:I,entityType:c,data:Bx2(P,p,I),version:1};return g.JF.all([g.gm(f.U.objectStore("EntityStore"),e),Jp2(f,p,c)])}}).then(function(){AR(f,I,c);
return I})},AR=function(f,I,G){var c=f.Z[G];
c||(c=new Set,f.Z[G]=c);c.add(I)},Fnw=function(f,I,G){var c=idU(I);
G=oFw(G);if(!G)return g.JF.resolve([]);G=new G(I);f=f.U.objectStore("EntityAssociationStore");I=[];G=g.Y(G.W());for(var P=G.next();!P.done;P=G.next())I.push(g.gm(f,{parentEntityKey:c,childEntityKey:P.value}));return g.JF.all(I).then(function(p){return p.map(function(e){return e[1]})})},hWV=function(f,I){return f.U.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(I))},Jp2=function(f,I,G){var c=idU(I);
return hWV(f,c).then(function(){return Fnw(f,I,G)})},zWE=function(f,I,G){if(G.has(I))return g.JF.resolve(void 0);
G.add(I);return Zd$(f,I).then(function(c){return f.U.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(I)).then(function(){return c})}).then(function(c){var P=g.JF.resolve(void 0);
c=g.Y(c);for(var p=c.next(),e={};!p.done;e={qV:void 0},p=c.next())e.qV=p.value,P=P.then(function(O){return function(){return zWE(f,O.qV,G)}}(e));
return P}).then(function(){})},Zd$=function(f,I){var G=f.U.objectStore("EntityAssociationStore");
return G.index("byParentEntityKey").getAll(IDBKeyRange.only(I)).then(function(c){var P=[];c=g.Y(c);for(var p=c.next();!p.done;p=c.next())p=p.value,P.push(G.index("byChildEntityKey").getAll(p.childEntityKey));return g.JF.all(P)}).then(function(c){var P=[];
c=g.Y(c);for(var p=c.next();!p.done;p=c.next())p=p.value,p.length===1&&P.push(p[0].childEntityKey);return P})},sZ=function(){},gFE=function(){this.U={};
this.U[0]=new sZ;if(!g.oR("aes_pes_encoder_killswitch")){var f=this.U;try{var I=g.QC();var G=Lnr(I);var c=new vx(new g.MN(G),new g.hB(G))}catch(P){throw f=P instanceof Error?new rJ("KEY_CREATION_FAILED",{originalMessage:P.message}):new rJ("KEY_CREATION_FAILED"),g.ry(f),f;}f[1]=c}},jVE=function(f,I){I=I===void 0?0:I;
f=f.U[I];if(!f)throw I=new rJ("INVALID_ENCODER_VERSION",{ez:I}),g.ry(I),I;return f},X2=function(f,I){g.V.call(this);
this.token=f;this.U=I;this.observers=[];f=new g.XB.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.QC());f.onmessage=this.W.bind(this);this.channel=f},EZ=function(f,I,G){var c,P,p,e;
return g.Z(function(O){if(O.W==1)return g.D(O,usy(f.token),2);if(O.W!=3)return c=O.U,g.D(O,g.Zn(c,["EntityStore","EntityAssociationStore"],I,function(N){P=new qPr(N,f.U);return G(P)}),3);
p=O.U;P&&(e=P.Z,Object.keys(e).length>0&&(f.channel.postMessage(e),RW$(f,e)));return O.return(p)})},m2=function(f,I,G){return EZ(f,{mode:"readwrite",
l1:!0},function(c){return TQ(c,I,G)})},V9L=function(f,I){return EZ(f,{mode:"readwrite",
l1:!0},function(G){return Usy(G,I,"offlineOrchestrationActionWrapperEntity")})},rpU=function(f,I){return EZ(f,{mode:"readwrite",
l1:!0},function(G){return n2(G,I)})},vFw=function(f){return EZ(f,{mode:"readwrite",
l1:!0},function(I){return M9V(I,"videoPlaybackPositionEntity")})},C2=function(f,I,G){return EZ(f,{mode:"readonly",
l1:!0},function(c){return dJ(c,I,G)})},QR=function(f,I,G){return EZ(f,{mode:"readonly",
l1:!0},function(c){return yR(c,I,G)})},RW$=function(f,I){f=g.Y(f.observers);
for(var G=f.next();!G.done;G=f.next())G=G.value,G(I)},dsL=function(){var f,I,G;
return g.Z(function(c){if(c.W==1)return g.LY(c,2),g.D(c,g.GC(),4);if(c.W!=2){f=c.U;if(!f||!g.bM()||typeof g.XB.BroadcastChannel==="undefined")return c.return();I=new gFE;return c.return(new X2(f,I))}G=g.UU(c);G instanceof Error&&g.ry(G);return c.return()})},b3=function(){ypV||(ypV=dsL());
return ypV},ApL=function(f){var I;
f=(I=f.options)==null?void 0:I.persistenceOption;return f==="ENTITY_PERSISTENCE_OPTION_PERSIST"||f==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},TxU=function(f){var I;
return g.Z(function(G){return G.W==1?g.D(G,b3(),2):(I=G.U)?g.D(G,EZ(I,"readwrite",function(c){for(var P={},p=g.Y(f),e=p.next(),O={};!e.done;O={jJ:void 0,zW:void 0},e=p.next())O.jJ=e.value,O.jJ.entityKey&&ApL(O.jJ)&&(O.zW=g.TV(O.jJ.payload),e=void 0,O.jJ.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(e=function(N){return function(){return TQ(c,N.jJ.payload[N.zW],N.zW)}}(O)),O.jJ.type==="ENTITY_MUTATION_TYPE_DELETE"&&(e=function(N){return function(){return n2(c,N.jJ.entityKey)}}(O)),O.jJ.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(e=function(N){return function(){return DsL(c,N.jJ.entityKey,N.jJ.payload[N.zW],N.zW)}}(O)),e&&(P[O.jJ.entityKey]=P[O.jJ.entityKey]?P[O.jJ.entityKey].then(e):e()));
return g.JF.all(Object.values(P))}),0):G.return()})},nFy=function(f){var I;
return g.Z(function(G){if(G.W==1){I=f.mutations;if(!I||I.length<=0)return G.return();if(g.tr){var c={type:"ENTITY_LOADED"};I!==void 0&&(c.payload=I);g.tr.dispatch(c)}return g.D(G,TxU(I),2)}I.length=0;g.Bp(G)})},sVw=function(f){return f!==void 0},XjZ=function(f){var I=g.ZU();
I=Object.assign({},I);f=Object.assign({},f);for(var G in I)f[G]?(I[G]!==4&&(I[G]=f[G]),delete f[G]):I[G]!==2&&(I[G]=4);Object.assign(I,f);g.wSM(I);JSON.stringify(I);return I},EFV=function(f){var I,G;
return g.Z(function(c){if(c.W==1)return g.D(c,g.GC(),2);if(c.W!=3)return(I=c.U)?g.D(c,g.Vx(I),3):c.return();G=c.U;return c.return(g.Zn(G,["index","media","captions"],{mode:"readwrite",l1:!0},function(P){var p=IDBKeyRange.bound(f+"|",f+"~");P=[P.objectStore("index").delete(p),P.objectStore("media").delete(p),P.objectStore("captions").delete(p)];return g.JF.all(P).then(function(){})}))})},msw=function(){var f,I;
return g.Z(function(G){if(G.W==1)return g.D(G,g.GC(),2);if(G.W!=3){f=G.U;if(!f)throw g.jB("rvdfd");return g.D(G,g.Vx(f),3)}I=G.U;return G.return(g.Zn(I,["index","media"],{mode:"readwrite",l1:!0},function(c){var P={};return g.vG(c.objectStore("index"),{},function(p){var e=p.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),O=g.JF.resolve(void 0);if(e){var N=e[1];e=e[2];P[N]=P[N]||{};var H;P[N][e]=g.W7M((H=p.getValue())==null?void 0:H.fmts)}else O=p.delete().then(function(){});
return g.JF.all([g.dm(p),O]).then(function(x){return g.Y(x).next().value})}).then(function(){for(var p={},e=g.Y(Object.keys(P)),O=e.next();!O.done;O=e.next()){O=O.value;
var N=P[O].v;p[O]=P[O].a&&N?1:2}var H=XjZ(p);return g.JhS(c.objectStore("media"),{},function(x){var S=x.cursor.key.match(g.K7v);S&&p[S[1]]||c.objectStore("media").delete(x.cursor.key);return g.$uB(x)}).then(function(){return H})})}))})},CK2=function(f,I){var G,c;
return g.Z(function(P){if(P.W==1)return g.D(P,g.GC(),2);if(P.W!=3){G=P.U;if(!G)throw g.jB("wct");return g.D(P,g.Vx(G),3)}c=P.U;return g.D(P,g.Zn(c,["captions"],{mode:"readwrite",l1:!0},function(p){var e=[];p=p.objectStore("captions");for(var O=0;O<I.length;O++){var N=g.gm(p,I[O],f+"|"+I[O].metadata.vss_id);e.push(N)}return g.JF.all(e)}),0)})},QVk=function(f){var I,G,c;
return g.Z(function(P){if(P.W==1)return I=IDBKeyRange.bound(f+"|",f+"~"),g.D(P,g.GC(),2);if(P.W!=3){G=P.U;if(!G)throw g.jB("gactfv");return g.D(P,g.Vx(G),3)}c=P.U;return P.return(c.getAll("captions",I))})},bdL=function(f){return g.Z(function(I){g.RA(f,0);
return I.return(EFV(f))})},f_Z=function(f){return{context:g.pJ(),
videoIds:f}},I_J=function(f){return{context:g.pJ(),
playlistIds:f}},GnJ=function(f){return{context:g.pJ(),
offlinePlaylistSyncChecks:f}},cXu=function(){this.U=new Map},pfu=function(){PRV||(PRV=new cXu);
return PRV},ejJ=function(f,I){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:f},metadata:I,statusCode:void 0,csn:void 0,can:void 0}},tzU=function(f,I,G){if(!G){var c=c===void 0?!1:c;
G=f.U.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!G||c)G=g.Ji(16),f.U.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",G)}f={flowNonce:G,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:I.eventType};I.metadata&&(f.flowMetadata=I.metadata);I.statusCode!==void 0&&(f.flowEventStatus=I.statusCode);I.csn&&(f.csn=I.csn);I.can&&(f.can=I.can);g.SB("flowEvent",f,void 0)},OrZ=function(f){var I,G,c,P,p,e,O,N,H,x,S,u,a,k,B,L,K,q,h,F,v,E,n,GT,Pp,fY,eM,C,kd,qv,FB,Y7,OJ,JT,jM,Pw,W,OU,nU,BL;
return g.Z(function(UJ){if(UJ.W==1)return g.D(UJ,EZ(f,{mode:"readonly",l1:!0},function(au){return yR(au,"playbackData").then(function(vp){var Fk=vp.map(function(M){return M.transfer}).filter(function(M){return!!M}),zV=vp.map(function(M){return M.offlineVideoPolicy}).filter(function(M){return!!M}),U=vp.filter(function(M){return!!M.key}).map(function(M){return g.lB(g.kw(M.key).entityId,"downloadStatusEntity")});
Fk=yR(au,"transfer",Fk);zV=yR(au,"offlineVideoPolicy",zV);U=yR(au,"downloadStatusEntity",U);var z=Fk.then(function(M){M=M.reduce(function(R,y){(y==null?0:y.offlineVideoStreams)&&R.push.apply(R,g.J(y.offlineVideoStreams));return R},[]).filter(function(R){return!!R});
return yR(au,"offlineVideoStreams",M)});
return g.JF.all([Fk,zV,z,U]).then(function(M){var R=g.Y(M);M=R.next().value;var y=R.next().value;var Wp=R.next().value;R=R.next().value;return[vp,M,y,Wp,R]})})}),2);
if(UJ.W!=3)return I=UJ.U,g.D(UJ,EZ(f,{mode:"readonly",l1:!0},function(au){return yR(au,"mainDownloadsListEntity").then(function(vp){var Fk,zV;return(zV=(Fk=vp[0])==null?void 0:Fk.downloads)!=null?zV:[]})}),3);
G=UJ.U;c=g.Y(I);P=c.next().value;p=c.next().value;e=c.next().value;O=c.next().value;N=c.next().value;H=P;x=p;S=e;u=O;a=N;k={};B={};L={};K={};q={};h=[];F=g.Y(x);for(v=F.next();!v.done;v=F.next())(E=v.value)&&(k[E.key]=E);n=g.Y(S);for(GT=n.next();!GT.done;GT=n.next())(Pp=GT.value)&&(B[Pp.key]=Pp);fY=g.Y(a);for(eM=fY.next();!eM.done;eM=fY.next())(C=eM.value)&&(L[C.key]=C);kd=g.Y(u);for(qv=kd.next();!qv.done;qv=kd.next())(FB=qv.value)&&(K[FB.key]=FB);Y7=g.Y(G);for(OJ=Y7.next();!OJ.done;OJ=Y7.next())JT=
OJ.value,jM=void 0,q[(jM=JT.videoItem)!=null?jM:""]=!0,JT.videoItem&&(W=Pw=void 0,OU=(W=(Pw=g.kw(JT.videoItem))==null?void 0:Pw.entityId)!=null?W:"",h.push({externalVideoId:OU}));nU=H.filter(function(au){if(!au||!au.key||!au.offlineVideoPolicy)return!1;au=g.kw(au.key).entityId;au=g.lB(au,"downloadStatusEntity");var vp;return!(au&&((vp=L[au])==null?void 0:vp.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
BL=nU.map(function(au){var vp=k[au.transfer],Fk=[];if(vp==null?0:vp.offlineVideoStreams)for(var zV=g.Y(vp.offlineVideoStreams),U=zV.next();!U.done;U=zV.next())(U=K[U.value])&&Fk.push(U);zV=B[au.offlineVideoPolicy];U=q;var z=au==null?void 0:au.playerResponseTimestamp,M=g.kw(zV.key).entityId;au=g.lB(M,"mainVideoEntity");if(zV.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var R="OFFLINE_VIDEO_STATE_DISABLED";zV.expirationTimestamp&&Number(zV.expirationTimestamp)<Date.now()/1E3&&(R="OFFLINE_VIDEO_STATE_EXPIRED")}else if(zV.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")R="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(vp==null?void 0:vp.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":R="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":R="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":R="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":R="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":R="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":R="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:R="OFFLINE_VIDEO_STATE_UNKNOWN"}if(R==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(vp==null?void 0:vp.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":R="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":R="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":R=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}M={id:M,videoState:R};if(vp==null?0:vp.cotn)M.cotn=vp.cotn;if(vp==null?0:vp.maximumDownloadQuality)M.selectedVideoQuality=vp==null?void 0:vp.maximumDownloadQuality;if(vp==null?0:vp.lastProgressTimeMs)M.lastProgressTimeMs=vp.lastProgressTimeMs;z&&(M.playerResponseSavedTimeMs=String(Number(z)*1E3));vp=String;z=0;Fk=g.Y(Fk);for(R=Fk.next();!R.done;R=Fk.next())if(R=R.value,R.streamsProgress){R=g.Y(R.streamsProgress);for(var y=R.next();!y.done;y=R.next()){var Wp=void 0;
z+=Number((Wp=y.value.numBytesDownloaded)!=null?Wp:0)}}M.downloadedBytes=vp(z);M.selectedOfflineMode=U[au]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";zV.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(M.offlinePlaybackDisabledReason=zV.offlinePlaybackDisabledReason);return M});
return UJ.return({offlineVideos:BL,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:h}}})})},Nlk=function(){this.locks=navigator.locks},HrL=function(){try{var f=g.CY("ytglobal.locks_");
if(f)return f;var I;if(I=navigator){var G=navigator;I="locks"in G&&!!G.locks}if(I)return g.XB.localStorage&&g.XB.localStorage.getItem("noop"),f=new Nlk,g.EU("ytglobal.locks_",f),f}catch(c){}},f0=function(){},x0u=function(){},ir2=function(f){if(f.includes(":"))throw Error("Invalid user cache name: "+f);
return f+":"+g.QC("CacheStorage get")},SDy=function(){return g.Z(function(f){if(It!==void 0)return f.return(It);
It=new Promise(function(I){var G;return g.Z(function(c){switch(c.W){case 1:return g.LY(c,2),g.D(c,GE.open("test-only"),4);case 4:return g.D(c,GE.delete("test-only"),5);case 5:g.KY(c,3);break;case 2:if(G=g.UU(c),G instanceof Error&&G.name==="SecurityError")return I(!1),c.return();case 3:I("caches"in window),g.Bp(c)}})});
return f.return(It)})},a_L=function(){return g.Z(function(f){if(f.W==1)return g.D(f,SDy(),2);
if(!f.U)return f.return(void 0);uV$||(uV$=new x0u);return f.return(uV$)})},cZ=function(f,I,G){g.vP(new g.Ct("Woffle: "+f,G?{cotn:G}:""));
I instanceof Error&&g.vP(I)},kn$=function(f){var I;
return g.Z(function(G){if(G.W==1)return g.D(G,OrZ(f),2);I=G.U;g.SB("offlineStateSnapshot",I);g.Bp(G)})},PZ=function(f){g.V.call(this);
var I=this;this.api=f;this.GY={RUs:function(){return I.U},
yvs:function(){return I.W}};
typeof g.XB.BroadcastChannel!=="undefined"&&(this.U=new g.XB.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.QC()),this.U.onmessage=this.Z.bind(this),this.W=new g.XB.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.QC()),this.W.onmessage=this.G.bind(this))},p0=function(f,I){f.api.Xw("onOfflineOperationFailure",I);
var G;(G=f.U)==null||G.postMessage(I)},l_w=function(f,I,G,c){var P=this;
this.N=f;this.T=I;this.visibility=G;this.j=c;this.B=this.Y=this.J=this.Z=this.U=!1;this.G=new g.b9(function(){P.Qu()});
this.GY={Z1:function(){return P.W},
Qu:function(){P.Qu()},
EKt:function(){return P.G}};
this.visibility.subscribe("visibilitystatechange",function(){P.S4()})},wf7=function(f){if(!f.Z&&!f.U){var I=HrL();
if(I){f.Z=!0;var G=g.QC("OfflineLockManager");I.request("woffle_orchestration_leader:"+G,{},function(){var c,P,p,e;return g.Z(function(O){switch(O.W){case 1:return g.LY(O,2),f.W=new g.ag,f.U=!0,f.Z=!1,g.D(O,f.N(),4);case 4:return g.D(O,f.W.promise,5);case 5:g.KY(O,0);break;case 2:c=g.UU(O),((p=(P=f).j)==null?0:p.call(P,"wo_relinquish_leadership_on_lock_request_error"))||f.Qu(),c instanceof Error&&(e=c,e.args=[{name:"WoLockManagerError",ZG:c.name}],g.ry(e)),g.Bp(O)}})})}}},$0V=function(f){f.U&&(f.B=
!0,ep(f))},YDw=function(f,I){f.U&&(f.J=I,ep(f))},BlE=function(f,I){f.U&&(f.Y=I,ep(f))},ep=function(f){f.Y&&f.J&&f.B&&f.visibility.isBackground()?g.fB(f.G,6E4):f.G.stop()},tV=function(f){var I;
f.offlineDeleteReason=(I=f.offlineDeleteReason)!=null?I:"OFFLINE_DELETE_REASON_UNKNOWN";var G;f.offlineModeType=(G=f.offlineModeType)!=null?G:"OFFLINE_NOW";g.SB("offlineDeleteEvent",f)},Oo=function(f,I){var G=I.videoId;
var c=I.MW;I=I.offlineModeType;f.encryptedVideoId=G;f.cotn=c==null?void 0:c.cotn;f.offlineabilityFormatType=c==null?void 0:c.maximumDownloadQuality;var P;f.isRefresh=(P=c==null?void 0:c.isRefresh)!=null?P:!1;var p;f.softErrorCount=(p=c==null?void 0:c.transferRetryCount)!=null?p:0;f.offlineModeType=I!=null?I:"OFFLINE_NOW";(f.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&f.statusType==="UNKNOWN_STATUS_TYPE"||!f.transferStatusType&&!f.statusType)&&g.vP(Error("Woffle unknown transfer status"));
g.SB("offlineTransferStatusChanged",f)},Lku=function(f){Oo({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},f)},WkU=function(f,I,G,c){c={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!c};I&&G&&(I=Math.floor(I/1024).toFixed(),G=Math.floor(G/1024).toFixed(),c.alreadyDownloadedKbytes=I,c.totalFetchedKbytes=I,c.totalContentKbytes=G);Oo(c,f)},oPL=function(f){Oo({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},f)},qDy=function(f){Oo({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},f)},jgk=function(f){switch(f){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
NK=function(f){var I,G,c;
return((c=(I=f.actionMetadata)==null?void 0:(G=I.retryScheduleIntervalsInSeconds)==null?void 0:G.length)!=null?c:0)>0},HZ=function(f){return f.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!f.entityKey},xm=function(f){return f.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!f.entityKey},iQ=function(f){return f.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!f.entityKey},KkL=function(f){return f.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!f.entityKey},
Sp=function(f,I,G,c,P){P=P===void 0?!1:P;
var p,e,O,N,H,x;return g.Z(function(S){if(S.W==1)return p=g.lB(f,I),e=g.lB(f,"downloadStatusEntity"),g.D(S,EZ(G,{mode:"readonly",l1:!0},function(u){return g.JF.all([dJ(u,p,I),dJ(u,e,"downloadStatusEntity")])}),2);
O=S.U;N=O.length?O[0]:void 0;if(!N)return S.iH(0);H=JXy;if(x=O.length>1?O[1]:void 0){if(x.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!P)return S.return();x.downloadState=c}else x={key:e,downloadState:c};g.nq(N,H,x);return g.D(S,EZ(G,{mode:"readwrite",l1:!0},function(u){return g.JF.all([TQ(u,N,I),TQ(u,x,"downloadStatusEntity")])}),0)})},uQ=function(f,I){return f.actionType===I.actionType&&f.entityKey===I.entityKey},at=function(f,I){if(f&&f.transferState!=="TRANSFER_STATE_COMPLETE"&&f.transferState!==
"TRANSFER_STATE_FAILED"){var G=g.kw(f.key).entityId;
Oo({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:G,MW:f,offlineModeType:I})}},km=function(f){if(!f||!f.thumbnails)return[];
var I=[];f=g.Y(f.thumbnails);for(var G=f.next();!G.done;G=f.next())G=G.value,G.url&&I.push(G.url);return I},U0w=function(f,I,G){G=G===void 0?[]:G;
var c,P,p,e,O,N,H,x,S,u,a,k,B;return g.Z(function(L){if(L.W==1)return G.length?g.D(L,QR(f,I),2):L.return([]);c=L.U;P=new Set;p=g.Y(c);for(e=p.next();!e.done;e=p.next())if(O=e.value,N=O.id||O.key)H=g.kw(N).entityId,P.add(H);x=[];S=g.Y(G);for(u=S.next();!u.done;u=S.next())a=u.value,k=a.offlineVideoData,B=void 0,((B=k)==null?0:B.videoId)&&!P.has(k.videoId)&&x.push(a);return L.return(x)})},zjE=function(f,I,G){return new g.C3(f,{cotn:I,
raw_player_response:G,download_media:!0,start:Infinity,disable_watch_next:!0})},hjU=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},lQ=function(f,I,G,c,P,p,e,O,N,H,x){this.entityType=f;
this.actionId=I;this.action=G;this.parentActionId=c;this.rootActionId=P===void 0?I:P;this.childActionIds=p;this.prereqActionId=e;this.postreqActionIds=O;this.hasChildActionFailed=H;this.retryScheduleIndex=0;this.U=x||Date.now();this.retryScheduleIndex=N||0},wQ=function(f){if(!f.key)throw Error("Entity key is required.");
if(!f.actionProto)throw Error("OfflineOrchestrationAction is required.");var I=g.kw(f.key),G=g.kw(f.actionProto.entityKey);return new lQ(G.entityType,I.entityId,f.actionProto,f.parentActionId,f.rootActionId,f.childActionIds,f.prereqActionId,f.postreqActionIds,f.retryScheduleIndex,f.hasChildActionFailed,Number(f.enqueueTimeSec)*1E3)},$m=function(f){return{key:g.lB(f.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:f.action,parentActionId:f.parentActionId,rootActionId:f.rootActionId,childActionIds:f.childActionIds,prereqActionId:f.prereqActionId,postreqActionIds:f.postreqActionIds,retryScheduleIndex:f.retryScheduleIndex,hasChildActionFailed:f.hasChildActionFailed,enqueueTimeSec:(f.U/1E3).toFixed()}},MzL=function(){var f;
return g.Z(function(I){return I.W==1?g.D(I,a_L(),2):(f=I.U)?I.return(f.delete("yt-player-local-img")):I.return(!0)})},Ym=function(f){var I,G;
return g.Z(function(c){if(c.W==1)return g.D(c,a_L(),2);if(c.W!=3){I=c.U;if(!I)throw Error("Cache API not supported");return f.length?g.D(c,I.open("yt-player-local-img"),3):c.return()}G=c.U;return g.D(c,Promise.all(f.map(function(P){return G.delete(P)})),0)})},BZ=function(f){var I,G;
return g.Z(function(c){if(c.W==1)return g.D(c,a_L(),2);if(c.W!=3){I=c.U;if(!I)throw Error("Cache API not supported");return f.length?g.D(c,I.open("yt-player-local-img"),3):c.return()}G=c.U;return g.D(c,G.addAll(f),0)})},L0=function(f,I,G,c,P){var p,e,O,N,H,x,S,u,a,k,B,L,K,q,h,F,v,E,n,GT,Pp,fY,eM,C,kd,qv,FB,Y7,OJ,JT,jM;
return g.Z(function(Pw){switch(Pw.W){case 1:return p=g.lB(f,"mainVideoEntity"),e=g.lB(f,"ytMainChannelEntity"),O=g.lB(f,"transfer"),N=g.lB(f,"videoDownloadContextEntity"),g.D(Pw,EZ(I,{mode:"readonly",l1:!0},function(W){return g.JF.all([dJ(W,p,"mainVideoEntity"),dJ(W,e,"ytMainChannelEntity"),dJ(W,O,"transfer"),dJ(W,N,"videoDownloadContextEntity"),yR(W,"ytMainChannelEntity"),yR(W,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:H=Pw.U;x=g.Y(H);S=x.next().value;u=x.next().value;a=x.next().value;k=x.next().value;B=x.next().value;L=x.next().value;K=S;q=u;h=a;F=k;v=B;E=L;if(!K&&!q){Pw.iH(3);break}n=K?km(K.thumbnail):[];if(!q){GT=[];Pw.iH(4);break}return g.D(Pw,D0$(q,v),5);case 5:GT=Pw.U;case 4:return Pp=GT,g.D(Pw,Ym(n.concat(Pp)),3);case 3:fY=[];eM=g.lB(f,"downloadStatusEntity");C=g.Y(E);for(kd=C.next();!kd.done;kd=C.next())qv=kd.value,FB=g.kw(qv.key).entityId,Y7=wQ(qv),OJ=g.kw(Y7.action.entityKey).entityId,FB!==f&&OJ!==
f||uQ(G,qv.actionProto)||fY.push(qv.key);return g.D(Pw,EZ(I,{mode:"readwrite",l1:!0},function(W){var OU=fY.map(function(nU){return n2(W,nU)});
OU.push(n2(W,p,{Ex:!0}));OU.push(n2(W,eM,{Ex:!0}));return g.JF.all(OU)}),7);
case 7:jM=(JT=F)==null?void 0:JT.offlineModeType,P&&(tV(P),P.offlineModeType&&(jM=P.offlineModeType)),at(h,jM),p0(c,{entityKey:p,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Bp(Pw)}})},gPZ=function(f,I,G,c){var P,p,e,O,N,H,x,S,u,a,k,B,L,K,q,h,F,v,E,n,GT,Pp,fY,eM,C,kd,qv,FB,Y7,OJ,JT,jM,Pw,W,OU,nU,BL,UJ,au,vp,Fk,zV,U,z,M,R,y,Wp,I7,wS;
return g.Z(function(cp){switch(cp.W){case 1:return P=g.lB(f,"mainPlaylistEntity"),p=g.lB(f,"ytMainChannelEntity"),g.D(cp,EZ(I,{mode:"readonly",l1:!0},function(zT){return g.JF.all([dJ(zT,P,"mainPlaylistEntity"),dJ(zT,p,"ytMainChannelEntity"),yR(zT,"mainPlaylistEntity"),yR(zT,"mainDownloadsListEntity"),yR(zT,"ytMainChannelEntity"),yR(zT,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:e=cp.U;O=g.Y(e);N=O.next().value;H=O.next().value;x=O.next().value;S=O.next().value;u=O.next().value;a=O.next().value;k=N;B=H;L=x;K=S;q=u;h=a;if(!k&&!B){cp.iH(3);break}F=k?FkL(k):[];if(!B){v=[];cp.iH(4);break}return g.D(cp,D0$(B,q),5);case 5:v=cp.U;case 4:return E=v,g.D(cp,Ym(F.concat(E)),3);case 3:n=[];GT=new Map;if(!k){cp.iH(7);break}return g.D(cp,Zry(k,L,K),8);case 8:n=cp.U;Pp=g.Y(n);for(fY=Pp.next();!fY.done;fY=Pp.next())eM=fY.value,GT.set(eM,{videoId:eM,playlistId:f,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.D(cp,EZ(I,{mode:"readonly",l1:!0},function(zT){return g.JF.all([yR(zT,"transfer"),yR(zT,"videoDownloadContextEntity")])}),9);
case 9:C=cp.U;kd=g.Y(C);qv=kd.next().value;FB=kd.next().value;Y7=qv;OJ=FB;JT=g.Y(Y7);for(jM=JT.next();!jM.done;jM=JT.next())Pw=jM.value,W=g.kw(Pw.key).entityId,(OU=GT.get(W))&&Pw&&(OU.cotn=Pw.cotn);nU=g.Y(OJ);for(BL=nU.next();!BL.done;BL=nU.next())UJ=BL.value,au=g.kw(UJ.key).entityId,(vp=GT.get(au))&&UJ&&(vp.offlineModeType=UJ.offlineModeType);case 7:Fk=[];zV=g.Y(h);for(U=zV.next();!U.done;U=zV.next())z=U.value,M=g.kw(z.key).entityId,R=wQ(z),M!==f&&R.rootActionId!==f||uQ(G,z.actionProto)||Fk.push(z.key);
y=g.lB(f,"mainPlaylistEntity");return g.D(cp,EZ(I,{mode:"readwrite",l1:!0},function(zT){var mQ=Fk.map(function(Ww){return n2(zT,Ww)});
mQ.push(n2(zT,y,{Ex:!0}));return g.JF.all(mQ)}),10);
case 10:if(!k){cp.iH(0);break}n.reverse();if(!n){cp.iH(0);break}Wp=g.Y(n);I7=Wp.next();case 13:if(I7.done){cp.iH(0);break}wS=I7.value;return g.D(cp,L0(wS,I,G,c,GT.get(wS)),14);case 14:I7=Wp.next(),cp.iH(13)}})},Vzy=function(f,I,G,c){var P,p,e,O,N,H,x,S,u;
return g.Z(function(a){if(a.W==1)return P=g.lB("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),p=new Map,g.D(a,EZ(f,{mode:"readwrite",l1:!0},function(k){var B=yR(k,"transfer"),L=yR(k,"offlineOrchestrationActionWrapperEntity"),K=yR(k,"videoDownloadContextEntity"),q=dJ(k,P,"mainDownloadsListEntity");return g.JF.all([B,L,K,q]).then(function(h){h=g.Y(h);var F=h.next().value;var v=h.next().value;var E=h.next().value;var n=h.next().value;h=Rj2.map(function(Pp){return M9V(k,Pp)});
v=g.Y(v);for(var GT=v.next();!GT.done;GT=v.next())GT=GT.value,uQ(I,GT.actionProto)||h.push(n2(k,GT.key,{Ex:!0}));n&&(n.downloads=[],h.push(TQ(k,n,"mainDownloadsListEntity")));if(E)for(E=g.Y(E),n=E.next();!n.done;n=E.next())n=n.value,v=g.kw(n.key).entityId,v=g.lB(v,"transfer"),p.set(v,n.offlineModeType);return g.JF.all(h).then(function(){return F})})}),2);
e=a.U;O=g.Y(e);for(N=O.next();!N.done;N=O.next())H=N.value,at(H,p.get(H.key)),x=g.kw(H.key).entityId,S={videoId:x,offlineDeleteReason:c,cotn:H.cotn,offlineModeType:p.get(H.key)},tV(S),u=g.lB(x,"mainVideoEntity"),p0(G,{entityKey:u,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.D(a,MzL(),0)})},FkL=function(f,I){var G=[];
if(f.thumbnailStyleData){f=g.Y(f.thumbnailStyleData);for(var c=f.next();!c.done;c=f.next()){var P=void 0,p=void 0,e=void 0;G=G.concat(km((P=c.value)==null?void 0:(p=P.value)==null?void 0:(e=p.collageThumbnail)==null?void 0:e.coverThumbnail))}}I=km(I);return G.concat(I)},Zry=function(f,I,G){var c,P,p,e,O,N,H,x,S,u,a,k,B,L,K,q,h,F,v,E,n,GT,Pp;
return g.Z(function(fY){c=[];P=new Set;if(G.length)for(p=g.Y(G),e=p.next();!e.done;e=p.next())if(O=e.value,N=void 0,(N=O.downloads)==null?0:N.length)for(H=g.Y(O.downloads),x=H.next();!x.done;x=H.next())S=x.value,S.videoItem&&(u=g.kw(S.videoItem).entityId,P.add(u));if(f.videos){a=g.Y(f.videos);for(k=a.next();!k.done;k=a.next())B=k.value,L=JSON.parse(g.kw(B).entityId),L.videoId&&!P.has(L.videoId)&&c.push(L.videoId);K=g.Y(I);for(q=K.next();!q.done;q=K.next())if(h=q.value,h.key!==f.key&&(F=h.videos))for(v=
g.Y(F),E=v.next();!E.done;E=v.next())n=E.value,GT=JSON.parse(g.kw(n).entityId),GT.videoId&&(Pp=c.indexOf(GT.videoId),Pp!==-1&&c.splice(Pp,1))}return fY.return(c)})},D0$=function(f,I){var G,c,P,p,e,O,N,H;
return g.Z(function(x){G=km(f.avatar);c=g.Y(I);for(P=c.next();!P.done;P=c.next())if(p=P.value,p.id!==f.id)for(e=g.Y(km(p.avatar)),O=e.next();!O.done;O=e.next())N=O.value,H=G.indexOf(N),H!==-1&&G.splice(H,1);return x.return(G)})},rXu=function(f){var I;
return g.Z(function(G){I=g.d(f.frameworkUpdates,WZ);return f.frameworkUpdates&&I?g.D(G,nFy(I),0):G.return()})},d0V=function(f){var I;
if((I=f.onResponseReceivedActions)!=null&&I.length){var G;f=(G=g.d(g.d(f.onResponseReceivedActions[0],vPL),g.bVr))==null?void 0:G.actions;if(f!=null&&f.length)return f}},yXw=function(f){var I,G,c;
return g.Z(function(P){if(P.W==1)return f?g.D(P,C2(f,g.g9,"mainDownloadsListEntity"),2):P.return([]);I=P.U;return((G=I)==null?0:(c=G.downloads)==null?0:c.length)?P.return(I.downloads.map(function(p){var e;return(e=p.videoItem)!=null?e:""})):P.return([])})},TlL=function(f,I){var G;
return g.Z(function(c){return c.W==1?g.D(c,AXZ(f,I),2):(G=c.U)?g.D(c,EZ(f,{mode:"readwrite",l1:!0},function(P){var p=[TQ(P,G.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];G.mainDownloadsListEntity&&p.push(TQ(P,G.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.JF.all(p)}),0):c.iH(0)})},AXZ=function(f,I){var G,c,P,p,e,O,N,H,x,S,u,a,k,B,L,K,q,h;
return g.Z(function(F){if(F.W==1)return G=g.lB("main_downloads_library_id","mainDownloadsLibraryEntity"),c=g.lB("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.D(F,EZ(f,{mode:"readonly",l1:!0},function(v){return g.JF.all([dJ(v,G,"mainDownloadsLibraryEntity"),dJ(v,c,"mainDownloadsListEntity")])}),2);
P=F.U;p=g.Y(P);e=p.next().value;O=p.next().value;N=e;H=O;N||(N={id:G});x=g.Y(I);for(S=x.next();!S.done;S=x.next())if(u=S.value,u===g.g9){if(N.smartDownloadsList)return F.return();N.smartDownloadsList=u}else if(a=g.kw(u).entityType,k={},a==="mainPlaylistEntity"?k.playlistItem=u:a==="mainVideoEntity"&&(k.videoItem=u),!g.QL(k)){B=void 0;if((B=H)==null?0:B.downloads){L=!1;K=g.Y(H.downloads);for(q=K.next();!q.done;q=K.next())if(h=q.value,h.playlistItem===u||h.videoItem===u){L=!0;break}L||H.downloads.push(k)}else H=
{id:c,downloads:[k]};N.downloadsList=c}return F.return({mainDownloadsLibraryEntity:N,mainDownloadsListEntity:H})})},nP2=function(f,I){var G,c,P,p,e,O,N,H,x,S,u,a,k,B,L;
return g.Z(function(K){if(K.W==1)return G=g.lB("main_downloads_library_id","mainDownloadsLibraryEntity"),c=g.lB("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.D(K,EZ(f,{mode:"readonly",l1:!0},function(q){return g.JF.all([dJ(q,G,"mainDownloadsLibraryEntity"),dJ(q,c,"mainDownloadsListEntity"),dJ(q,g.g9,"mainDownloadsListEntity")])}),2);
P=K.U;p=g.Y(P);e=p.next().value;O=p.next().value;N=p.next().value;H=e;x=O;S=N;if(!H)return K.iH(0);if(I===g.g9&&((u=S)==null?0:u.downloads))S.downloads=[];else if((a=x)==null?0:a.downloads)for(k=g.kw(I).entityType,B=0;B<x.downloads.length;B++)if(L=x.downloads[B],k==="mainVideoEntity"&&L.videoItem===I){x.downloads.splice(B,1);break}else if(k==="mainPlaylistEntity"&&L.playlistItem===I){x.downloads.splice(B,1);break}return g.D(K,EZ(f,{mode:"readwrite",l1:!0},function(q){var h=[TQ(q,H,"mainDownloadsLibraryEntity")];
x&&h.push(TQ(q,x,"mainDownloadsListEntity"));S&&h.push(TQ(q,S,"mainDownloadsListEntity"));return g.JF.all(h)}),0)})},ot=function(f,I){var G,c,P,p,e,O,N,H,x,S,u;
return g.Z(function(a){if(a.W==1)return G=g.lB(I,"transfer"),c=g.lB(I,"videoDownloadContextEntity"),g.D(a,EZ(f,{mode:"readonly",l1:!0},function(k){return g.JF.all([dJ(k,G,"transfer"),dJ(k,c,"videoDownloadContextEntity")])}),2);
P=a.U;p=g.Y(P);e=p.next().value;O=p.next().value;N=e;H=O;u={videoId:I,cotn:(x=N)==null?void 0:x.cotn,offlineModeType:(S=H)==null?void 0:S.offlineModeType};return a.return(u)})},qK=function(f,I,G,c,P){var p,e,O,N,H,x,S,u,a,k,B,L,K,q,h,F,v,E,n,GT;
return g.Z(function(Pp){switch(Pp.W){case 1:return p=g.lB(f,"musicTrack"),e=g.lB(f,"transfer"),g.D(Pp,EZ(I,{mode:"readonly",l1:!0},function(fY){return g.JF.all([dJ(fY,p,"musicTrack"),dJ(fY,e,"transfer"),yR(fY,"musicTrack"),yR(fY,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:O=Pp.U;N=g.Y(O);H=N.next().value;x=N.next().value;S=N.next().value;u=N.next().value;a=H;k=x;B=S;L=u;if(!a){Pp.iH(3);break}return g.D(Pp,sgJ(a,B),4);case 4:return K=Pp.U,g.D(Pp,Ym(K),3);case 3:q=[];h=g.Y(L);for(F=h.next();!F.done;F=h.next())v=F.value,E=g.kw(v.key).entityId,n=wQ(v),GT=g.kw(n.action.entityKey).entityId,E!==f&&GT!==f||uQ(G,v.actionProto)||q.push(v.key);return g.D(Pp,EZ(I,{mode:"readwrite",l1:!0},function(fY){var eM=q.map(function(C){return n2(fY,C)});
eM.push(n2(fY,p,{Ex:!0}));return g.JF.all(eM)}),6);
case 6:at(k),P&&tV(P),p0(c,{entityKey:p,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Bp(Pp)}})},jp=function(f,I,G,c,P){var p,e,O,N,H,x,S,u,a,k,B,L,K,q,h,F,v,E,n,GT,Pp,fY,eM,C,kd,qv,FB,Y7,OJ,JT,jM,Pw,W,OU,nU,BL;
return g.Z(function(UJ){switch(UJ.W){case 1:return p=g.lB(f,I),e=g.lB("music_downloads_library_id","musicDownloadsLibraryEntity"),g.D(UJ,EZ(G,{mode:"readonly",l1:!0},function(au){return g.JF.all([dJ(au,p,I),dJ(au,e,"musicDownloadsLibraryEntity"),yR(au,I),yR(au,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:O=UJ.U;N=g.Y(O);H=N.next().value;x=N.next().value;S=N.next().value;u=N.next().value;a=H;k=x;B=S;L=u;if(!a){UJ.iH(3);break}return g.D(UJ,sgJ(a,B),4);case 4:return K=UJ.U,g.D(UJ,Ym(K),3);case 3:q=[];h=new Map;if(!a){UJ.iH(6);break}return g.D(UJ,Xfy(a,B,k),7);case 7:q=UJ.U;F=g.Y(q);for(v=F.next();!v.done;v=F.next())E=v.value,n=g.kw(E).entityId,h.set(n,{videoId:n,playlistId:f,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.D(UJ,QR(G,"transfer"),8);case 8:for(GT=UJ.U,Pp=
g.Y(GT),fY=Pp.next();!fY.done;fY=Pp.next())eM=fY.value,C=g.kw(eM.key).entityId,(kd=h.get(C))&&eM&&(kd.cotn=eM.cotn);case 6:qv=[];FB=g.Y(L);for(Y7=FB.next();!Y7.done;Y7=FB.next())OJ=Y7.value,JT=g.kw(OJ.key).entityId,jM=wQ(OJ),JT!==f&&jM.rootActionId!==f||uQ(c,OJ.actionProto)||qv.push(OJ.key);Pw=g.lB(f,I);return g.D(UJ,EZ(G,{mode:"readwrite",l1:!0},function(au){var vp=qv.map(function(Fk){return n2(au,Fk)});
vp.push(n2(au,Pw,{Ex:!0}));return g.JF.all(vp)}),9);
case 9:if(!a){UJ.iH(0);break}q.reverse();if(!q.length){UJ.iH(0);break}W=g.Y(q);OU=W.next();case 12:if(OU.done){UJ.iH(0);break}nU=OU.value;BL=g.kw(nU).entityId;if(!BL){UJ.iH(13);break}return g.D(UJ,qK(BL,G,c,P,h.get(BL)),13);case 13:OU=W.next(),UJ.iH(12)}})},K0=function(f,I,G){var c,P,p,e,O,N,H;
return g.Z(function(x){if(x.W==1)return g.D(x,EZ(f,{mode:"readwrite",l1:!0},function(S){var u=yR(S,"transfer"),a=yR(S,"offlineOrchestrationActionWrapperEntity");return g.JF.all([u,a]).then(function(k){k=g.Y(k);var B=k.next().value;var L=k.next().value;k=EPu.map(function(F){return M9V(S,F)});
L=g.Y(L);for(var K=L.next();!K.done;K=L.next()){K=K.value;var q=g.kw(K.actionProto.entityKey).entityType==="musicTrack",h=K.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";uQ(I,K.actionProto)||q&&(!q||h)||k.push(n2(S,K.key,{Ex:!0}))}return g.JF.all(k).then(function(){return B})})}),2);
c=x.U;P=g.Y(c);for(p=P.next();!p.done;p=P.next())e=p.value,at(e),O=g.kw(e.key).entityId,N={videoId:O,offlineDeleteReason:void 0,cotn:e.cotn},tV(N),H=g.lB(O,"musicTrack"),p0(G,{entityKey:H,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.D(x,MzL(),0)})},m0w=function(f){for(var I,G=g.Y(f.additionalMetadatas),c=G.next();!c.done;c=G.next())c=c.value,c.offlineMusicVideoData&&(I=c.offlineMusicVideoData);
var P,p,e,O,N;return{id:g.lB(f.videoId,"musicTrack"),videoId:f.videoId,title:f.title,thumbnailDetails:f.thumbnail,lengthMs:String(Number(f.lengthSeconds)*1E3),albumTitle:(P=I)==null?void 0:P.releaseTitle,musicVideoType:(p=I)==null?void 0:p.musicVideoType,contentRating:{explicitType:(e=I)==null?void 0:e.explicitType},artistNames:((O=I)==null?void 0:O.byline)||((N=I)==null?void 0:N.channelName),downloadMetadata:g.lB(f.videoId,"musicTrackDownloadMetadataEntity")}},Xfy=function(f,I,G){var c,P,p,e,O,N,
H,x,S,u,a,k,B,L,K,q,h,F;
return g.Z(function(v){c=[];P=new Set;if((p=G)==null?0:(e=p.downloadedTracks)==null?0:e.length)for(O=g.Y(G.downloadedTracks),N=O.next();!N.done;N=O.next())H=N.value,P.add(H);if(f.tracks){x=g.Y(f.tracks);for(S=x.next();!S.done;S=x.next())u=S.value,P.has(u)||c.push(u);a=g.Y(I);for(k=a.next();!k.done;k=a.next())if(B=k.value,B.id!==f.id&&(L=B.tracks))for(K=g.Y(L),q=K.next();!q.done;q=K.next())h=q.value,F=c.indexOf(h),F!==-1&&c.splice(F,1)}return v.return(c)})},sgJ=function(f,I){var G,c,P,p,e,O,N,H;
return g.Z(function(x){G=km(f.thumbnailDetails);c=g.Y(I);for(P=c.next();!P.done;P=c.next())if(p=P.value,p.id!==f.id)for(e=g.Y(km(p.thumbnailDetails)),O=e.next();!O.done;O=e.next())N=O.value,H=G.indexOf(N),H!==-1&&G.splice(H,1);return x.return(G)})},CRL=function(f,I){var G,c,P,p,e,O,N,H,x;
return g.Z(function(S){if(S.W==1)return G=g.lB("music_downloads_library_id","musicDownloadsLibraryEntity"),g.D(S,C2(f,G,"musicDownloadsLibraryEntity"),2);(c=S.U)||(c={id:G});P=g.kw(I).entityType;P==="musicTrack"?(p=c.downloadedTracks)!=null&&p.includes(I)||(c.downloadedTracks=((e=c.downloadedTracks)!=null?e:[]).concat(I)):P==="musicPlaylist"?(O=c.downloadedPlaylists)!=null&&O.includes(I)||(c.downloadedPlaylists=((N=c.downloadedPlaylists)!=null?N:[]).concat(I)):P!=="musicAlbumRelease"||(H=c.downloadedAlbumReleases)!=
null&&H.includes(I)||(c.downloadedAlbumReleases=((x=c.downloadedAlbumReleases)!=null?x:[]).concat(I));return g.D(S,m2(f,c,"musicDownloadsLibraryEntity"),0)})},Qgr=function(f,I){var G,c,P,p,e,O,N;
return g.Z(function(H){if(H.W==1)return G=g.lB("music_downloads_library_id","musicDownloadsLibraryEntity"),g.D(H,C2(f,G,"musicDownloadsLibraryEntity"),2);c=H.U;if(!c)return H.iH(0);P=g.kw(I).entityType;P==="musicTrack"?p=c.downloadedTracks:P==="musicPlaylist"&&(p=c.downloadedPlaylists);if((e=p)==null?0:e.length)for(O=0;O<p.length;O++)if(N=p[O],N===I){p.splice(O,1);break}return g.D(H,m2(f,c,"musicDownloadsLibraryEntity"),0)})},brw=function(f){var I=f.videos;
f=[];var G=[];if(I){I=g.Y(I);for(var c=I.next();!c.done;c=I.next()){var P=c.value.offlineVideoData.videoId;c=g.lB(P,"musicTrack");P=g.lB(P,"musicTrackDownloadMetadataEntity");f.push(c);G.push(P)}}return{L7:f,PT:G}},JV=function(f,I,G){I={track:m0w(I)};
G&&(I.playlistId=G);if(f=g.d(f.actionMetadata,feV))I.maximumDownloadQuality=f.maximumDownloadQuality;return{musicTrackEntityActionMetadata:I}},GUE=function(f){var I,G,c,P,p,e,O,N;
return g.Z(function(H){switch(H.W){case 1:return I=g.i5(),G=f_Z(f),c=g.wv(IeJ),g.LY(H,2),p={qA:!0},g.D(H,g.II(I,G,c,void 0,p),4);case 4:P=H.U;g.KY(H,3);break;case 2:e=g.UU(H);if(e instanceof g.NL)throw O="GetOffline network manager error: "+e.message,cZ(O,e),Error(O);cZ("GetOffline fetch request error",e);throw Error("GetOffline fetch request error");case 3:N=Uo(P);if(!P)throw cZ("Network request failed"),Error("Network request failed");if(N!==void 0)zE(N);else if(!P.videos||!P.videos.length)throw cZ("No data"),
Error("No data");return H.return(P.videos.map(function(x){return x.offlineVideoData}))}})},c3k=function(f){var I,G,c,P,p,e,O,N;
return g.Z(function(H){switch(H.W){case 1:return I=g.i5(),G=I_J(f),c=g.wv(IeJ),g.LY(H,2),p={qA:!0},g.D(H,g.II(I,G,c,void 0,p),4);case 4:P=H.U;g.KY(H,3);break;case 2:e=g.UU(H);if(e instanceof g.NL)throw O="GetOffline network manager error for playlist: "+e.message,cZ(O,e),Error(O);cZ("GetOffline fetch request error for playlist",e);throw Error("GetOffline fetch request error for playlist");case 3:N=Uo(P);if(!P)throw cZ("Network request failed for playlist"),Error("Network request failed for playlist");
if(N!==void 0)zE(N,"playlist");else if(!P.playlists||!P.playlists.length)throw cZ("No data for playlist"),Error("No data for playlist");return H.return(P.playlists.map(function(x){return x.offlinePlaylistData}))}})},pVw=function(f,I,G,c){var P,p,e,O,N,H,x,S,u,a,k,B,L,K,q,h,F,v,E,n,GT,Pp,fY,eM,C,kd,qv,FB,Y7,OJ;
return g.Z(function(JT){switch(JT.W){case 1:return g.D(JT,b3(),2);case 2:P=JT.U;if(!P)return JT.return([]);p=[];if((e=c)==null?0:e.length){p=c;JT.iH(3);break}return g.D(JT,QR(P,"mainPlaylistEntity"),4);case 4:p=JT.U;case 3:if(!p.length)return JT.return([]);O=[];N=Date.now()/1E3;H=g.Y(p);x=H.next();case 5:if(x.done)return O.length?g.D(JT,P92(O),10):JT.return([]);S=x.value;if(!S.downloadState){u=void 0;JT.iH(8);break}return g.D(JT,C2(P,S.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:u=
JT.U;case 8:a=u;k=void 0;L=(B=(k=S)==null?void 0:k.entityMetadata)&&B.nextAutoRefreshIntervalSeconds?Number(B.nextAutoRefreshIntervalSeconds):NaN;K=Number.isNaN(L)?f:L;h=q=void 0;F=((q=a)==null?0:q.lastSyncedTimestampMillis)?Number((h=a)==null?void 0:h.lastSyncedTimestampMillis)/1E3:0;E=v=void 0;n=((v=a)==null?0:v.addedTimestampMillis)?Number((E=a)==null?void 0:E.addedTimestampMillis)/1E3:0;if(G||!B||F+K<=N){GT=[];Pp=void 0;if((Pp=S.videos)==null?0:Pp.length)for(fY=g.Y(S.videos),eM=fY.next();!eM.done;eM=
fY.next())C=eM.value,kd=JSON.parse(g.kw(C).entityId),kd.videoId&&GT.push(kd.videoId);qv="0";B&&(FB=void 0,qv=String(Number((FB=B.offlineLastModifiedTimestampSeconds)!=null?FB:0).toFixed()));Y7={playlistId:S.playlistId,videoIds:GT,offlineLastModifiedTimestamp:qv,autoSync:I,offlineDateAddedTimestamp:String(n.toFixed())};O.push(Y7)}x=H.next();JT.iH(5);break;case 10:return OJ=JT.U,JT.return(OJ)}})},eO$=function(){var f,I,G,c,P;
return g.Z(function(p){if(p.W==1)return g.D(p,b3(),2);if(p.W!=3)return(f=p.U)?g.D(p,QR(f,"refresh"),3):p.return(!1);I=p.U;if((G=I[0])==null||!G.refreshTime)return p.return(!1);c=Number(I[0].refreshTime);P=Date.now()/1E3;return p.return(isFinite(c)&&P>=c)})},OML=function(f,I){var G,c,P;
return g.Z(function(p){switch(p.W){case 1:return g.LY(p,2),g.D(p,ty7(f,I),4);case 4:return c=p.U,g.D(p,rXu(c),5);case 5:G=d0V(c);g.KY(p,3);break;case 2:P=g.UU(p),cZ("getAndProcessSmartDownloadsResponse request or processing error",P);case 3:return p.return(G)}})},NRE=function(f,I,G,c){var P,p,e,O,N,H,x,S,u,a,k,B,L,K,q,h,F,v,E,n,GT,Pp,fY,eM,C,kd,qv,FB,Y7,OJ;
return g.Z(function(JT){switch(JT.W){case 1:return g.D(JT,b3(),2);case 2:P=JT.U;if(!P)return JT.return([]);p=[];if((e=c)==null?0:e.length){p=c;JT.iH(3);break}return g.D(JT,QR(P,"musicPlaylist"),4);case 4:p=JT.U;case 3:if(!p.length)return JT.return([]);O=[];N=Date.now()/1E3;H=g.Y(p);x=H.next();case 5:if(x.done)return O.length?g.D(JT,P92(O),10):JT.return([]);S=x.value;u=void 0;k=(a=(u=S)==null?void 0:u.entityMetadata)&&a.nextAutoRefreshIntervalSeconds?Number(a.nextAutoRefreshIntervalSeconds):NaN;B=
Number.isNaN(k)?f:k;K=L=0;q="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!S.downloadMetadata){JT.iH(8);break}return g.D(JT,C2(P,S.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:h=JT.U,v=F=void 0,L=Number((v=(F=h)==null?void 0:F.addedTimestampMillis)!=null?v:"0")/1E3,n=E=void 0,K=Number((n=(E=h)==null?void 0:E.lastModifiedTimestampMillis)!=null?n:"0")/1E3,Pp=GT=void 0,q=(Pp=(GT=h)==null?void 0:GT.syncState)!=null?Pp:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:fY=void 0;if(G||q!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!a||Number((fY=a.lastSyncedTimestampSeconds)!=null?fY:0)+B<=N){eM=[];C=void 0;if((C=S.tracks)==null?0:C.length)for(kd=g.Y(S.tracks),qv=kd.next();!qv.done;qv=kd.next())FB=qv.value,eM.push(g.kw(FB).entityId);Y7={playlistId:S.playlistId,videoIds:eM,offlineLastModifiedTimestamp:String(K.toFixed()),autoSync:I,offlineDateAddedTimestamp:String(L.toFixed())};O.push(Y7)}x=H.next();JT.iH(5);break;case 10:return OJ=JT.U,JT.return(OJ)}})},ty7=function(f,I){var G,c,P,p,e,O,N,H,x,S;
return g.Z(function(u){switch(u.W){case 1:return G=g.i5(),g.D(u,b3(),2);case 2:c=u.U;if(!c){u.iH(3);break}return g.D(u,OrZ(c),4);case 4:P=u.U;case 3:var a=P;p={context:g.pJ(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:f},offlineClientState:a,clientStateRequestData:{preferredFormatType:I}}}};e=g.wv(HMU);g.LY(u,5);N={qA:!0};return g.D(u,g.II(G,p,e,void 0,N),7);case 7:O=u.U;g.KY(u,6);break;case 5:H=g.UU(u);if(H instanceof g.NL)throw x=
"DPS network manager error for smart downloads: "+H.message,cZ(x,H),Error(x);cZ("DPS fetch request error for smart downloads",H);throw Error("DPS fetch request error for smart downloads");case 6:S=Uo(O);if(O)S!==void 0&&zE(S,"smart downloads");else throw cZ("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return u.return(O)}})},iMZ=function(f,I){var G,c,P,p,e,O,N,H;
return g.Z(function(x){switch(x.W){case 1:return G=g.i5(),c={context:g.pJ(),videoPlaybackPositionEntities:f,lastSyncTimestampUsec:I},P=g.wv(x5$),g.LY(x,2),e={qA:!0},g.D(x,g.II(G,c,P,void 0,e),4);case 4:p=x.U;g.KY(x,3);break;case 2:O=g.UU(x);if(O instanceof g.NL)throw N="VPPS network manager error: "+O.message,cZ(N,O),Error(N);cZ("VPPS fetch request error",O);throw Error("VPPS fetch request error");case 3:H=Uo(p);if(p)H!==void 0&&zE(H,"position sync");else throw cZ("Network request failed for position sync"),
Error("Network request failed for position sync");return x.return(p)}})},uF7=function(f,I,G){var c,P,p,e,O,N,H,x;
return g.Z(function(S){switch(S.W){case 1:c=g.i5();var u=G.refreshData,a=G.isEnqueuedForExpiredStreamUrlRefetch,k=G.pz,B=G.offlineSourceData,L=G.mediaCapabilities,K={entityKey:f};u&&(K.refreshData=u);a&&(K.isExpiredStreamUrlRefetch=a);k&&(K.downloadParameters=k);B&&(K.offlineSourceData=B);u={context:g.N2(I),signatureTimestamp:20230,videos:[K]};L&&(u.mediaCapabilities=L);P=u;p=g.wv(Sik);g.LY(S,2);O={qA:!0};return g.D(S,g.II(c,P,p,void 0,O),4);case 4:e=S.U;g.KY(S,3);break;case 2:N=g.UU(S);if(N instanceof
g.NL)throw H="GetPDE network manager error: "+N.message,cZ(H,N),Error(H);cZ("GetPDE fetch request error",N);throw Error("GetPDE fetch request error");case 3:x=Uo(e);if(e)x!==void 0&&zE(x,"PDE");else throw cZ("Network request failed for PDE"),Error("Network request failed for PDE");return S.return(e)}})},Uo=function(f){var I;
return(I=f.errorMetadata)==null?void 0:I.status},zE=function(f,I){I=I?" for "+I:"";
if(f===0)throw f="Empty response body"+I,cZ(f),Error(f);f="Response with error"+I;cZ(f);throw Error(f);},P92=function(f){var I,G,c,P,p,e,O,N;
return g.Z(function(H){switch(H.W){case 1:return I=g.i5(),G=GnJ(f),c=g.wv(aek),g.LY(H,2),p={qA:!0},g.D(H,g.II(I,G,c,void 0,p),4);case 4:P=H.U;g.KY(H,3);break;case 2:e=g.UU(H);if(e instanceof g.NL)throw O="offlinePlaylistSyncCheck network manager error: "+e.message,cZ(O,e),Error(O);cZ("offlinePlaylistSyncCheck fetch request error",e);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:N=Uo(P);if(!P)throw cZ("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(N!==void 0)zE(N,"playlist sync");else if(!P.offlinePlaylistSyncCheckDatas||!P.offlinePlaylistSyncCheckDatas.length)throw cZ("No data for playlist sync"),Error("No data for playlist sync");return H.return(P.offlinePlaylistSyncCheckDatas.map(function(x){return x.offlinePlaylistSyncCheckData}))}})},hV=function(f){this.U=f},kUL=function(f,I){var G,c,P,p,e,O;
return g.Z(function(N){switch(N.W){case 1:G=new Map,c=g.Y(I),P=c.next();case 2:if(P.done){N.iH(4);break}p=P.value;e=G;O=e.set;return g.D(N,f.W(p),5);case 5:O.call(e,p,N.U);P=c.next();N.iH(2);break;case 4:return N.return(G)}})},MK=function(f,I,G,c,P,p){I=g.lB(I,G);
c=Object.assign({},p,{priority:c,retryScheduleIntervalsInSeconds:P});return{actionType:f,entityKey:I,actionMetadata:c}},Db=function(f,I,G,c,P,p){this.status=f;
this.U=I;this.G=G;this.W=c;this.Z=P;this.downloadState=p},ley=function(f,I,G){this.U=f;
this.UH=I;this.Z=G},YiL=function(f,I){var G,c,P,p,e,O,N,H,x;
return g.Z(function(S){switch(S.W){case 1:return G=I.entityKey,P=(c=g.d(I.actionMetadata,Fy))==null?void 0:c.isEnqueuedForExpiredStreamUrlRefetch,g.LY(S,2),p=void 0,g.D(S,wVw(f,I),4);case 4:p=S.U;g.LY(S,5);var u=(u=g.d(I.actionMetadata,Fy))?{maximumDownloadQuality:u.maximumDownloadQuality}:void 0;return g.D(S,uF7(G,f.UH,{isEnqueuedForExpiredStreamUrlRefetch:P,pz:u,offlineSourceData:p}),7);case 7:e=S.U;g.KY(S,6,2);break;case 5:return g.UU(S,2),O=NK(I)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",cZ("PDE handleAdd error"),S.return(Zb(I,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",O,"DOWNLOAD_STATE_FAILED"));case 6:return g.D(S,$5$(f,e,I),8);case 8:return S.return(Zb(I,!0,e.orchestrationActions));case 2:return N=g.UU(S),H="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",N instanceof g.BG&&N.type==="QUOTA_EXCEEDED"&&(H="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
x="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),cZ("PDE handleAdd error"),S.return(Zb(I,!1,void 0,H,x,"DOWNLOAD_STATE_FAILED"))}})},WBL=function(f,I){var G,c,P,p,e,O,N,H,x,S,u,a,k,B,L,K,q,h,F,v,E,n,GT,Pp;
return g.Z(function(fY){switch(fY.W){case 1:return G=I.entityKey,c=g.kw(G).entityId,g.D(fY,EZ(f.U,{mode:"readonly",l1:!0},function(eM){var C=dJ(eM,G,"playbackData"),kd=dJ(eM,g.lB(c,"offlineVideoPolicy"),"offlineVideoPolicy");eM=dJ(eM,g.lB(c,"transfer"),"transfer");return g.JF.all([C,kd,eM])}),2);
case 2:P=fY.U;p=g.Y(P);e=p.next().value;O=p.next().value;N=p.next().value;H=e;x=O;S=N;if(!H||!x)return fY.return(Zb(I,!0));u=[];B=((k=H)==null?0:k.playerResponseJson)?JSON.parse(H.playerResponseJson):null;if(!(S&&B&&f.UH.j("html5_refresh_deprecated_downloads"))){fY.iH(3);break}a=BRr(f,B,S);return g.D(fY,LB2(f,S),4);case 4:u=fY.U;case 3:L={lastPlayerResponseTimestampSeconds:H.playerResponseTimestamp,offlineToken:x.offlineToken,formatIds:u};K={};if((q=S)==null?0:q.maximumDownloadQuality)K.maximumDownloadQuality=
S.maximumDownloadQuality;g.LY(fY,5);h=void 0;return g.D(fY,wVw(f,I),7);case 7:return h=fY.U,g.LY(fY,8),g.D(fY,uF7(G,f.UH,{refreshData:L,pz:K,offlineSourceData:h,mediaCapabilities:a}),10);case 10:F=fY.U;g.KY(fY,9,5);break;case 8:return g.UU(fY,5),v=NK(I)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",cZ("PDE handleRefresh error"),fY.return(Zb(I,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",v,
"DOWNLOAD_STATE_FAILED"));case 9:return g.D(fY,$5$(f,F,I),11);case 11:return fY.return(Zb(I,!0,F.orchestrationActions));case 5:return E=g.UU(fY),n="PDE handleRefresh error",E instanceof Error&&(n="PDE handleRefresh error: "+E.message),GT="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Pp="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.BG&&E.type==="QUOTA_EXCEEDED"&&(GT="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Pp="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
cZ(n),fY.return(Zb(I,!1,void 0,GT,Pp,"DOWNLOAD_STATE_FAILED"))}})},wVw=function(f,I){var G,c,P,p;
return g.Z(function(e){if(e.W==1)return G=g.kw(I.entityKey).entityId,c=g.lB(G,"videoDownloadContextEntity"),g.D(e,C2(f.U,c,"videoDownloadContextEntity"),2);P=e.U;return(p=P)!=null&&p.offlineModeType?e.return({offlineModeType:P.offlineModeType}):e.return(void 0)})},$5$=function(f,I,G){var c,P,p,e,O;
return g.Z(function(N){if(N.W==1){if(!I.frameworkUpdates||!g.d(I.frameworkUpdates,WZ))return N.return();if(!(g.d(I.frameworkUpdates,WZ).mutations&&g.d(I.frameworkUpdates,WZ).mutations.length>0&&g.d(I.frameworkUpdates,WZ).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return N.iH(2);c=g.kw(g.d(I.frameworkUpdates,WZ).mutations[0].entityKey).entityId;return g.D(N,ot(f.U,c),3)}if(N.W!=2){P=N.U;p=g.d(G.actionMetadata,Fy);if(O=(e=p)==null?void 0:e.playlistId)P.playlistId=O;P.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.cb(f.UH)?g.D(N,L0(c,f.U,G,f.Z,P),2):g.nm(f.UH)?g.D(N,qK(c,f.U,G,f.Z),2):N.iH(2)}return g.D(N,nFy(g.d(I.frameworkUpdates,WZ)),0)})},Zb=function(f,I,G,c,P,p){return new Db(I?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",NK(f),G,c,P,p)},BRr=function(f,I,G){I=zjE(f.UH,G.cotn,I);
G=g.SN(I);return g.CcB(I,G,f.UH)},LB2=function(f,I){var G,c,P,p,e,O,N,H,x,S,u;
return g.Z(function(a){if(a.W==1)return G=[],g.D(a,EZ(f.U,{mode:"readonly",l1:!0},function(k){var B=[],L=I.offlineVideoStreams;if(L){L=g.Y(L);for(var K=L.next();!K.done;K=L.next())B.push(dJ(k,K.value,"offlineVideoStreams"))}return g.JF.all(B)}),2);
if(c=a.U)for(P=g.Y(c),p=P.next();!p.done;p=P.next())if(e=p.value,O=void 0,(O=e)==null?0:O.streamsProgress)for(N=e.streamsProgress,H=0;H<N.length;H++)x=N[H],S=JSON.parse(x.formatStreamBytes),u={itag:S.itag,lmt:S.lastModified,xtags:S.xtags},G.push(u);return a.return(G)})},o1L=function(f,I){this.U=f;
this.UH=I},qiZ=function(f,I){var G,c,P,p,e,O,N,H,x,S,u,a;
return g.Z(function(k){switch(k.W){case 1:return G=NK(I),g.D(k,QR(f.U,"videoPlaybackPositionEntity"),2);case 2:c=k.U;if(c.length===0)return k.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));g.LY(k,3);return g.D(k,VR.getInstance(),5);case 5:P=k.U;if(!P)throw Error("prefStorage is undefined");return g.D(k,P.get("psi"),6);case 6:return p=k.U,N=(O=(e=p)==null?void 0:e.kf)!=null?O:"0",g.D(k,iMZ(c,N),7);case 7:return H=k.U,x={isPaused:H.watchHistoryPaused,kf:H.syncTimestampUsec},g.D(k,P.set("psi",
x),8);case 8:if(x.isPaused){k.iH(9);break}S=g.d(H.frameworkUpdates,WZ);if(!H.frameworkUpdates||!S){k.iH(9);break}return g.D(k,nFy(S),9);case 9:g.KY(k,4);break;case 3:return u=g.UU(k),a="PPE handleRefresh error: "+(u instanceof Error?u.message:"unknown error"),cZ(a),k.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return k.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G))}})},KBw=function(f,I){var G,c,P,p,e,O,N,H;
return g.Z(function(x){switch(x.W){case 1:return G=NK(I),c=g.kw(I.entityKey).entityId,g.LY(x,2),g.D(x,VR.getInstance(),4);case 4:P=x.U;if(!P)throw Error("prefStorage is undefined");return g.D(x,P.get("psi"),5);case 5:p=x.U;e=g.d(I.actionMetadata,jGw);if(((O=p)==null?void 0:O.isPaused)!==!1||(N=e)==null||!N.lastPlaybackPositionSeconds){x.iH(6);break}H={key:g.lB(c,"videoPlaybackPositionEntity"),videoId:c,lastPlaybackPositionSeconds:e.lastPlaybackPositionSeconds};return g.D(x,m2(f.U,H,"videoPlaybackPositionEntity"),
6);case 6:g.KY(x,3);break;case 2:return g.UU(x),x.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return x.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G))}})},J3L=function(f,I){var G,c,P;
return g.Z(function(p){switch(p.W){case 1:G=NK(I);g.LY(p,2);c=g.kw(I.entityKey).entityId;if(c==="!*$_ALL_ENTITIES_!*$")return g.D(p,vFw(f.U),5);P=g.lB(c,"videoPlaybackPositionEntity");return g.D(p,rpU(f.U,P),5);case 5:g.KY(p,3);break;case 2:return g.UU(p),p.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return p.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G))}})},U5w=function(f,I){this.api=f;
this.U=I;this.logger=new g.NU("woffle");this.W=!1;this.GY={D9:this.D9};this.logger.debug("Initialized OfflineMediaManager")},zOJ=function(f){return g.Z(function(I){return I.return(bdL(f))})},hOU=function(f){var I;
return g.Z(function(G){if(G.W==1)return g.D(G,g.o_B(f),2);I=G.U;return G.return(I.filter(function(c){return!!c.url}).map(function(c){return c.url}))})},gQ=function(f,I){var G=g.g7(I);
if(G===1||G===0)return Promise.resolve();(G=MyZ(f,I))&&G.stopVideo();f.Z=0;return zOJ(I)},Rt=function(f,I,G,c){G=G===void 0?!1:G;
c=c===void 0?!0:c;var P=typeof I==="string"?I:I.videoDetails.videoId;g.g7(P)===2&&((I=MyZ(f,P))?I.stopVideo():f.logger.info(function(){return"Corresponding player for "+P+" not found. Pausing anyway"}),g.RA(P,2),f.Z=2,G?D52(f.U):c&&FB2(f.U))},MyZ=function(f,I){var G;
return((G=f.player)==null?void 0:G.getVideoData().videoId)===I?f.player:null},ZML=function(f,I,G){I.getPlayerResponse();
g.RA(I.videoId,2);f.Z=2;f.W=!1;var c;(c=f.player)==null||c.dispose();f.player=f.api.yp(I);I={};f.player.y9((I.localmediachange=f.Mj,I.signatureexpired=f.rU,I.statechange=f.fiH,I),f);var P=f.D9(G);f.player.pX(g.aw(P,P,!0,"m"),!1);f.logger.debug(function(){return"Starting headless playback with quality: "+P});
f.player.O9(!1)},g1E=function(f,I){this.U=f;
this.UH=I},Vy2=function(f,I){var G,c;
return g.Z(function(P){switch(P.W){case 1:return G=NK(I),g.D(P,C2(f.U,I.entityKey,"transfer"),2);case 2:if(c=P.U)return P.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));g.LY(P,3);return g.D(P,ROE(f,I),5);case 5:g.KY(P,4);break;case 3:return g.UU(P),P.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return P.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G))}})},r3w=function(f,I){var G,c;
return g.Z(function(P){switch(P.W){case 1:return G=NK(I),g.D(P,C2(f.U,I.entityKey,"transfer"),2);case 2:c=P.U;if(!c||c.transferState!=="TRANSFER_STATE_COMPLETE")return P.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));g.LY(P,3);return g.D(P,ROE(f,I,!0),5);case 5:g.KY(P,4);break;case 3:return g.UU(P),P.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return P.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G))}})},v1y=function(f,I){var G,c,P,p,e,O,N,H,x,S;
return g.Z(function(u){switch(u.W){case 1:return G=NK(I),c=g.kw(I.entityKey).entityId,g.D(u,EZ(f.U,{mode:"readonly",l1:!0},function(a){var k=dJ(a,I.entityKey,"transfer");a=dJ(a,g.lB(c,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.JF.all([k,a])}),2);
case 2:P=u.U;p=g.Y(P);e=p.next().value;O=p.next().value;N=e;H=O;if(!N||N.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return u.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));g.LY(u,3);N.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.D(u,m2(f.U,N,"transfer"),5);case 5:x=g.kw(N.key).entityId;oPL({videoId:x,MW:N,offlineModeType:(S=H)==null?void 0:S.offlineModeType});g.KY(u,4);break;case 3:return g.UU(u),u.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return u.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G))}})},ROE=function(f,I,G){G=G===void 0?!1:G;
var c,P,p,e,O,N,H,x,S,u,a,k,B,L,K;return g.Z(function(q){switch(q.W){case 1:return c=g.d(I.actionMetadata,d5J),P=g.kw(I.entityKey).entityId,p=g.lB(P,"downloadStatusEntity"),g.D(q,EZ(f.U,{mode:"readonly",l1:!0},function(h){var F=dJ(h,p,"downloadStatusEntity");h=dJ(h,g.lB(P,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.JF.all([F,h])}),2);
case 2:return e=q.U,O=g.Y(e),N=O.next().value,H=O.next().value,x=N,S=H,u="TRANSFER_STATE_TRANSFER_IN_QUEUE",((a=x)==null?void 0:a.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(u="TRANSFER_STATE_PAUSED_BY_USER"),L={key:I.entityKey,transferState:u,cotn:g.Ji(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(k=c)==null?void 0:k.maximumDownloadQuality,preferredAudioTrack:(B=c)==null?void 0:B.preferredAudioTrack,transferRetryCount:0,isRefresh:G,hasLoggedFirstStarted:!1},g.D(q,EZ(f.U,
{mode:"readwrite",l1:!0},function(h){var F=[];G&&F.push(n2(h,g.lB(P,"offlineVideoStreams")));F.push(TQ(h,L,"transfer"));return g.JF.all(F)}),3);
case 3:if(!G){q.iH(4);break}return g.D(q,zOJ(P),4);case 4:Lku({videoId:P,MW:L,offlineModeType:(K=S)==null?void 0:K.offlineModeType}),g.Bp(q)}})},A3L=function(f,I,G,c){if(!f.action.entityKey)throw Error("entityKey is missing.");
var P=g.kw(f.action.entityKey);P={entityType:P.G7,entityId:P.entityId,offlineOrchestrationActionType:f.action.actionType,orchestrationAction:{orchestrationActionId:f.actionId}};I&&(P.offlineOrchestrationActionResult=I.status,P.isRetryable=G?!1:I.U,I.Z&&(P.offlineOrchestrationFailureReason=y3$(I.Z,P.isRetryable)));var p,e;if((p=f.action.actionMetadata)==null?0:(e=p.offlineLoggingData)==null?0:e.offlineModeType)P.offlineModeType=f.action.actionMetadata.offlineLoggingData.offlineModeType;c&&(P.additionalOrchestrationActions=
c.map(function(O){return{orchestrationActionId:O.actionId}}));
return P},y3$=function(f,I){return f!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||I?f==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&I?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":f:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},TRU=function(f,I){var G={offlineOrchestrationContext:A3L(f)};
I=ejJ(I,G);tzU(pfu(),I,f.rootActionId)},n1w=function(f,I,G,c){c=c===void 0?[]:c;
I={offlineOrchestrationContext:A3L(f,I,G,c)};I=ejJ(3,I);tzU(pfu(),I,f.rootActionId)},sGL=function(){this.actions=[]},XVE=function(f,I){I=g.Y(I);
for(var G=I.next();!G.done;G=I.next())G=G.value,TRU(G,1),f.actions.push(G);f.actions.sort(f.U)},E1L=function(f,I){if(I)for(var G=0;G<f.actions.length;G++)if(I==="!*$_ALL_ENTITIES_!*$"&&f.actions[G].actionId!==I||I!=="!*$_ALL_ENTITIES_!*$"&&f.actions[G].rootActionId===I&&f.actions[G].actionId!==I)f.actions.splice(G,1),G--},m5L=function(f,I){f=g.Y(f.actions);
for(var G=f.next();!G.done;G=f.next())if(G.value.actionId===I)return!0;return!1},VH=function(f,I,G,c,P){g.V.call(this);
var p=this;this.W=f;this.rb=I;this.uH=G;this.Y=c;this.UH=P;this.U=new sGL;this.J=new g.b_;this.Z=new g.b9(function(){p.retry()});
this.N=NaN;this.B=!1;this.GY={WIg:function(){return p.U},
I1:function(){return p.J},
rPw:function(){return p.Z},
retry:function(){return p.retry()}};
g.r(this,this.Z);this.T=this.W.observe(this.WH.bind(this))},bM$=function(f,I,G,c,P){var p;
return g.Z(function(e){if(e.W==1)return p=new VH(f,I,G,c,P),g.D(e,C9Z(p),2);QGw(p);return e.return(p)})},QGw=function(f){var I=f.U.actions[0];
return f.G?((I==null?void 0:I.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&f.G[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(f.B=!0),Promise.resolve()):fAU(f)},fAU=function(f){var I,G,c,P,p,e,O,N,H,x,S,u,a,k,B,L,K;
return g.Z(function(q){switch(q.W){case 1:if(f.G)throw Error("Already processing an action");if(f.PH())return q.return();I=f.U.actions.shift();YDw(f.uH,!I);if(I===void 0)return q.return();I.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&I.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&E1L(f.U,I.actionId);G="";I.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&I.rootActionId===I.actionId&&(G=I.actionId);c=[I];f.G=c;if(P=f.rb[I.entityType]){q.iH(2);break}f.G=
void 0;return g.D(q,fAU(f),3);case 3:return q.return();case 2:p=g.Y(c);for(e=p.next();!e.done;e=p.next())O=e.value,TRU(O,2);g.LY(q,4,5);return g.D(q,kUL(P,c.map(function(h){return h.action})),7);
case 7:N=q.U,H=g.Y(c),x=H.next();case 8:if(x.done){q.iH(10);break}S=x.value;u=N.get(S.action);return g.D(q,IAk(f,S,u),9);case 9:x=H.next();q.iH(8);break;case 10:E1L(f.U,G);case 5:g.hT(q);f.G=void 0;g.Mv(q,6);break;case 4:return a=g.UU(q),cZ("Orchestration error",a),g.LY(q,12),g.D(q,Guw(f,c),14);case 14:g.KY(q,5);break;case 12:k=g.UU(q);cZ("Orchestration retry error",k);B=g.Y(c);for(L=B.next();!L.done;L=B.next())K=L.value,K.retryScheduleIndex<3&&XVE(f.U,[K]);q.iH(5);break;case 6:return g.D(q,fAU(f),
0)}})},IAk=function(f,I,G){var c,P,p,e,O,N,H,x,S,u,a,k;
return g.Z(function(B){switch(B.W){case 1:c=I.retryScheduleIndex+2===3;if(G.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){B.iH(2);break}if(G.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){B.iH(0);break}n1w(I,G,c);if(G.U&&I.retryScheduleIndex+1<3)return g.D(B,Guw(f,[I]),0);p=((P=G)==null?0:P.W)?G.W:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";e={entityKey:I.action.entityKey,failureReason:p};O=void 0;g.cb(f.UH)?O="mainVideoDownloadStateEntity":g.nm(f.UH)&&(O="musicTrackDownloadMetadataEntity");
if(!O||!G.downloadState){B.iH(7);break}N=g.kw(I.action.entityKey).entityId;return g.D(B,Sp(N,O,f.W,G.downloadState),7);case 7:p0(f.Y,e);if(G.downloadState==="DOWNLOAD_STATE_FAILED"&&f.UH.j("html5_auto_retry_failed_pde_actions")){B.iH(0);break}cZ("Orchestration result is not retryable, deleting action");return g.D(B,rpU(f.W,$m(I).key),0);case 2:H=void 0;try{H=(x=G.G)==null?void 0:x.map(function(L){return f.createAction(L,I)})}catch(L){return n1w(I,G,c),S={entityKey:I.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},p0(f.Y,S),cZ("Orchestration subactions creation error",L),B.return()}n1w(I,G,c,H);if(!H){B.iH(12);break}u=H.map(function(L){return $m(L)});
a=0;case 13:if(!(a<H.length)||f.B){B.iH(15);break}return g.D(B,EZ(f.W,{mode:"readwrite",l1:!0},function(L){var K=[];K.push(Usy(L,u.slice(a,a+10),"offlineOrchestrationActionWrapperEntity"));return g.JF.all(K)}),16);
case 16:a+=10;B.iH(13);break;case 15:if(f.B)return f.B=!1,B.return();case 12:return k=$m(I),g.D(B,rpU(f.W,k.key),17);case 17:TRU(I,4),g.Bp(B)}})},eeu=function(f,I){var G,c,P,p,e,O,N,H,x,S,u,a;
return g.Z(function(k){G=[];c=Infinity;P=4E3;p=g.Y(I);for(e=p.next();!e.done;e=p.next())O=e.value,N=Number(O.enqueueTimeSec),H=chL(N),x=O.retryScheduleIndex,S=x!=null&&x>0,H>0&&S?(c=Math.min(c,N),P=Math.min(H,P)):G.push(O);isFinite(c)&&(!f.Z.isActive()||c<f.N)&&(f.N=c,f.Z.start(P));f.J.cS()||(u=G.length,G=G.filter(function(B){var L;B=((L=B.actionProto)==null?void 0:L.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!Pty.includes(B)}),a=G.length<u,!f.Z.isActive()&&a&&f.Z.start(1));
G.length>0&&p4L(f,G);return g.D(k,QGw(f),0)})},OBw=function(f){var I,G,c,P,p,e,O;
return g.Z(function(N){if(N.W==1)return g.D(N,tau(f),2);I=N.U;G=[];c=g.Y(I);for(P=c.next();!P.done;P=c.next())p=P.value,e=g.kw(p.key),O=e.entityId,m5L(f.U,O)||G.push(p);return g.D(N,eeu(f,G),0)})},chL=function(f){f=f*1E3-Date.now();
return f>4E3?4E3:f},Guw=function(f,I){var G,c,P;
return g.Z(function(p){G=g.Y(I);for(c=G.next();!c.done;c=G.next()){P=c.value;var e=void 0,O=void 0,N=((O=P.action)==null?void 0:(e=O.actionMetadata)==null?void 0:e.retryScheduleIntervalsInSeconds)||[1,2,4];e=1;P.retryScheduleIndex<N.length&&(e=N[P.retryScheduleIndex]);P.U=e*1E3+Date.now();P.retryScheduleIndex++}return g.D(p,NU2(f,I),0)})},C9Z=function(f){var I;
return g.Z(function(G){if(G.W==1)return g.D(G,QR(f.W,"offlineOrchestrationActionWrapperEntity"),2);I=G.U;return g.D(G,eeu(f,I),0)})},p4L=function(f,I){I.length!==0&&I.forEach(function(G){G=wQ(G);
G.retryScheduleIndex<3&&XVE(f.U,[G])})},tau=function(f,I){var G;
return g.Z(function(c){if(c.W==1)return g.D(c,QR(f.W,"offlineOrchestrationActionWrapperEntity",I),2);G=c.U;return c.return(G.filter(sVw))})},NU2=function(f,I){if(I.length===0)return Promise.resolve([]);
I=I.map(function(G){return $m(G)});
return V9L(f.W,I)},HBJ=function(f){this.qY=f;
this.U=void 0},xur=function(f,I){var G,c,P,p;
return g.Z(function(e){G=I.videoId;c=!0;if(I.captionTracks.length)P=qpu(I),f.U=new g.B6(f.qY,I,P);else if(I.IW)p=g.FRv(I),f.U=new g.W6(f.qY,I.IW,G,p,I.pD,I.eventId),c=I.pD;else return e.return();return e.return(new Promise(function(O){var N;(N=f.U)==null||N.Zr({YH:function(){return g.Z(function(H){if(H.W==1)return g.D(H,f.YH(G,c),2);O();g.Bp(H)})},
lw:function(){}})}))})},iBy=function(f){var I;
return g.Z(function(G){if(G.W==1)return g.D(G,QVk(f),2);I=G.U;return G.return(!!I&&I.length>0)})},rQ=function(f){g.V.call(this);
this.U=f;this.W=this.U.observe(this.Z.bind(this))},Slw=function(f,I){var G,c,P,p,e,O,N;
return g.Z(function(H){switch(H.W){case 1:if(I.length===0)return H.return([]);G=I.map(function(x){return g.lB(x,"transfer")});
return g.D(H,QR(f.U,"transfer",G),2);case 2:c=H.U;P=c.filter(sVw).map(function(x){return g.kw(x.key).entityId});
p=I.filter(function(x){return P.indexOf(x)===-1});
if(p.length===0)return H.return([]);e=g.Y(p);O=e.next();case 3:if(O.done){H.iH(5);break}N=O.value;return g.D(H,zOJ(N),4);case 4:O=e.next();H.iH(3);break;case 5:return H.return(p)}})},kuZ=function(f,I,G,c,P,p){var e,O,N;
return g.Z(function(H){e="STREAM_TYPE_UNKNOWN";G.video&&G.audio?(e="STREAM_TYPE_AUDIO_AND_VIDEO",cZ("unexpected stream type")):G.video&&!G.audio?e="STREAM_TYPE_VIDEO":!G.video&&G.audio&&(e="STREAM_TYPE_AUDIO");O=g.lB(I,"offlineVideoStreams");N={numBytesDownloaded:P.toFixed(),numTotalBytes:p.toFixed(),streamType:e,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(c),itag:e==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(G.itag):void 0};return g.D(H,EZ(f,{mode:"readwrite",l1:!0},
function(x){var S=dJ(x,O,"offlineVideoStreams"),u=dJ(x,g.lB(I,"transfer"),"transfer");return g.JF.all([S,u]).then(function(a){a=g.Y(a);var k=a.next().value;a=a.next().value;if(!a)return n2(x,O).then(function(){});
var B=uKL(k);k=aAJ(k,c,N,O);var L=TQ(x,k,"offlineVideoStreams");uKL(k)>B&&(a.lastProgressTimeMs=Date.now().toString());B=[L];a.offlineVideoStreams||(a.offlineVideoStreams=[]);a.offlineVideoStreams.indexOf(O)===-1&&(a.offlineVideoStreams.push(O),B.push(TQ(x,a,"transfer")));return g.JF.all(B)})}),0)})},lAU=function(f,I){var G,c,P,p,e;
return g.Z(function(O){if(O.W==1)return G=g.lB(I,"offlineVideoStreams"),g.D(O,C2(f,G,"offlineVideoStreams"),2);c=O.U;if(!c||!c.streamsProgress)return O.return();P=g.Y(c.streamsProgress);for(p=P.next();!p.done;p=P.next())e=p.value,e.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",e.numTotalBytes!==e.numBytesDownloaded&&(e.numBytesDownloaded=e.numTotalBytes);return g.D(O,m2(f,c,"offlineVideoStreams"),0)})},aAJ=function(f,I,G,c){if(f&&f.streamsProgress){c=f;
a:{I=I.itag+";"+I.xtags;for(var P=f.streamsProgress,p=0;p<P.length;p++){var e=JSON.parse(P[p].formatStreamBytes);if(e.itag+";"+e.xtags===I){P[p]=G;G=P;break a}}P.push(G);G=P}c.streamsProgress=G}else f={key:c,streamsProgress:[G]};return f},uKL=function(f){if(f==null?0:f.streamsProgress){var I=0;
f=f.streamsProgress;for(var G=0;G<f.length;G++){var c=f[G];isNaN(Number(c.numBytesDownloaded))?cZ("stream progress bytes number invalid"):I+=Number(c.numBytesDownloaded)}return I}return 0},w4$=function(f,I,G,c){g.V.call(this);
var P=this;this.W=f;this.api=I;this.jF=G;this.WH=c;this.J=new g.b_;this.G=new g.b9(function(){P.U&&P.U.transferState==="TRANSFER_STATE_TRANSFERRING"&&P.J.cS()&&((P.U.transferRetryCount||0)<3?Rt(P.Y,P.B,!1,!1):gQ(P.Y,P.B.videoDetails.videoId),P.v$("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.uH=this.cH=0;this.T=this.N=!1;this.vH=g.YH(this.api.X().experiments,"html5_transfer_processing_logs_interval");this.lH=new g.yE(this);this.GY={dAw:function(){return P.G},
a$Y:function(){return P.WH},
I1:function(){return P.J}};
this.rb=this.W.observe(this.qF.bind(this));this.Y=new U5w(I,this);this.zq=new HBJ(I);this.It=new rQ(this.W);this.hs=this.J.listen("publicytnetworkstatus-online",this.NI.bind(this));this.LZ=this.J.listen("publicytnetworkstatus-offline",this.qqH.bind(this));this.T=this.api.X().j("html5_less_transfer_processing_logs");g.r(this,this.lH);this.lH.C(I,"offlinetransferpause",this.jDM);g.cb(this.api.X())?this.Z="mainVideoDownloadStateEntity":g.nm(this.api.X())&&(this.Z="musicTrackDownloadMetadataEntity")},
$uk=function(f){return g.Z(function(I){if(I.W==1)I=g.D(I,msw(),2);
else{var G=f.It;var c=g.ZU();c=Object.keys(c);G=Slw(G,c);I=g.D(I,G,0)}return I})},dQ=function(f,I){I=I===void 0?!1:I;
var G;return g.Z(function(c){if(c.W==1){if(f.U)throw Error("Already downloading a video");f.uH=0;f.N=!1;return g.D(c,YlJ(f),2)}return c.W!=4?(G=c.U,BlE(f.jF,!G),G&&f.J.cS()?I?g.D(c,new Promise(function(P){g.$0(P,1E3)}),4):c.iH(4):(!G&&f.U&&vZ(f),c.iH(0))):g.D(c,BU$(f,G),0)})},LH$=function(f){return g.Z(function(I){if(I.W==1)return f.B?g.D(I,gQ(f.Y,f.B.videoDetails.videoId),3):I.iH(0);
vZ(f);g.Bp(I)})},WHy=function(f,I){var G,c,P;
return g.Z(function(p){switch(p.W){case 1:return g.LY(p,2),(G=!!I.captionTracks.length||!!I.IW)?g.D(p,iBy(I.videoId),4):p.return();case 4:return(c=p.U)?p.return():g.D(p,xur(f.zq,I),5);case 5:g.KY(p,0);break;case 2:P=g.UU(p),cZ("Caption downloading error",P,I.cotn),g.Bp(p)}})},BU$=function(f,I){var G,c,P,p,e,O;
return g.Z(function(N){switch(N.W){case 1:if(f.N)return N.return();f.N=!0;f.U=I;G=g.kw(f.U.key);c=G.entityId;P=void 0;if(f.U.transferState==="TRANSFER_STATE_TRANSFERRING")return g.D(N,yH(f,c),7);if(f.U.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||f.U.transferRetryCount||f.U.hasLoggedFirstStarted){N.iH(3);break}return g.D(N,yH(f,c),5);case 5:return P=N.U,f.U.hasLoggedFirstStarted=!0,g.D(N,oyk(f),6);case 6:WkU({videoId:c,MW:f.U,offlineModeType:P},void 0,void 0,!0);N.iH(3);break;case 7:P=N.U,
Oo({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:c,MW:f.U,offlineModeType:P});case 3:return g.D(N,qlk(f),8);case 8:return p=null,g.LY(N,9),g.D(N,jxy(f,I),11);case 11:p=N.U;f.B=p;g.KY(N,10);break;case 9:return e=g.UU(N),cZ("error getting player response",e,I.cotn),g.D(N,f.v$("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return N.return();case 10:return O=zjE(f.api.X(),I.cotn,p),g.D(N,WHy(f,O),13);case 13:return g.D(N,hOU(O.videoId),
14);case 14:O.g5=N.U,ZML(f.Y,O,I.maximumDownloadQuality),f.G.start(108E5),g.Bp(N)}})},YlJ=function(f){var I,G;
return g.Z(function(c){if(c.W==1)return g.D(c,QR(f.W,"transfer"),2);I=c.U;G=I.filter(KHy).sort(Jh$);return G.length===0?c.return():c.return(G[0])})},qlk=function(f){var I,G,c;
return g.Z(function(P){if(P.W==1){if(!f.U)return AV(f,"onTransferStart"),P.return();f.G.start(108E5);return g.D(P,TE(f,"TRANSFER_STATE_TRANSFERRING"),2)}I=f.U;return(c=((G=I)==null?0:G.key)?g.kw(I.key).entityId:"")&&f.Z?g.D(P,Sp(c,f.Z,f.W,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):P.iH(0)})},D52=function(f){var I,G,c,P;
g.Z(function(p){switch(p.W){case 1:if(!f.U){AV(f,"onTransferPausedByUser");p.iH(2);break}I=f.U;f.G.stop();return g.D(p,TE(f,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:c=((G=I)==null?0:G.key)?g.kw(I.key).entityId:"";if(!c||!f.Z){p.iH(4);break}return g.D(p,Sp(c,f.Z,f.W,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.D(p,yH(f,c),6);case 6:P=p.U,qDy({videoId:c,MW:I,offlineModeType:P});case 2:vZ(f),dQ(f),g.Bp(p)}})},FB2=function(f){var I,G,c;
g.Z(function(P){if(P.W==1){if(!f.U)return AV(f,"onTransferPausedByNetwork"),P.return();f.G.stop();return g.D(P,TE(f,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(P.W!=3)return I=f.U,(c=((G=I)==null?0:G.key)?g.kw(I.key).entityId:"")&&f.Z?g.D(P,Sp(c,f.Z,f.W,"DOWNLOAD_STATE_PAUSED"),3):P.iH(3);vZ(f);g.Bp(P)})},Uuk=function(f){var I,G,c,P,p;
g.Z(function(e){switch(e.W){case 1:if(!f.U)return AV(f,"onTransferComplete"),e.return();I=f.U;f.G.stop();if(!I||!f.B){e.iH(2);break}G=zjE(f.api.X(),I.cotn,f.B);return g.D(e,WHy(f,G),2);case 2:return g.D(e,TE(f,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:P=((c=I)==null?0:c.key)?g.kw(I.key).entityId:"";if(!P||!f.Z){e.iH(5);break}return g.D(e,Sp(P,f.Z,f.W,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.D(e,lAU(f.W,P),7);case 7:return g.D(e,yH(f,P),8);case 8:p=e.U,Oo({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:P,MW:I,offlineModeType:p}),vZ(f),dQ(f),g.Bp(e)}})},zeZ=function(f,I,G){var c,P;
g.Z(function(p){switch(p.W){case 1:if(!f.U)return AV(f,"onTransferProgress: "+I),p.return();if(f.U.transferState==="TRANSFER_STATE_TRANSFERRING"){p.iH(2);break}return g.D(p,qlk(f),2);case 2:c=Date.now();if(!(c-f.cH>1E3)){p.iH(4);break}f.cH=c;return g.D(p,kuZ(f.W,G.videoId,G.W,G.qQ,G.bytesDownloaded,G.U),5);case 5:if(f.T&&!(f.T&&c-f.uH>f.vH)){p.iH(4);break}f.uH=c;return g.D(p,yH(f,I),7);case 7:P=p.U,WkU({videoId:I,MW:f.U,offlineModeType:P},G.bytesDownloaded,G.U);case 4:f.G.start(108E5),g.Bp(p)}})},
heu=function(f){var I=(f.U.transferRetryCount||0)<3;
I&&(f=f.U,f.transferRetryCount=(f.transferRetryCount||0)+1);return I},MaJ=function(f,I){I=I===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":I;
var G,c,P,p;return g.Z(function(e){if(e.W==1)return f.U||AV(f,"setTransferToFailed: "+I),G="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",I==="TRANSFER_FAILURE_REASON_NETWORK"?G="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":I==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(G="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.D(e,TE(f,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",I),2);if(e.W!=3)return p0(f.WH,{entityKey:(c=f.U)==null?void 0:c.key,failureReason:G}),
P=f.U?g.kw(f.U.key).entityId:"",g.D(e,yH(f,P),3);p=e.U;var O={videoId:P,MW:f.U,offlineModeType:p},N=I,H={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};N&&(H.transferFailureReason=N,H.failureReason=jgk(N));Oo(H,O);g.Bp(e)})},TE=function(f,I,G,c){var P;
return g.Z(function(p){if(p.W==1){if(!f.U)return AV(f,"saveTransferState: "+I),p.return();f.U.transferState=I;f.U.failureReason=c;g.LY(p,2);return g.D(p,oyk(f,function(e){return G?yR(e,"offlineVideoStreams",f.U.offlineVideoStreams).then(function(O){for(var N=g.Y(O),H=N.next();!H.done;H=N.next())if((H=H.value)&&H.streamsProgress){H=g.Y(H.streamsProgress);for(var x=H.next();!x.done;x=H.next())x.value.streamState=G}return Usy(e,O.filter(function(S){return!!S}),"offlineVideoStreams")}):g.JF.resolve(void 0)}),
4)}if(p.W!=2)return g.KY(p,0);
P=g.UU(p);return P instanceof g.BG&&P.type==="QUOTA_EXCEEDED"?g.D(p,f.v$("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):p.iH(0)})},oyk=function(f,I){var G;
return g.Z(function(c){if(!f.U)return c.return();G=f.U;return g.D(c,EZ(f.W,{mode:"readwrite",l1:!0},function(P){var p=[TQ(P,G,"transfer")];I&&p.push(I(P));return g.JF.all(p)}),0)})},vZ=function(f){f.U=void 0;
f.B=void 0;f.G.stop()},jxy=function(f,I){var G,c,P,p,e;
return g.Z(function(O){if(O.W==1)return G=g.kw(I.key),c=G.entityId,P=g.lB(c,"playbackData"),g.D(O,C2(f.W,P,"playbackData"),2);p=O.U;if((e=p)==null?0:e.playerResponseJson)return O.return(JSON.parse(p.playerResponseJson));throw Error("No PlayerResponse found");})},AV=function(f,I){f.api.pZ("woffle",{mcte:I});
cZ("missing current transfer entity.")},yH=function(f,I){var G,c,P;
return g.Z(function(p){if(p.W==1)return g.D(p,C2(f.W,g.lB(I,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);G=p.U;return p.return((P=(c=G)==null?void 0:c.offlineModeType)!=null?P:void 0)})},KHy=function(f){return Duk[f.transferState]!==void 0},Jh$=function(f,I){var G=Duk[f.transferState],c=Duk[I.transferState];
return G!==c?G-c:Number(f.enqueuedTimestampMs)-Number(I.enqueuedTimestampMs)},n0=function(f,I){var G=this;
this.UH=f;this.api=I;this.J=new g.b_;this.B=new g.ag;this.GY={Z1:function(){return G.Z.GY.Z1()},
I1:function(){return G.J},
bVY:function(){return G.Z},
y0:function(){return G.y0()},
cq:function(){return G.cq()},
kS:function(){return G.kS()},
x8:function(){return G.x8()},
LU:function(){return G.LU()},
ll:function(c){return G.ll(c)}};
this.Z=new l_w(function(){return FHJ(G)},function(){G.kS()},this.api.Jk(),this.api.j.bind(this.api));
this.U=new PZ(this.api);wf7(this.Z)},FHJ=function(f){return g.Z(function(I){f.api.Xw("onOrchestrationBecameLeader");
return g.D(I,f.cq(),0)})},gyE=function(f){var I,G;
return g.Z(function(c){if(c.W==1)return g.D(c,b3(),2);if(c.W!=3){I=c.U;if(!I)return cZ("PES is undefined"),c.return();f.W=new w4$(I,f.api,f.Z,f.U);G=f.qd(I);return g.D(c,bM$(I,G,f.Z,f.U,f.UH),3)}f.Y=c.U;return g.D(c,ZBL(f),0)})},ZBL=function(f){var I;
return g.Z(function(G){switch(G.W){case 1:if(!f.W)return cZ("transferManager is undefined"),G.return();if(f.W.U){G.iH(2);break}return g.D(G,dQ(f.W),2);case 2:if(!f.UH.j("woffle_enable_main_downloads_library")){G.iH(4);break}return g.D(G,f.hM(),4);case 4:if(!f.UH.j("html5_offline_playback_position_sync")){G.iH(6);break}return g.D(G,f.HL(),7);case 7:return g.D(G,f.ll(864E5),6);case 6:return g.D(G,f.refreshAllStaleEntities(43200,!0),9);case 9:return g.D(G,f.qK(),10);case 10:if(!f.UH.j("html5_retry_downloads_for_expiration")){G.iH(11);
break}return g.D(G,f.LU(),11);case 11:return f.N=g.Y0(function(){f.refreshAllStaleEntities(43200,!0);f.qK()},9E5),g.GK(g.PG(),function(){return f.x8()}),g.D(G,b3(),13);
case 13:return I=G.U,g.D(G,kn$(I),14);case 14:$0V(f.Z),g.Bp(G)}})},Rek=function(){var f,I,G,c,P,p;
return g.Z(function(e){switch(e.W){case 1:return g.D(e,b3(),2);case 2:f=e.U;if(!f)return e.return([]);I=Date.now()/1E3;return g.D(e,QR(f,"offlineVideoPolicy"),3);case 3:G=e.U,c=g.Y(G),P=c.next();case 4:if(P.done){e.iH(6);break}p=P.value;if(!(p.expirationTimestamp&&Number(p.expirationTimestamp)<I)){e.iH(5);break}p.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";p.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.D(e,m2(f,p,"offlineVideoPolicy"),5);
case 5:P=c.next();e.iH(4);break;case 6:return e.return(G.map(function(O){return O.key}))}})},so=function(f,I,G,c,P){var p,e,O;
return g.Z(function(N){if(N.W==1)return g.D(N,b3(),2);p=N.U;if(!p)return N.return([]);e=I.map(function(H){var x=g.lB(H,G);x={actionType:c,entityKey:x,actionMetadata:Object.assign({},hjU(),P)};c!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(x.actionMetadata.priority=0);H=new lQ(G,H,x);return $m(H)});
O=V9L(p,e);wf7(f.Z);return N.return(O)})},VaZ=function(f,I,G,c){var P,p,e,O,N,H,x,S;
return g.Z(function(u){switch(u.W){case 1:P=[],p=g.Y(I),e=p.next();case 2:if(e.done){u.iH(4);break}O=e.value;if(O.upToDate||G&&!O.shouldAutoSyncMetadata||!O.playlistId){u.iH(3);break}N={};switch(c){case "mainPlaylistEntity":H={nextAutoRefreshIntervalSeconds:O.checkInSeconds,autoSync:G};N={mainPlaylistEntityActionMetadata:H};break;case "musicPlaylist":x={autoSync:G},N={musicPlaylistEntityActionMetadata:x}}return g.D(u,so(f,[O.playlistId],c,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",N),6);case 6:(S=
u.U)&&P.push.apply(P,g.J(S));case 3:e=p.next();u.iH(2);break;case 4:return u.return(P)}})},rhw=function(f,I){var G;
return g.Z(function(c){return I.length?(G=hjU(),g.nq(G,Fy,{isEnqueuedForExpiredStreamUrlRefetch:!0}),f.api.pZ("qrd",{v:I.length}),c.return(so(f,I,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",G))):c.return([])})},vyw=function(f,I,G){this.U=f;
this.UH=I;this.Z=G},AhL=function(f,I){var G,c,P,p,e,O,N,H,x,S,u,a,k,B,L,K,q;
return g.Z(function(h){switch(h.W){case 1:return G=NK(I),c=g.kw(I.entityKey),P=c.entityId,p=[],g.LY(h,2),g.D(h,duZ(f,P),4);case 4:p=h.U;if(!(f.UH.j("woffle_enable_main_downloads_library")&&((e=p)==null?0:e.length))){h.iH(5);break}return g.D(h,TlL(f.U,[I.entityKey]),5);case 5:g.KY(h,3);break;case 2:return O=g.UU(h),N="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",H="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",O instanceof g.BG&&O.type==="QUOTA_EXCEEDED"?(N="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
H="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):cZ("Playlist add error"),h.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,N,H));case 3:x=[];if(!f.UH.j("html5_offline_prevent_redownload_downloaded_video")){h.iH(7);break}return g.D(h,U0w(f.U,"mainVideoEntity",p),8);case 8:p=h.U;case 7:if((S=p)==null?0:S.length)for(u=g.Y(p),a=u.next();!a.done;a=u.next())if(k=a.value,B=k.offlineVideoData,L=void 0,(L=B)==null?0:L.videoId)K=void 0,q=Number(((K=I.actionMetadata)==null?void 0:K.priority)||
0)+1,x.push(MK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",B.videoId,"mainVideoEntity",q,Xy,yhL(I,B,P)));return h.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,x))}})},nyJ=function(f,I){var G,c,P,p,e,O,N,H,x,S,u,a,k,B,L,K,q,h,F,v,E,n,GT,Pp,fY,eM,C,kd,qv,FB,Y7,OJ,JT,jM,Pw,W,OU,nU,BL,UJ,au,vp,Fk,zV,U,z,M,R,y,Wp,I7,wS,cp,zT,mQ,Ww,LV,D2,m4,sd,Cn,Bl,S_,DZ,wb,Fn,nX,sp,KL,pz,QD,e8,Ui,Ec;
return g.Z(function(a1){switch(a1.W){case 1:return G=NK(I),c=I.entityKey,P=g.kw(c).entityId,p=[],e=!1,P==="!*$_ALL_ENTITIES_!*$"?(e=!0,g.D(a1,QR(f.U,"mainPlaylistEntity"),5)):g.D(a1,C2(f.U,c,"mainPlaylistEntity"),4);case 4:(O=a1.U)&&p.push(O);a1.iH(3);break;case 5:p=a1.U;case 3:if((N=p)==null||!N.length)return a1.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));H=g.d(I.actionMetadata,TU2);S=(x=H)==null?void 0:x.nextAutoRefreshIntervalSeconds;a=(u=H)==null?void 0:u.autoSync;k=[];L=B=
!0;K=!1;if(!e&&a===!1){a1.iH(6);break}g.LY(a1,7);return g.D(a1,pVw(0,!!a,!0,p),9);case 9:k=a1.U;g.KY(a1,8);break;case 7:q=g.UU(a1);if(!(q instanceof Error&&q.message==="No data")){q instanceof Error&&q.message==="Empty response body"&&cZ(q.message);a1.iH(8);break}return P==="!*$_ALL_ENTITIES_!*$"?g.D(a1,Vzy(f.U,I,f.Z,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.D(a1,gPZ(P,f.U,I,f.Z),8);case 8:if(!k.length||!e&&k[0].playlistId!==P)return a1.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G));case 6:if(e){h=[];F=g.Y(k);for(v=F.next();!v.done;v=F.next())E=v.value,E.upToDate||a&&!E.shouldAutoSyncMetadata||!E.playlistId||(n={nextAutoRefreshIntervalSeconds:E.checkInSeconds,autoSync:a},h.push(MK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",E.playlistId,"mainPlaylistEntity",0,Xy,{mainPlaylistEntityActionMetadata:n})));return a1.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,h))}k.length&&(GT=k[0],K=!!GT.upToDate,a&&(B=(Pp=GT.shouldAutoSyncMetadata)!=null?Pp:!0,L=(fY=GT.shouldAutoSyncVideos)!=
null?fY:!0,GT.checkInSeconds&&(S=GT.checkInSeconds)));if(K||!B)return a1.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));eM=[];C=p[0];if(!C.downloadState){kd=void 0;a1.iH(15);break}return g.D(a1,C2(f.U,C.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:kd=a1.U;case 15:return qv=kd,Y7=((FB=qv)==null?0:FB.addedTimestampMillis)?String(qv.addedTimestampMillis):void 0,g.LY(a1,17),g.D(a1,duZ(f,P,Y7,S),19);case 19:eM=a1.U;g.KY(a1,18);break;case 17:OJ=g.UU(a1);if(!(OJ instanceof
Error&&OJ.message==="No data for playlist")){if(OJ instanceof Error&&OJ.message==="Empty response body for playlist")cZ(OJ.message);else return JT="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",jM="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",OJ instanceof g.BG&&OJ.type==="QUOTA_EXCEEDED"&&(JT="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",jM="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),a1.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,JT,jM));
a1.iH(18);break}return g.D(a1,gPZ(P,f.U,I,f.Z),18);case 18:if(!L)return a1.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));Pw=[];W=new Map;if((OU=eM)==null?0:OU.length)for(nU=g.Y(eM),BL=nU.next();!BL.done;BL=nU.next())UJ=BL.value,au=UJ.offlineVideoData,vp=void 0,((vp=au)==null?0:vp.videoId)&&W.set(au.videoId,au);Fk=new Map;zV=[];if((U=C)==null?0:(z=U.videos)==null?0:z.length)for(M=g.Y(C.videos),R=M.next();!R.done;R=M.next())if(y=R.value,Wp=JSON.parse(g.kw(y).entityId),I7=Wp.videoId)W.has(I7)?
(Fk.set(I7,W.get(I7)),W.delete(I7)):zV.push(I7);cp=Number(((wS=I.actionMetadata)==null?void 0:wS.priority)||0)+1;zT=g.Y(W.entries());for(mQ=zT.next();!mQ.done;mQ=zT.next())Ww=mQ.value,LV=g.Y(Ww),D2=LV.next().value,m4=LV.next().value,sd=D2,Cn=m4,Pw.push(MK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",sd,"mainVideoEntity",cp,Xy,yhL(I,Cn,P)));Bl=g.Y(Fk.entries());for(S_=Bl.next();!S_.done;S_=Bl.next())DZ=S_.value,wb=g.Y(DZ),Fn=wb.next().value,nX=wb.next().value,sp=Fn,KL=nX,Pw.push(MK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
sp,"mainVideoEntity",cp,Xy,yhL(I,KL,P)));pz=g.Y(zV);for(QD=pz.next();!QD.done;QD=pz.next())e8=QD.value,Ui={playlistId:P},Ec={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:Ui},Pw.push(MK("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",e8,"mainVideoEntity",0,Xy,Ec));return a1.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,Pw))}})},sx$=function(f,I){var G,c,P,p;
return g.Z(function(e){switch(e.W){case 1:return G=NK(I),g.LY(e,2),c=g.kw(I.entityKey).entityId,c==="!*$_ALL_ENTITIES_!*$"?g.D(e,Vzy(f.U,I,f.Z,(P=I.actionMetadata)==null?void 0:(p=P.offlineLoggingData)==null?void 0:p.offlineDeleteReason),5):g.D(e,gPZ(c,f.U,I,f.Z),6);case 6:if(!f.UH.j("woffle_enable_main_downloads_library")){e.iH(5);break}return g.D(e,nP2(f.U,I.entityKey),5);case 5:g.KY(e,3);break;case 2:return g.UU(e),e.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return e.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G))}})},duZ=function(f,I,G,c){var P,p,e,O,N,H,x;
return g.Z(function(S){switch(S.W){case 1:return g.D(S,c3k([I]),2);case 2:return P=S.U,g.D(S,X4w(f,P[0],G,c),3);case 3:return p=S.U,e=p.mainPlaylistEntity,O=p.CyH,H=FkL(e,(N=O)==null?void 0:N.avatar),g.LY(S,4),g.D(S,BZ(H),6);case 6:g.KY(S,5);break;case 4:x=g.UU(S),x instanceof Error&&x.message==="Failed to fetch"&&cZ(x.message);case 5:return S.return(P[0].videos)}})},X4w=function(f,I,G,c){var P,p,e,O,N,H,x,S,u,a,k,B,L,K,q,h,F;
return g.Z(function(v){switch(v.W){case 1:P=Date.now().toString();G||(G=P);p=I.videos;e=I.playlistId;O=[];N=[];if(p)for(H=g.Y(p),x=H.next();!x.done;x=H.next()){S=x.value;u=S.offlineVideoData;if(!u||!u.videoId)throw cZ("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");a=u.videoId;k={videoId:a,playlistId:e};B={id:g.lB(JSON.stringify(k),"mainPlaylistVideoEntity"),video:g.lB(a,"mainVideoEntity")};O.push(B);N.push(B.id)}K={key:g.lB(e,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:G,lastSyncedTimestampMillis:P};q={key:g.lB(e,"mainPlaylistEntity"),playlistId:e,videos:N,title:I.title,thumbnailStyleData:Ey7(I),visibility:muu(I),downloadState:K.key};I.channel&&(h=I.channel.offlineChannelData,L=CtL(g.lB(e,"ytMainChannelEntity"),h),q.channelOwner=L.id);((F=q)==null?0:F.entityMetadata)?(q.entityMetadata.offlineLastModifiedTimestampSeconds=I.lastModifiedTimestamp,c&&(q.entityMetadata.nextAutoRefreshIntervalSeconds=String(c))):q&&(q.entityMetadata={nextAutoRefreshIntervalSeconds:c?
String(c):void 0,offlineLastModifiedTimestampSeconds:I.lastModifiedTimestamp});g.LY(v,2);return g.D(v,EZ(f.U,{mode:"readwrite",l1:!0},function(E){var n=TQ(E,q,"mainPlaylistEntity"),GT=TQ(E,K,"mainPlaylistDownloadStateEntity");n=[n,GT];GT=g.Y(O);for(var Pp=GT.next();!Pp.done;Pp=GT.next())n.push(TQ(E,Pp.value,"mainPlaylistVideoEntity"));L&&n.push(TQ(E,L,"ytMainChannelEntity"));return g.JF.all(n)}),4);
case 4:g.KY(v,3);break;case 2:throw g.UU(v),cZ("PES failure for playlist"),Error("PES failure for playlist");case 3:return v.return({mainPlaylistEntity:q,CyH:L,tBb:O})}})},CtL=function(f,I){return{id:f,
channelId:I.channelId,title:I.title,avatar:I.thumbnail}},Ey7=function(f){var I=[],G=f.videos;
G&&G.length>0&&I.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:G[0].offlineVideoData.thumbnail}}});if((f=f.additionalMetadadatas)&&f.length>0)for(f=g.Y(f),G=f.next();!G.done;G=f.next()){var c=G.value.offlineBundleItemPlaylistData,P=void 0;G=(P=c)==null?void 0:P.style;P=void 0;c={collageThumbnail:{coverThumbnail:(P=c)==null?void 0:P.coverThumbnail}};switch(G){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":I.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:c});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":I.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:c});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":I.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:c});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":I.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:c})}}return I},muu=function(f){switch(f.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},yhL=function(f,I,G){I={offlineVideoData:I,
playlistId:G};if(f=g.d(f.actionMetadata,TU2))I.maximumDownloadQuality=f.maximumDownloadQuality;return{mainVideoEntityActionMetadata:I}},Qxw=function(f,I,G){this.U=f;
this.UH=I;this.Z=G},Iuu=function(f,I){var G,c,P,p,e,O,N,H,x,S,u,a,k;
return g.Z(function(B){switch(B.W){case 1:return G=NK(I),c=g.kw(I.entityKey),P=c.entityId,p=g.d(I.actionMetadata,Eo),O=!((e=p)==null?0:e.playlistId),g.LY(B,2),g.D(B,bBZ(f,P,void 0,(N=p)==null?void 0:N.offlineVideoData,O),4);case 4:g.KY(B,3);break;case 2:return H=g.UU(B),x="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",H instanceof g.BG&&H.type==="QUOTA_EXCEEDED"&&(x="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
B.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,x,S));case 3:u=1;u=Number(((a=I.actionMetadata)==null?void 0:a.priority)||0)+1;var L=(L=g.d(I.actionMetadata,Eo))?{playbackDataActionMetadata:{maximumDownloadQuality:L.maximumDownloadQuality}}:void 0;k=MK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",P,"playbackData",u,fu7,L);return B.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,[k]))}})},GMU=function(f,I){var G,c,P,p,e,O,N,H,x,S,u,a,k,B,L,K,q;
return g.Z(function(h){switch(h.W){case 1:return G=NK(I),c=g.kw(I.entityKey),P=c.entityId,g.D(h,C2(f.U,I.entityKey,"mainVideoEntity"),2);case 2:p=h.U;if(!p){e=void 0;h.iH(3);break}return g.D(h,C2(f.U,p.downloadState,"mainVideoDownloadStateEntity"),4);case 4:e=h.U;case 3:O=e;if(!p||!O)return h.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));g.LY(h,5);return g.D(h,bBZ(f,P,O.addedTimestampMillis,(H=g.d(I.actionMetadata,Eo))==null?void 0:H.offlineVideoData),7);case 7:x=1;x=Number(((S=
I.actionMetadata)==null?void 0:S.priority)||0)+1;N=MK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",P,"playbackData",x,fu7);g.KY(h,6);break;case 5:u=g.UU(h);if(!(u instanceof Error&&u.message==="No data")){if(u instanceof Error&&u.message==="Empty response body")cZ(u.message);else return a="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",k="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",u instanceof g.BG&&u.type==="QUOTA_EXCEEDED"&&(a="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
k="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),h.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,a,k));h.iH(6);break}return g.D(h,ot(f.U,P),9);case 9:B=h.U;L=g.d(I.actionMetadata,Eo);if(q=(K=L)==null?void 0:K.playlistId)B.playlistId=q;B.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.D(h,L0(P,f.U,I,f.Z,B),6);case 6:return h.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,N?[N]:void 0))}})},cn7=function(f,I){var G,c,P,p,e,O,N,H,x,S;
return g.Z(function(u){switch(u.W){case 1:return G=NK(I),g.LY(u,2),c=g.kw(I.entityKey).entityId,c==="!*$_ALL_ENTITIES_!*$"?g.D(u,Vzy(f.U,I,f.Z,(x=I.actionMetadata)==null?void 0:(S=x.offlineLoggingData)==null?void 0:S.offlineDeleteReason),5):g.D(u,ot(f.U,c),6);case 6:P=u.U;p=g.d(I.actionMetadata,Eo);if(O=(e=p)==null?void 0:e.playlistId)P.playlistId=O;P.offlineDeleteReason=(N=I.actionMetadata)==null?void 0:(H=N.offlineLoggingData)==null?void 0:H.offlineDeleteReason;return g.D(u,L0(c,f.U,I,f.Z,P),7);
case 7:if(!f.UH.j("woffle_enable_main_downloads_library")){u.iH(5);break}return g.D(u,nP2(f.U,I.entityKey),5);case 5:g.KY(u,3);break;case 2:return g.UU(u),u.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return u.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G))}})},bBZ=function(f,I,G,c,P){var p,e,O,N,H,x;
return g.Z(function(S){switch(S.W){case 1:if(p=c){S.iH(2);break}return g.D(S,GUE([I]),3);case 3:e=S.U,p=e[0];case 2:return g.D(S,PFk(f,p,G,P),4);case 4:O=S.U;N=O.mainVideoEntity;H=O.channelEntity;g.LY(S,5);var u=km(N.thumbnail),a=km(H.avatar);return g.D(S,BZ(u.concat(a)),7);case 7:g.KY(S,0);break;case 5:x=g.UU(S),x instanceof Error&&x.message==="Failed to fetch"&&cZ(x.message),g.Bp(S)}})},PFk=function(f,I,G,c){var P,p,e,O,N,H,x,S,u,a,k,B,L;
return g.Z(function(K){switch(K.W){case 1:G||(G=Date.now().toString());p=(P=I.channel)==null?void 0:P.offlineChannelData;e={id:g.lB(I.videoId,"ytMainChannelEntity"),channelId:p.channelId,title:p.title,avatar:p.thumbnail};O={key:g.lB(I.videoId,"mainVideoDownloadStateEntity"),playbackData:g.lB(I.videoId,"playbackData"),addedTimestampMillis:G,videoDownloadContextEntity:g.lB(I.videoId,"videoDownloadContextEntity")};N={key:g.lB(I.videoId,"videoPlaybackPositionEntity"),videoId:I.videoId,lastPlaybackPositionSeconds:"0"};
f.UH.j("html5_offline_playback_position_sync")&&(H={playbackPosition:N.key});x=g.lB(I.videoId,"mainVideoEntity");S={key:x,videoId:I.videoId,title:I.title,thumbnail:I.thumbnail,localizedStrings:{viewCount:I.shortViewCountText},userState:H,lengthSeconds:I.lengthSeconds?Number(I.lengthSeconds):void 0,publishedTimestampMillis:I.publishedTimestamp?(Number(I.publishedTimestamp)*1E3).toString():void 0,formattedDescription:I.description,owner:e.id,downloadState:O.key};if(!f.UH.j("woffle_enable_main_downloads_library")||
!c){K.iH(2);break}return g.D(K,AXZ(f.U,[x]),3);case 3:if(k=K.U)u=k.mainDownloadsLibraryEntity,a=k.mainDownloadsListEntity;case 2:return L=JXy,B={key:g.lB(I.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.nq(O,L,B),g.D(K,EZ(f.U,{mode:"readwrite",l1:!0},function(q){var h=TQ(q,e,"ytMainChannelEntity"),F=TQ(q,O,"mainVideoDownloadStateEntity"),v=TQ(q,S,"mainVideoEntity");h=[h,F,v];f.UH.j("html5_offline_playback_position_sync")&&(F=TQ(q,N,"videoPlaybackPositionEntity"),
h.push(F));u&&(F=TQ(q,u,"mainDownloadsLibraryEntity"),h.push(F));a&&(F=TQ(q,a,"mainDownloadsListEntity"),h.push(F));B&&(q=TQ(q,B,"downloadStatusEntity"),h.push(q));return g.JF.all(h)}),4);
case 4:return K.return({mainVideoEntity:S,channelEntity:e})}})},pEu=function(f,I,G){this.U=f;
this.UH=I;this.Z=G},tIU=function(f,I){var G,c,P,p,e,O,N,H,x,S,u,a,k,B,L,K,q,h,F,v,E,n,GT,Pp,fY,eM,C;
return g.Z(function(kd){switch(kd.W){case 1:return G=NK(I),c=[],g.D(kd,VR.getInstance(),2);case 2:P=kd.U;if(!P){kd.iH(3);break}return g.D(kd,P.get("sdois"),4);case 4:return p=kd.U,g.D(kd,(O=P)==null?void 0:O.get("lmqf"),5);case 5:e=kd.U;case 3:g.LY(kd,6);if(p===void 0)throw Error("prefStorage or opt-in state is undefined");N=[];if(p){kd.iH(8);break}return g.D(kd,yXw(f.U),9);case 9:N=kd.U,N.reverse();case 8:if(!N.length){kd.iH(10);break}H=g.Y(N);x=H.next();case 11:if(x.done){kd.iH(10);break}S=x.value;
if(!S){kd.iH(12);break}u=g.kw(S).entityId;return g.D(kd,ot(f.U,u),14);case 14:return a=kd.U,a.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.D(kd,L0(u,f.U,{entityKey:S,actionType:I.actionType},f.Z,a),12);case 12:x=H.next();kd.iH(11);break;case 10:return g.D(kd,ty7(p,(k=e)!=null?k:"SD"),16);case 16:return B=kd.U,g.D(kd,rXu(B),17);case 17:L=d0V(B);if(!f.UH.j("woffle_enable_main_downloads_library")){kd.iH(18);break}if(p){kd.iH(19);break}return g.D(kd,nP2(f.U,g.g9),19);case 19:return g.D(kd,
TlL(f.U,[g.g9]),18);case 18:if((K=L)==null?0:K.length)for(q=g.Y(L),h=q.next();!h.done;h=q.next())if(v=F=h.value,E=v.actionType,n=v.entityKey,GT=v.actionMetadata,E&&n&&GT&&!g.d(GT,eKw)){E==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(GT.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(Pp=g.d(F.actionMetadata,Eo))Pp.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",F.actionMetadata=Object.assign({},F.actionMetadata,{mainVideoEntityActionMetadata:Pp});c.push(F)}g.KY(kd,
7);break;case 6:return fY=g.UU(kd),eM="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",fY instanceof g.BG&&fY.type==="QUOTA_EXCEEDED"&&(eM="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),kd.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,eM,C));case 7:return kd.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,c))}})},OOU=function(){n0.apply(this,
arguments);
this.T="mainVideoEntity"},NCU=function(f,I,G){I=I===void 0?43200:I;
G=G===void 0?!0:G;var c=c===void 0?!1:c;var P,p,e;return g.Z(function(O){switch(O.W){case 1:if(!f.J.cS())return O.return([]);P=[];g.LY(O,2);return g.D(O,pVw(I,G,c),4);case 4:P=O.U;g.KY(O,3);break;case 2:p=g.UU(O),p instanceof Error&&p.message==="No data"||p instanceof Error&&p.message==="Empty response body"&&cZ(p.message);case 3:return e=VaZ(f,P,G,"mainPlaylistEntity"),O.return(e)}})},HO$=function(f,I,G,c){c=c===void 0?!1:c;
var P,p,e,O,N,H,x,S,u,a,k,B,L,K,q;return g.Z(function(h){switch(h.W){case 1:return P=[],g.D(h,eO$(),2);case 2:return(p=h.U)||c?g.D(h,OML(I,G),3):h.return([]);case 3:e=h.U;if((O=e)==null||!O.length)return h.return([]);N={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};H=g.Y(e);x=H.next();case 4:if(x.done){h.iH(6);break}u=S=x.value;a=u.actionType;k=u.entityKey;B=u.actionMetadata;if(!(a&&k&&B)||g.d(B,eKw)){h.iH(5);break}a==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(B.offlineLoggingData=
N);L=g.kw(k);K=L.entityId;return g.D(h,so(f,[K],"mainVideoEntity",a,B),8);case 8:q=h.U,P=P.concat(q);case 5:x=H.next();h.iH(4);break;case 6:return h.return(P)}})},xWr=function(f,I){this.U=f;
this.Z=I},ScU=function(f,I){var G,c,P,p,e,O,N,H,x,S,u,a,k,B,L,K;
return g.Z(function(q){switch(q.W){case 1:return G=NK(I),c=g.kw(I.entityKey),P=c.entityId,p=[],g.LY(q,2),g.D(q,iOE(f,P),4);case 4:p=q.U;if((e=p)==null||!e.length){q.iH(5);break}return g.D(q,CRL(f.U,I.entityKey),5);case 5:g.KY(q,3);break;case 2:return O=g.UU(q),N="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",H="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",O instanceof g.BG&&O.type==="QUOTA_EXCEEDED"&&(N="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",H="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
q.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,N,H));case 3:return x=[],g.D(q,U0w(f.U,"musicTrack",p),7);case 7:p=q.U;if(p.length)for(S=g.Y(p),u=S.next();!u.done;u=S.next())if(a=u.value,k=a.offlineVideoData,B=void 0,(B=k)==null?0:B.videoId)L=void 0,K=Number(((L=I.actionMetadata)==null?void 0:L.priority)||0)+1,x.push(MK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",k.videoId,"musicTrack",K,mj,JV(I,k,P)));return q.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,x))}})},
uNV=function(f,I){var G,c,P,p,e,O,N,H,x,S,u,a,k,B,L,K,q,h,F,v,E,n,GT,Pp,fY,eM,C,kd,qv,FB,Y7,OJ,JT,jM,Pw,W,OU,nU,BL,UJ,au,vp,Fk,zV,U,z,M,R,y,Wp,I7,wS,cp,zT,mQ,Ww,LV,D2,m4;
return g.Z(function(sd){switch(sd.W){case 1:return G=NK(I),c=I.entityKey,P=g.kw(c).entityId,p=[],e=!1,P==="!*$_ALL_ENTITIES_!*$"?(e=!0,g.D(sd,QR(f.U,"musicAlbumRelease"),5)):g.D(sd,C2(f.U,c,"musicAlbumRelease"),4);case 4:(O=sd.U)&&p.push(O);sd.iH(3);break;case 5:p=sd.U;case 3:if((N=p)==null||!N.length)return sd.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));if(e){H=[];x=g.Y(p);for(S=x.next();!S.done;S=x.next())u=S.value,a=g.kw(u.id).entityId,H.push(MK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
a,"musicAlbumRelease",0,mj));return sd.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,H))}k=[];B=p[0];L=void 0;if(!B.downloadMetadata){sd.iH(6);break}return g.D(sd,C2(f.U,B.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:K=sd.U,L=Number((h=(q=K)==null?void 0:q.addedTimestampMillis)!=null?h:"0")/1E3;case 6:return g.LY(sd,8),g.D(sd,iOE(f,P,(F=L)==null?void 0:F.toString()),10);case 10:k=sd.U;g.KY(sd,9);break;case 8:v=g.UU(sd);if(!(v instanceof Error&&v.message===
"No data")){if(v instanceof Error&&v.message==="Empty response body")cZ(v.message);else return E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",n="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",v instanceof g.BG&&v.type==="QUOTA_EXCEEDED"&&(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",n="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),sd.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,E,n));sd.iH(9);break}return g.D(sd,jp(P,"musicAlbumRelease",f.U,
I,f.Z),9);case 9:GT=[];Pp=new Map;if((fY=k)==null?0:fY.length)for(eM=g.Y(k),C=eM.next();!C.done;C=eM.next())kd=C.value,qv=kd.offlineVideoData,FB=void 0,((FB=qv)==null?0:FB.videoId)&&Pp.set(qv.videoId,qv);Y7=new Map;OJ=[];if((JT=B)==null?0:(jM=JT.tracks)==null?0:jM.length)for(Pw=g.Y(B.tracks),W=Pw.next();!W.done;W=Pw.next())if(OU=W.value,nU=g.kw(OU).entityId)Pp.has(nU)?(Y7.set(nU,Pp.get(nU)),Pp.delete(nU)):OJ.push(nU);UJ=Number(((BL=I.actionMetadata)==null?void 0:BL.priority)||0)+1;au=g.Y(Pp.entries());
for(vp=au.next();!vp.done;vp=au.next())Fk=vp.value,zV=g.Y(Fk),U=zV.next().value,z=zV.next().value,M=U,R=z,GT.push(MK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",M,"musicTrack",UJ,mj,JV(I,R)));y=g.Y(Y7.entries());for(Wp=y.next();!Wp.done;Wp=y.next())I7=Wp.value,wS=g.Y(I7),cp=wS.next().value,zT=wS.next().value,mQ=cp,Ww=zT,GT.push(MK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",mQ,"musicTrack",UJ,mj,JV(I,Ww)));LV=g.Y(OJ);for(D2=LV.next();!D2.done;D2=LV.next())m4=D2.value,GT.push(MK("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
m4,"musicTrack",0,mj));return sd.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,GT))}})},au2=function(f,I){var G,c;
return g.Z(function(P){switch(P.W){case 1:return G=NK(I),g.LY(P,2),c=g.kw(I.entityKey).entityId,c==="!*$_ALL_ENTITIES_!*$"?g.D(P,K0(f.U,I,f.Z),5):g.D(P,jp(c,"musicAlbumRelease",f.U,I,f.Z),6);case 6:return g.D(P,Qgr(f.U,I.entityKey),5);case 5:g.KY(P,3);break;case 2:return g.UU(P),P.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return P.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G))}})},iOE=function(f,I,G){var c,P,p;
return g.Z(function(e){switch(e.W){case 1:return g.D(e,c3k([I]),2);case 2:return c=e.U,g.D(e,kMw(f,c[0],G),3);case 3:return P=e.U,p=km(P.thumbnailDetails),g.D(e,BZ(p),4);case 4:return e.return(c[0].videos)}})},kMw=function(f,I,G){var c,P,p,e,O,N,H,x,S,u,a,k,B,L;
return g.Z(function(K){if(K.W==1){c=I.additionalMetadadatas;P=void 0;if(c&&c.length>0)for(p=g.Y(c),e=p.next();!e.done;e=p.next())if(O=e.value,O.offlineMusicPlaylistData){P=O.offlineMusicPlaylistData;break}N=I.playlistId;H=brw(I);x=H.L7;S=H.PT;u=G?(Number(G)*1E3).toString():Date.now().toString();a=I.lastModifiedTimestamp?(Number(I.lastModifiedTimestamp)*1E3).toString():"0";k={id:g.lB(N,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:S,lastModifiedTimestampMillis:a,addedTimestampMillis:u,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};B={id:g.lB(N,"musicAlbumRelease"),title:I.title,audioPlaylistId:N,trackCount:I.totalVideoCount,tracks:x,downloadMetadata:k.id};P&&(B.thumbnailDetails=(L=P.albumHqThumbnail)!=null?L:P.albumArtistThumbnail,B.artistDisplayName=P.albumArtistDisplayName,B.releaseDate=P.albumReleaseDate,B.contentRating={explicitType:P.albumReleaseExplicitType},B.releaseType=P.albumReleaseType);return g.D(K,EZ(f.U,{mode:"readwrite",l1:!0},function(q){var h=TQ(q,B,"musicAlbumRelease");
q=TQ(q,k,"musicAlbumReleaseDownloadMetadataEntity");return g.JF.all([h,q])}),2)}return K.return(B)})},luE=function(f,I){this.U=f;
this.Z=I},$WE=function(f,I){var G,c,P,p,e,O,N,H,x,S,u,a,k,B,L,K;
return g.Z(function(q){switch(q.W){case 1:return G=NK(I),c=g.kw(I.entityKey),P=c.entityId,p=[],g.LY(q,2),g.D(q,wEw(f,P),4);case 4:p=q.U;if((e=p)==null||!e.length){q.iH(5);break}return g.D(q,CRL(f.U,I.entityKey),5);case 5:g.KY(q,3);break;case 2:return O=g.UU(q),N="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",H="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",O instanceof g.BG&&O.type==="QUOTA_EXCEEDED"&&(N="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",H="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
q.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,N,H));case 3:return x=[],g.D(q,U0w(f.U,"musicTrack",p),7);case 7:p=q.U;if(p.length)for(S=g.Y(p),u=S.next();!u.done;u=S.next())if(a=u.value,k=a.offlineVideoData,B=void 0,(B=k)==null?0:B.videoId)L=void 0,K=Number(((L=I.actionMetadata)==null?void 0:L.priority)||0)+1,x.push(MK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",k.videoId,"musicTrack",K,C0,JV(I,k,P)));return q.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,x))}})},
YcE=function(f,I){var G,c,P,p,e,O,N,H,x,S,u,a,k,B,L,K,q,h,F,v,E,n,GT,Pp,fY,eM,C,kd,qv,FB,Y7,OJ,JT,jM,Pw,W,OU,nU,BL,UJ,au,vp,Fk,zV,U,z,M,R,y,Wp,I7,wS,cp,zT,mQ,Ww,LV,D2,m4,sd,Cn,Bl,S_,DZ,wb,Fn,nX,sp,KL,pz,QD;
return g.Z(function(e8){switch(e8.W){case 1:return G=NK(I),c=I.entityKey,P=g.kw(c).entityId,p=[],e=!1,P==="!*$_ALL_ENTITIES_!*$"?(e=!0,g.D(e8,QR(f.U,"musicPlaylist"),5)):g.D(e8,C2(f.U,c,"musicPlaylist"),4);case 4:(O=e8.U)&&p.push(O);e8.iH(3);break;case 5:p=e8.U;case 3:if((N=p)==null||!N.length)return e8.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));H=g.d(I.actionMetadata,feV);S=(x=H)==null?void 0:x.autoSync;u=[];k=a=!0;B=!1;L=void 0;if(!e&&S===!1){e8.iH(6);break}g.LY(e8,7);return g.D(e8,
NRE(0,!!S,!0,p),9);case 9:u=e8.U;g.KY(e8,8);break;case 7:K=g.UU(e8);if(!(K instanceof Error&&K.message==="No data")){K instanceof Error&&K.message==="Empty response body"&&cZ(K.message);e8.iH(8);break}return P==="!*$_ALL_ENTITIES_!*$"?g.D(e8,K0(f.U,I,f.Z),8):g.D(e8,jp(P,"musicPlaylist",f.U,I,f.Z),8);case 8:if(!u.length||!e&&u[0].playlistId!==P)return e8.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));case 6:if(e){q=[];h=g.Y(u);for(F=h.next();!F.done;F=h.next())v=F.value,v.upToDate||
S&&!v.shouldAutoSyncMetadata||!v.playlistId||(E={autoSync:S},q.push(MK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",v.playlistId,"musicPlaylist",0,C0,{musicPlaylistEntityActionMetadata:E})));return e8.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,q))}u.length&&(n=u[0],B=!!n.upToDate,S&&(a=(GT=n.shouldAutoSyncMetadata)!=null?GT:!0,k=(Pp=n.shouldAutoSyncVideos)!=null?Pp:!0,n.checkInSeconds&&(L=n.checkInSeconds)));if(B||!a)return e8.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G));fY=[];eM=p[0];C=void 0;if(!eM.downloadMetadata){e8.iH(15);break}return g.D(e8,C2(f.U,eM.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:kd=e8.U,C=Number((FB=(qv=kd)==null?void 0:qv.addedTimestampMillis)!=null?FB:"0")/1E3;case 15:return g.LY(e8,17),g.D(e8,wEw(f,P,(Y7=C)==null?void 0:Y7.toString(),L),19);case 19:fY=e8.U;g.KY(e8,18);break;case 17:OJ=g.UU(e8);if(!(OJ instanceof Error&&OJ.message==="No data")){if(OJ instanceof Error&&OJ.message==="Empty response body")cZ(OJ.message);
else return JT="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",jM="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",OJ instanceof g.BG&&OJ.type==="QUOTA_EXCEEDED"&&(JT="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",jM="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),e8.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,JT,jM));e8.iH(18);break}return g.D(e8,jp(P,"musicPlaylist",f.U,I,f.Z),18);case 18:if(!k)return e8.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G));Pw=[];W=new Map;if((OU=fY)==null?0:OU.length)for(nU=g.Y(fY),BL=nU.next();!BL.done;BL=nU.next())UJ=BL.value,au=UJ.offlineVideoData,vp=void 0,((vp=au)==null?0:vp.videoId)&&W.set(au.videoId,au);Fk=new Map;zV=[];if((U=eM)==null?0:(z=U.tracks)==null?0:z.length)for(M=g.Y(eM.tracks),R=M.next();!R.done;R=M.next())if(y=R.value,Wp=g.kw(y).entityId)W.has(Wp)?(Fk.set(Wp,W.get(Wp)),W.delete(Wp)):zV.push(Wp);wS=Number(((I7=I.actionMetadata)==null?void 0:I7.priority)||0)+1;cp=g.Y(W.entries());for(zT=cp.next();!zT.done;zT=
cp.next())mQ=zT.value,Ww=g.Y(mQ),LV=Ww.next().value,D2=Ww.next().value,m4=LV,sd=D2,Pw.push(MK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",m4,"musicTrack",wS,C0,JV(I,sd)));Cn=g.Y(Fk.entries());for(Bl=Cn.next();!Bl.done;Bl=Cn.next())S_=Bl.value,DZ=g.Y(S_),wb=DZ.next().value,Fn=DZ.next().value,nX=wb,sp=Fn,Pw.push(MK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",nX,"musicTrack",wS,C0,JV(I,sp)));KL=g.Y(zV);for(pz=KL.next();!pz.done;pz=KL.next())QD=pz.value,Pw.push(MK("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
QD,"musicTrack",0,C0));return e8.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,Pw))}})},BCE=function(f,I){var G,c;
return g.Z(function(P){switch(P.W){case 1:return G=NK(I),g.LY(P,2),c=g.kw(I.entityKey).entityId,c==="!*$_ALL_ENTITIES_!*$"?g.D(P,K0(f.U,I,f.Z),5):g.D(P,jp(c,"musicPlaylist",f.U,I,f.Z),6);case 6:return g.D(P,Qgr(f.U,I.entityKey),5);case 5:g.KY(P,3);break;case 2:return g.UU(P),P.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return P.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G))}})},wEw=function(f,I,G,c){var P,p,e;
return g.Z(function(O){switch(O.W){case 1:return g.D(O,c3k([I]),2);case 2:return P=O.U,g.D(O,LAw(f,P[0],G,c),3);case 3:return p=O.U,e=km(p.thumbnailDetails),g.D(O,BZ(e),4);case 4:return O.return(P[0].videos)}})},LAw=function(f,I,G,c){var P,p,e,O,N,H,x,S,u;
return g.Z(function(a){return a.W==1?(P=I.playlistId,p=brw(I),e=p.L7,O=p.PT,N=G?(Number(G)*1E3).toString():Date.now().toString(),H=I.lastModifiedTimestamp?(Number(I.lastModifiedTimestamp)*1E3).toString():"0",x={id:g.lB(P,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:O,lastModifiedTimestampMillis:H,addedTimestampMillis:N,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},S={id:g.lB(P,"musicPlaylist"),title:I.title,playlistId:P,thumbnailDetails:I.thumbnail,visibility:WAV(I),trackCount:I.totalVideoCount,
tracks:e,downloadMetadata:x.id},c&&(((u=S)==null?0:u.entityMetadata)?S.entityMetadata.nextAutoRefreshIntervalSeconds=String(c):S&&(S.entityMetadata={nextAutoRefreshIntervalSeconds:String(c)})),g.D(a,EZ(f.U,{mode:"readwrite",l1:!0},function(k){var B=TQ(k,S,"musicPlaylist");k=TQ(k,x,"musicPlaylistDownloadMetadataEntity");return g.JF.all([B,k])}),2)):a.return(S)})},WAV=function(f){switch(f.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},on$=function(f,I){this.U=f;
this.Z=I},Jny=function(f,I){var G,c,P,p,e,O,N,H,x,S,u,a,k;
return g.Z(function(B){switch(B.W){case 1:return G=NK(I),c=g.kw(I.entityKey),P=c.entityId,p=g.d(I.actionMetadata,qc2),g.LY(B,2),g.D(B,jyV(f,P,void 0,(e=p)==null?void 0:e.track,(O=p)==null?void 0:O.albumRelease),4);case 4:if((N=p)==null?0:N.playlistId){B.iH(5);break}return g.D(B,CRL(f.U,I.entityKey),5);case 5:g.KY(B,3);break;case 2:return H=g.UU(B),x="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",H instanceof g.BG&&H.type==="QUOTA_EXCEEDED"&&
(x="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),B.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,x,S));case 3:a=Number(((u=I.actionMetadata)==null?void 0:u.priority)||0)+1;var L=(L=g.d(I.actionMetadata,qc2))?{playbackDataActionMetadata:{maximumDownloadQuality:L.maximumDownloadQuality}}:void 0;k=MK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",P,"playbackData",a,KAr,L);return B.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G,[k]))}})},UWk=function(f,I){var G,c,P,p,e,O,N,H,x,S,u,a,k,B,L;
return g.Z(function(K){switch(K.W){case 1:return G=NK(I),c=g.kw(I.entityKey),P=c.entityId,g.D(K,C2(f.U,I.entityKey,"musicTrack"),2);case 2:p=K.U;if(!p){e=void 0;K.iH(3);break}return g.D(K,C2(f.U,p.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:e=K.U;case 3:O=e;if(!p||!O)return K.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));H=g.d(I.actionMetadata,qc2);g.LY(K,5);return g.D(K,jyV(f,P,O.addedTimestampMillis,(x=H)==null?void 0:x.track,(S=H)==null?void 0:S.albumRelease),
7);case 7:a=Number(((u=I.actionMetadata)==null?void 0:u.priority)||0)+1;N=MK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",P,"playbackData",a,KAr);g.KY(K,6);break;case 5:k=g.UU(K);if(!(k instanceof Error&&k.message==="No data")){if(k instanceof Error&&k.message==="Empty response body")cZ(k.message);else return B="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",L="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",k instanceof g.BG&&k.type==="QUOTA_EXCEEDED"&&(B="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
L="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),K.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,B,L));K.iH(6);break}return g.D(K,qK(P,f.U,I,f.Z),6);case 6:return K.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,N?[N]:void 0))}})},zKV=function(f,I){var G,c;
return g.Z(function(P){switch(P.W){case 1:return G=NK(I),g.LY(P,2),c=g.kw(I.entityKey).entityId,c==="!*$_ALL_ENTITIES_!*$"?g.D(P,K0(f.U,I,f.Z),5):g.D(P,qK(c,f.U,I,f.Z),6);case 6:return g.D(P,Qgr(f.U,I.entityKey),5);case 5:g.KY(P,3);break;case 2:return g.UU(P),P.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return P.return(new Db("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G))}})},jyV=function(f,I,G,c,P){var p,e,O,N,H,x;
return g.Z(function(S){switch(S.W){case 1:if(p=c){S.iH(2);break}return g.D(S,GUE([I]),3);case 3:e=S.U,O=e[0],p=m0w(O);case 2:return g.D(S,hK$(f,p,I,P,G),4);case 4:N=S.U;H=N.musicTrackEntity;x=N.yH;var u=km(H.thumbnailDetails),a=[];x&&(a=km(x.thumbnailDetails));return g.D(S,BZ(u.concat(a)),0)}})},hK$=function(f,I,G,c,P){var p;
return g.Z(function(e){return e.W==1?(P||(P=Date.now().toString()),p={id:g.lB(G,"musicTrackDownloadMetadataEntity"),playbackData:g.lB(G,"playbackData"),addedTimestampMillis:P,videoDownloadContextEntity:g.lB(G,"videoDownloadContextEntity")},c&&(I.albumRelease=c.id),g.D(e,EZ(f.U,{mode:"readwrite",l1:!0},function(O){var N=[],H=TQ(O,p,"musicTrackDownloadMetadataEntity");N.push(H);H=TQ(O,I,"musicTrack");N.push(H);c&&(O=TQ(O,c,"musicAlbumRelease"),N.push(O));return g.JF.all(N)}),2)):e.W!=3?g.D(e,Sp(G,"musicTrackDownloadMetadataEntity",
f.U,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):e.return({musicTrackEntity:I,
yH:c})})},QH=function(){n0.apply(this,arguments);
this.T="musicTrack"},MIZ=function(f,I,G){I=I===void 0?43200:I;
G=G===void 0?!0:G;var c=c===void 0?!1:c;var P,p;return g.Z(function(e){switch(e.W){case 1:if(!f.J.cS())return e.return([]);P=[];g.LY(e,2);return g.D(e,NRE(I,G,c),4);case 4:P=e.U;g.KY(e,3);break;case 2:g.UU(e);case 3:return p=VaZ(f,P,G,"musicPlaylist"),e.return(p)}})},DWV=function(){g.w0.apply(this,arguments);
var f=this;this.events=new g.yE(this);this.UH=this.player.X();this.GY={Mht:function(){return f.U},
bZ:function(){return f.bZ()},
J7:function(I){return f.J7(I)}}},FAJ=function(f){var I;
f=g.d((I=f.getWatchNextResponse())==null?void 0:I.currentVideoEndpoint,g.PY);if(f==null?0:f.playlistId)var G=f.playlistId;return G},ZOE=function(f,I){var G,c,P,p;
return g.Z(function(e){if(e.W==1){G=I.clientPlaybackNonce;c={cpn:G,offlineSourceVisualElement:g.JO(I.hs||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};I.W&&(c.videoFmt=Number(I.W.itag));I.G&&(c.audioFmt=Number(I.G.itag));if((P=FAJ(I))&&I.videoId){var O=I.videoId;O=P!=="PPSV"?Promise.resolve(!1):f.U.lG(O);e=g.D(e,O,3)}else e=e.iH(2);return e}e.W!=2&&(p=e.U)&&(c.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");f.W=G;g.SB("offlinePlaybackStarted",c);g.Bp(e)})};
g.z4.prototype.yp=g.tT(51,function(f){return this.app.yp(f)});
g.lI.prototype.yp=g.tT(50,function(f){return g.cW1(this,9,f)});
g.w(gJ,Zj);g.Nv.Object.defineProperties(gJ.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.U.entityMetadata},
set:function(f){this.U.entityMetadata=f}}});
g.w(KtZ,gJ);KtZ.prototype.W=function(){return[]};
g.w(JgJ,gJ);JgJ.prototype.W=function(){return[]};
g.w(UXw,gJ);UXw.prototype.W=function(){return[]};
g.w(zTL,gJ);zTL.prototype.W=function(){return[]};
g.w(hTy,gJ);hTy.prototype.W=function(){var f=[];this.U.alternateChannel&&f.push(this.U.alternateChannel);this.U.alternateChannelList&&f.push.apply(f,g.J(this.U.alternateChannelList));this.U.oneofChannelEntity&&f.push(this.U.oneofChannelEntity);return[].concat(g.J(new Set(f)))};
g.w(Mgw,gJ);Mgw.prototype.W=function(){var f=[];this.U.entryCollection&&f.push(this.U.entryCollection);return[].concat(g.J(new Set(f)))};
g.w(DX7,Zj);DX7.prototype.W=function(){var f=[];this.U.video&&f.push(this.U.video);return[].concat(g.J(new Set(f)))};
g.w(Ftk,gJ);Ftk.prototype.W=function(){var f=[];this.U.parentPlaylist&&f.push(this.U.parentPlaylist);if(this.U.entries)for(var I=g.Y(this.U.entries),G=I.next();!G.done;G=I.next())f.push.apply(f,g.J((new DX7(G.value)).W()));return[].concat(g.J(new Set(f)))};
g.w(ZXk,gJ);ZXk.prototype.W=function(){var f=[];this.U.descriptionEntity&&f.push(this.U.descriptionEntity);this.U.creators&&f.push.apply(f,g.J(this.U.creators));this.U.theBiggestFan&&f.push(this.U.theBiggestFan);return[].concat(g.J(new Set(f)))};
g.w(g62,gJ);g62.prototype.W=function(){return[]};
g.w(RTk,gJ);RTk.prototype.W=function(){return[]};
g.w(Vgr,gJ);Vgr.prototype.W=function(){return[]};
g.w(rg2,gJ);rg2.prototype.W=function(){return[]};
g.w(v6y,gJ);v6y.prototype.W=function(){return[]};
g.w(dXw,gJ);dXw.prototype.W=function(){return[]};
g.w(ygJ,gJ);ygJ.prototype.W=function(){return[]};
g.w(Agu,gJ);Agu.prototype.W=function(){return[]};
g.w(Tnr,gJ);Tnr.prototype.W=function(){return[]};
g.w(n6k,gJ);n6k.prototype.W=function(){var f=[];this.U.downloadsList&&f.push(this.U.downloadsList);this.U.smartDownloadsList&&f.push(this.U.smartDownloadsList);this.U.recommendedDownloadsList&&f.push(this.U.recommendedDownloadsList);this.U.refresh&&f.push(this.U.refresh);return[].concat(g.J(new Set(f)))};
g.w(smZ,Zj);smZ.prototype.W=function(){var f=[];this.U.video&&f.push(this.U.video);this.U.playlist&&f.push(this.U.playlist);this.U.videoItem&&f.push(this.U.videoItem);this.U.playlistItem&&f.push(this.U.playlistItem);return[].concat(g.J(new Set(f)))};
g.w(Xd7,gJ);Xd7.prototype.W=function(){var f=[];this.U.refresh&&f.push(this.U.refresh);if(this.U.downloads)for(var I=g.Y(this.U.downloads),G=I.next();!G.done;G=I.next())f.push.apply(f,g.J((new smZ(G.value)).W()));return[].concat(g.J(new Set(f)))};
g.w(E6L,gJ);E6L.prototype.W=function(){var f=[];this.U.localImageEntities&&f.push.apply(f,g.J(this.U.localImageEntities));return[].concat(g.J(new Set(f)))};
g.w(mXV,gJ);mXV.prototype.W=function(){var f=[];this.U.playbackData&&f.push(this.U.playbackData);this.U.localImageEntities&&f.push.apply(f,g.J(this.U.localImageEntities));this.U.videoDownloadContextEntity&&f.push(this.U.videoDownloadContextEntity);return[].concat(g.J(new Set(f)))};
g.w(CkZ,gJ);CkZ.prototype.W=function(){return[]};
g.w(Qmw,gJ);Qmw.prototype.W=function(){var f=[];this.U.fakeChildren&&f.push.apply(f,g.J(this.U.fakeChildren));return[].concat(g.J(new Set(f)))};
g.w(bXU,gJ);bXU.prototype.W=function(){var f=[];this.U.video&&f.push(this.U.video);this.U.playbackData&&f.push(this.U.playbackData);this.U.offlineVideoPolicy&&f.push(this.U.offlineVideoPolicy);return[].concat(g.J(new Set(f)))};
g.w(fTU,gJ);fTU.prototype.W=function(){return[]};
g.w(ITU,gJ);ITU.prototype.W=function(){var f=[];this.U.channelOwner&&f.push(this.U.channelOwner);this.U.videos&&f.push.apply(f,g.J(this.U.videos));this.U.collaboratorChannels&&f.push.apply(f,g.J(this.U.collaboratorChannels));this.U.downloadState&&f.push(this.U.downloadState);this.U.refresh&&f.push(this.U.refresh);return[].concat(g.J(new Set(f)))};
g.w(GJr,gJ);GJr.prototype.W=function(){var f=[];this.U.video&&f.push(this.U.video);this.U.channelContributor&&f.push(this.U.channelContributor);return[].concat(g.J(new Set(f)))};
g.w(c8y,Zj);c8y.prototype.W=function(){var f=[];this.U.localImageEntities&&f.push.apply(f,g.J(this.U.localImageEntities));this.U.videoDownloadContextEntity&&f.push(this.U.videoDownloadContextEntity);return[].concat(g.J(new Set(f)))};
g.w(PHL,Zj);PHL.prototype.W=function(){var f=[];this.U.recommendedVideoMetadata&&f.push.apply(f,g.J((new c8y(this.U.recommendedVideoMetadata)).W()));return[].concat(g.J(new Set(f)))};
g.w(pK$,Zj);pK$.prototype.W=function(){var f=[];this.U.playbackPosition&&f.push(this.U.playbackPosition);return[].concat(g.J(new Set(f)))};
g.w(e6r,gJ);e6r.prototype.W=function(){var f=[];this.U.owner&&f.push(this.U.owner);this.U.downloadState&&f.push(this.U.downloadState);this.U.userState&&f.push.apply(f,g.J((new pK$(this.U.userState)).W()));this.U.additionalMetadata&&f.push.apply(f,g.J((new PHL(this.U.additionalMetadata)).W()));return[].concat(g.J(new Set(f)))};
g.w(tqU,gJ);tqU.prototype.W=function(){var f=[];this.U.userChannelDetails&&f.push(this.U.userChannelDetails);return[].concat(g.J(new Set(f)))};
g.w(ON2,gJ);ON2.prototype.W=function(){var f=[];this.U.channelOwner&&f.push(this.U.channelOwner);this.U.playbackPosition&&f.push(this.U.playbackPosition);this.U.localImageEntities&&f.push.apply(f,g.J(this.U.localImageEntities));this.U.downloadStatus&&f.push(this.U.downloadStatus);return[].concat(g.J(new Set(f)))};
g.w(NHu,gJ);NHu.prototype.W=function(){return[]};
g.w(HNw,gJ);HNw.prototype.W=function(){return[]};
g.w(xkU,gJ);xkU.prototype.W=function(){return[]};
g.w(iNZ,gJ);iNZ.prototype.W=function(){return[]};
g.w(Sqw,gJ);Sqw.prototype.W=function(){return[]};
g.w(ucu,gJ);ucu.prototype.W=function(){return[]};
g.w(aT7,gJ);aT7.prototype.W=function(){return[]};
g.w(kJr,gJ);kJr.prototype.W=function(){return[]};
g.w(lTL,gJ);lTL.prototype.W=function(){return[]};
g.w(wKL,gJ);wKL.prototype.W=function(){return[]};
g.w($kV,gJ);$kV.prototype.W=function(){return[]};
g.w(YqL,gJ);YqL.prototype.W=function(){var f=[];this.U.trackDownloadMetadatas&&f.push.apply(f,g.J(this.U.trackDownloadMetadatas));return[].concat(g.J(new Set(f)))};
g.w(BHk,gJ);
BHk.prototype.W=function(){var f=[];this.U.downloadedTracks&&f.push.apply(f,g.J(this.U.downloadedTracks));this.U.smartDownloadedTracks&&f.push.apply(f,g.J(this.U.smartDownloadedTracks));this.U.downloadedEpisodes&&f.push.apply(f,g.J(this.U.downloadedEpisodes));this.U.downloadedAlbumReleases&&f.push.apply(f,g.J(this.U.downloadedAlbumReleases));this.U.smartDownloadedAlbumReleases&&f.push.apply(f,g.J(this.U.smartDownloadedAlbumReleases));this.U.downloadedPlaylists&&f.push.apply(f,g.J(this.U.downloadedPlaylists));this.U.smartDownloadedPlaylists&&
f.push.apply(f,g.J(this.U.smartDownloadedPlaylists));this.U.metadataOnlyTracks&&f.push.apply(f,g.J(this.U.metadataOnlyTracks));return[].concat(g.J(new Set(f)))};
g.w(LfZ,gJ);LfZ.prototype.W=function(){var f=[];this.U.trackDownloadMetadatas&&f.push.apply(f,g.J(this.U.trackDownloadMetadatas));return[].concat(g.J(new Set(f)))};
g.w(Wfy,gJ);Wfy.prototype.W=function(){var f=[];this.U.playbackData&&f.push(this.U.playbackData);this.U.localImageEntities&&f.push.apply(f,g.J(this.U.localImageEntities));this.U.videoDownloadContextEntity&&f.push(this.U.videoDownloadContextEntity);return[].concat(g.J(new Set(f)))};
g.w(ohV,gJ);ohV.prototype.W=function(){var f=[];this.U.musicLibraryStatusEntity&&f.push(this.U.musicLibraryStatusEntity);this.U.primaryArtists&&f.push.apply(f,g.J(this.U.primaryArtists));this.U.details&&f.push(this.U.details);this.U.userDetails&&f.push(this.U.userDetails);this.U.tracks&&f.push.apply(f,g.J(this.U.tracks));this.U.share&&f.push(this.U.share);this.U.downloadMetadata&&f.push(this.U.downloadMetadata);this.U.refresh&&f.push(this.U.refresh);return[].concat(g.J(new Set(f)))};
g.w(qqw,gJ);qqw.prototype.W=function(){var f=[];this.U.albumRelease&&f.push(this.U.albumRelease);this.U.tracks&&f.push.apply(f,g.J(this.U.tracks));return[].concat(g.J(new Set(f)))};
g.w(jeZ,gJ);jeZ.prototype.W=function(){var f=[];this.U.albumRelease&&f.push(this.U.albumRelease);return[].concat(g.J(new Set(f)))};
g.w(Kfw,gJ);Kfw.prototype.W=function(){var f=[];this.U.details&&f.push(this.U.details);this.U.userDetails&&f.push(this.U.userDetails);return[].concat(g.J(new Set(f)))};
g.w(J8L,gJ);J8L.prototype.W=function(){var f=[];this.U.parentArtist&&f.push(this.U.parentArtist);return[].concat(g.J(new Set(f)))};
g.w(Uk$,gJ);Uk$.prototype.W=function(){var f=[];this.U.parentArtist&&f.push(this.U.parentArtist);return[].concat(g.J(new Set(f)))};
g.w(z6J,gJ);z6J.prototype.W=function(){return[]};
g.w(h6Z,gJ);h6Z.prototype.W=function(){return[]};
g.w(Mqw,Zj);Mqw.prototype.W=function(){var f=[];this.U.creatorEntity&&f.push(this.U.creatorEntity);return[].concat(g.J(new Set(f)))};
g.w(Dkw,gJ);
Dkw.prototype.W=function(){var f=[];this.U.tracks&&f.push.apply(f,g.J(this.U.tracks));this.U.refresh&&f.push(this.U.refresh);this.U.musicLibraryStatusEntity&&f.push(this.U.musicLibraryStatusEntity);this.U.details&&f.push(this.U.details);this.U.downloadMetadata&&f.push(this.U.downloadMetadata);this.U.sideloadMetadata&&f.push(this.U.sideloadMetadata);this.U.userDetails&&f.push(this.U.userDetails);this.U.entryCollection&&f.push(this.U.entryCollection);this.U.share&&f.push(this.U.share);this.U.podcastShowAdditionalMetadata&&f.push.apply(f,
g.J((new Mqw(this.U.podcastShowAdditionalMetadata)).W()));return[].concat(g.J(new Set(f)))};
g.w(Ffu,gJ);Ffu.prototype.W=function(){return[]};
g.w(ZN2,gJ);
ZN2.prototype.W=function(){var f=[];this.U.musicLibraryStatusEntity&&f.push(this.U.musicLibraryStatusEntity);this.U.artists&&f.push.apply(f,g.J(this.U.artists));this.U.audioModeVersion&&f.push(this.U.audioModeVersion);this.U.videoModeVersion&&f.push(this.U.videoModeVersion);this.U.userDetails&&f.push(this.U.userDetails);this.U.details&&f.push(this.U.details);this.U.albumRelease&&f.push(this.U.albumRelease);this.U.share&&f.push(this.U.share);this.U.libraryEdit&&f.push(this.U.libraryEdit);this.U.downloadMetadata&&
f.push(this.U.downloadMetadata);this.U.playbackPosition&&f.push(this.U.playbackPosition);this.U.lyrics&&f.push(this.U.lyrics);return[].concat(g.J(new Set(f)))};
g.w(ghw,gJ);ghw.prototype.W=function(){var f=[];this.U.parentTrack&&f.push(this.U.parentTrack);return[].concat(g.J(new Set(f)))};
g.w(R6Z,gJ);R6Z.prototype.W=function(){var f=[];this.U.parentTrack&&f.push(this.U.parentTrack);return[].concat(g.J(new Set(f)))};
g.w(Vqw,gJ);Vqw.prototype.W=function(){return[]};
g.w(r8U,gJ);r8U.prototype.W=function(){return[]};
g.w(vhV,gJ);vhV.prototype.W=function(){return[]};
g.w(dkU,gJ);dkU.prototype.W=function(){return[]};
g.w(y8J,gJ);y8J.prototype.W=function(){var f=[];this.U.transfer&&f.push(this.U.transfer);this.U.adsPlaybackData&&f.push.apply(f,g.J(this.U.adsPlaybackData));this.U.drmLicense&&f.push(this.U.drmLicense);this.U.offlineVideoPolicy&&f.push(this.U.offlineVideoPolicy);this.U.videoDownloadContextEntity&&f.push(this.U.videoDownloadContextEntity);return[].concat(g.J(new Set(f)))};
g.w(A82,gJ);A82.prototype.W=function(){return[]};
g.w(THE,gJ);THE.prototype.W=function(){var f=[];this.U.offlineVideoStreams&&f.push.apply(f,g.J(this.U.offlineVideoStreams));this.U.captionTrack&&f.push.apply(f,g.J(this.U.captionTrack));return[].concat(g.J(new Set(f)))};
g.w(nh2,gJ);nh2.prototype.W=function(){return[]};
g.w(seE,gJ);seE.prototype.W=function(){return[]};
g.w(XK7,gJ);XK7.prototype.W=function(){return[]};
g.w(Ehw,gJ);Ehw.prototype.W=function(){return[]};
g.w(mkk,gJ);mkk.prototype.W=function(){return[]};
g.w(CHk,gJ);CHk.prototype.W=function(){return[]};
g.w(Qer,gJ);Qer.prototype.W=function(){return[]};
g.w(bN2,gJ);bN2.prototype.W=function(){return[]};
g.w(fzu,gJ);fzu.prototype.W=function(){return[]};
g.w(IzV,gJ);IzV.prototype.W=function(){return[]};
g.w(GIu,gJ);GIu.prototype.W=function(){return[]};
g.w(cpU,gJ);cpU.prototype.W=function(){return[]};
g.w(PK7,gJ);PK7.prototype.W=function(){return[]};
g.w(pjw,gJ);pjw.prototype.W=function(){return[]};
g.w(eWJ,gJ);eWJ.prototype.W=function(){return[]};
g.w(t9k,gJ);t9k.prototype.W=function(){return[]};
g.w(OdE,gJ);OdE.prototype.W=function(){return[]};
g.w(NxZ,gJ);NxZ.prototype.W=function(){return[]};
g.w(HdZ,gJ);HdZ.prototype.W=function(){return[]};
g.w(xsk,gJ);xsk.prototype.W=function(){return[]};
var HMU=["browse","music/browse","unplugged/browse"],aek=["offline/playlist_sync_check"],IeJ=["offline"],x5$=["offline/offline_video_playback_position_sync"],Sik=["offline/get_playback_data_entity"],RU;VR.getInstance=function(){return g.Z(function(f){return f.return(new Promise(function(I){g.GC().then(function(G){G?(VR.instance||(VR.instance=new VR(G)),I(VR.instance)):I(void 0)})}))})};
VR.prototype.get=function(f){var I=this,G,c,P;return g.Z(function(p){if(p.W==1)return g.D(p,azu(I.token),2);if(p.W!=3)return G=p.U,g.D(p,G.get("prefs",f),3);c=p.U;if(!c)return p.return();P=(0,g.A)();return c.expirationTimestampMs<=P?p.return():p.return(c.value)})};
VR.prototype.set=function(f,I,G){G=G===void 0?31536E3:G;var c=this,P,p,e;return g.Z(function(O){if(O.W==1)return P=(0,g.A)(),p={key:f,value:I,expirationTimestampMs:P+G*1E3},g.D(O,azu(c.token),2);e=O.U;return g.D(O,g.R8(e,"prefs",p),0)})};
VR.prototype.remove=function(f){var I=this,G;return g.Z(function(c){if(c.W==1)return g.D(c,azu(I.token),2);G=c.U;return g.D(c,G.delete("prefs",f),0)})};
g.w(rJ,g.Ct);g.w(vx,YPw);vx.prototype.Z=function(f,I){I=Lnr(I);f=(new TextEncoder).encode(JSON.stringify(f));return this.U.encrypt(f,I)};
vx.prototype.W=function(f,I){if(!(f instanceof Uint8Array))throw kIU(1);var G=new TextDecoder;I=Lnr(I);f=this.U.decrypt(f,I);return JSON.parse(G.decode(f))};
var WnJ={accountLinkStatusEntity:Vgr,booleanEntity:UXw,buttonEntity:PK7,captionTrack:Vqw,channelHandle:KtZ,commerceAcquisitionClientPayloadEntity:eWJ,commerceCartListEntity:t9k,contextNoteFeedEntityPayload:JgJ,continuationTokenEntity:fTU,downloadQualityPickerEntity:ygJ,downloadsPageRefreshTokenEntity:Tnr,downloadsPageViewConfigurationEntity:NHu,downloadStatusEntity:Agu,dismissState:Qer,sfvAudioItemCurrentlyPlayingEntity:Ehw,emojiFountainDataEntity:GIu,emojiCustomizationSetEntity:IzV,fakeChannel:hTy,
fakePlaylist:Mgw,fakePlaylistEntryCollection:Ftk,fakeVideo:ZXk,fakeVideoDescription:g62,featuredProductsEntity:lTL,flowStateEntity:RTk,iconBadgeEntity:OdE,interstitialInteractionStateEntity:v6y,likeButtonAnimationEntity:HNw,liveChatPollStateEntity:dXw,liveViewerLeaderboardChatEntryPointStateEntity:seE,liveViewerLeaderboardPointsEntity:XK7,liveReactionsDataEntity:cpU,logoEntity:rg2,macroMarkerEntity:xkU,mainDownloadsLibraryEntity:n6k,mainDownloadsListEntity:Xd7,mainPlaylistDownloadStateEntity:E6L,
mainPlaylistEntity:ITU,mainPlaylistVideoEntity:GJr,mainVideoDownloadStateEntity:mXV,mainVideoEntity:e6r,markersEngagementPanelSyncEntity:iNZ,markersVisibilityOverrideEntity:Sqw,musicAlbumReleaseDetail:qqw,musicAlbumReleaseDownloadMetadataEntity:YqL,musicAlbumRelease:ohV,musicAlbumReleaseUserDetail:jeZ,musicArtistDetail:J8L,musicArtist:Kfw,musicArtistUserDetail:Uk$,musicDownloadsLibraryEntity:BHk,musicLibraryEdit:z6J,musicLibraryStatusEntity:h6Z,musicPlaylist:Dkw,musicPlaylistDownloadMetadataEntity:LfZ,
musicShare:Ffu,musicTrackDetail:ghw,musicTrackDownloadMetadataEntity:Wfy,musicTrack:ZN2,musicTrackUserDetail:R6Z,offlineOrchestrationActionWrapperEntity:r8U,offlineVideoPolicy:vhV,offlineVideoStreams:dkU,offlineabilityEntity:CkZ,orchestrationWebSamplingEntity:Qmw,pageHeaderEntity:bN2,pdpStateEntity:NxZ,pinnedProductEntity:wKL,playbackData:y8J,playerStateEntity:ucu,quantityIncrementerEntity:HdZ,refresh:A82,saveToPlaylistListEntity:mkk,settingEntity:CHk,stringEntity:zTL,suggestedFeedbackChipStateEntity:aT7,
transfer:THE,trendingOfferEntity:$kV,videoDownloadContextEntity:nh2,videoOverviewAsyncDataEntity:xsk,videoPlaybackPositionEntity:pjw,votingEntity:fzu,ytMainChannelEntity:tqU,youchatPendingResponseEntity:kJr,ytMainDownloadedVideoEntity:bXU,ytMainVideoEntity:ON2};g.w(sZ,YPw);sZ.prototype.Z=function(f){return f};
sZ.prototype.W=function(f){if(f instanceof Uint8Array)throw kIU(0);return f};
g.w(X2,g.V);X2.prototype.observe=function(f){var I=this;this.observers.push(f);return function(){var G=I.observers.indexOf(f);G>=0&&I.observers.splice(G,1)}};
X2.prototype.W=function(f){RW$(this,f.data)};
X2.prototype.eF=function(){this.channel.close()};
var ypV,vPL=new g.zM("elementsCommand");var WZ=new g.zM("entityBatchUpdate");var JXy=new g.zM("downloadStatusEntity");var TU2=new g.zM("mainPlaylistEntityActionMetadata");var Eo=new g.zM("mainVideoEntityActionMetadata");var feV=new g.zM("musicPlaylistEntityActionMetadata");var qc2=new g.zM("musicTrackEntityActionMetadata");var eKw=new g.zM("localImageEntityActionMetadata");var Fy=new g.zM("playbackDataActionMetadata");var d5J=new g.zM("transferEntityActionMetadata");var jGw=new g.zM("videoPlaybackPositionEntityActionMetadata");var PRV;new g.ag;new g.ag;Nlk.prototype.request=function(f,I,G){I=I===void 0?{}:I;return this.locks.request(f,I,function(c){return G(c)})};var GE=g.XB.caches,It,uV$;f0.prototype.open=function(f){return GE.open(ir2(f))};
f0.prototype.has=function(f){return GE.has(ir2(f))};
f0.prototype.delete=function(f){return GE.delete(ir2(f))};
f0.prototype.match=function(f,I){var G=this,c,P,p,e,O,N;return g.Z(function(H){switch(H.W){case 1:return g.D(H,G.keys(),2);case 2:c=H.U,P=g.Y(c),p=P.next();case 3:if(p.done){H.iH(5);break}e=p.value;return g.D(H,G.open(e),6);case 6:return O=H.U,g.D(H,O.match(f,I),7);case 7:if(N=H.U)return H.return(N);p=P.next();H.iH(3);break;case 5:return H.return()}})};
g.w(x0u,f0);x0u.prototype.keys=function(){var f,I,G,c,P,p,e,O,N;return g.Z(function(H){if(H.W==1)return f=[],I=g.QC("CacheStorage keys"),g.D(H,GE.keys(),2);G=H.U;c=g.Y(G);for(P=c.next();!P.done;P=c.next()){p=P.value;var x=p.indexOf(":");e=x===-1?{ZG:p}:{ZG:p.substring(0,x),datasyncId:p.substring(x+1)};O=e.ZG;N=e.datasyncId;N===I&&f.push(O)}return H.return(f)})};g.w(PZ,g.V);PZ.prototype.Z=function(f){this.api.Xw("onOfflineOperationFailure",f.data)};
PZ.prototype.G=function(f){this.api.publish("offlinetransferpause",f.data)};
PZ.prototype.eF=function(){var f;(f=this.U)==null||f.close();var I;(I=this.W)==null||I.close()};l_w.prototype.S4=function(){this.U&&ep(this)};
l_w.prototype.Qu=function(){this.W&&this.W.resolve();this.Z=this.U=!1;this.T()};var Pty=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var Rj2="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var EPu="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.w(ley,hV);ley.prototype.W=function(f){return HZ(f)?YiL(this,f):xm(f)?WBL(this,f):Promise.reject(Error("Unsupported action type: "+f.actionType))};g.w(o1L,hV);o1L.prototype.W=function(f){return xm(f)?qiZ(this,f):KkL(f)?KBw(this,f):iQ(f)?J3L(this,f):Promise.reject(Error("Unsupported action type: "+f.actionType))};g.l=U5w.prototype;g.l.fiH=function(f){var I=this,G,c,P,p;return g.Z(function(e){if(!g.X(f.state,128))return e.iH(0);G=f.state.qf;var O=(c=G)==null?void 0:c.errorCode,N=(P=G)==null?void 0:P.C_;p=O==="net.connect"&&N===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(O==null?0:O.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.D(e,I.v$(I.player.getVideoData().videoId,p),0)})};
g.l.v$=function(f,I){var G=this;return g.Z(function(c){if(c.W==1){if(G.W)return c.return();G.W=!0;return I==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(Rt(G,f,!1,!0),c.iH(0)):g.D(c,gQ(G,f),3)}g.RA(f,4);return g.D(c,G.U.v$(I),0)})};
g.l.Mj=function(f){f.status===2?(f.status!==this.Z&&(qlk(this.U),g.RA(f.videoId,2)),f.PO&&zeZ(this.U,f.videoId,f.PO)):f.status===4?(gQ(this,f.videoId),this.v$(f.videoId,f.Ra?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):f.status===1&&Uuk(this.U);this.Z=f.status;this.api.Xw("localmediachange",{videoId:f.videoId,status:f.status})};
g.l.rU=function(){var f=this,I;return g.Z(function(G){if(G.W==1){if(f.W)return G.return();f.W=!0;I=f.player.getVideoData().videoId;return g.D(G,gQ(f,I),2)}return g.D(G,f.U.rU(),0)})};
g.l.D9=function(f){switch(f){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.l.j=function(f){return this.api.X().j(f)};g.w(g1E,hV);g1E.prototype.W=function(f){return HZ(f)?Vy2(this,f):xm(f)?r3w(this,f):KkL(f)?v1y(this,f):Promise.reject(Error("Unsupported action type: "+f.actionType))};sGL.prototype.U=function(f,I){var G=f.action.actionMetadata.priority-I.action.actionMetadata.priority;G===0&&(f.U<I.U?G=-1:f.U>I.U&&(G=1));return G};g.w(VH,g.V);VH.prototype.eF=function(){this.T&&this.T();g.V.prototype.eF.call(this)};
VH.prototype.createAction=function(f,I){var G=g.kw(f.entityKey).entityType,c=g.Ji(16);return new lQ(G,c,f,I.actionId,I.rootActionId)};
VH.prototype.WH=function(f){var I=this,G,c,P,p,e,O,N,H,x;return g.Z(function(S){if(S.W==1){if(I.PH())return S.return();c=(G=f.offlineOrchestrationActionWrapperEntity)!=null?G:new Set;P=[];p=g.Y(c);for(e=p.next();!e.done;e=p.next())O=e.value,N=g.kw(O),H=N.entityId,m5L(I.U,H)||P.push(O);return g.D(S,tau(I,P),2)}x=S.U;return g.D(S,eeu(I,x),0)})};
VH.prototype.retry=function(){var f=this;return g.Z(function(I){return g.D(I,OBw(f),0)})};HBJ.prototype.YH=function(f,I){I=I===void 0?!0:I;var G=this,c,P,p,e,O,N,H,x;return g.Z(function(S){switch(S.W){case 1:if(!G.U)return S.return();c=[];P=g.P6(G.U.W,I);p=[];for(e={e3:0};e.e3<P.length;e={e3:e.e3},e.e3++)O=P[e.e3],N=G.U.OL(O,"json3"),H=g.Do(N,{withCredentials:!0,format:"RAW"},3,500).then(function(u){return function(a){a={metadata:g.L3(P[u.e3]),trackData:a.xhr.responseText};p.push(a)}}(e)).gC(function(u){cZ("Caption fetch error",u)}),c.push(H);
return g.D(S,jmk(c),2);case 2:return g.LY(S,3),g.D(S,CK2(f,p),5);case 5:g.KY(S,0);break;case 3:x=g.UU(S),cZ("Caption DB transaction error",x),g.Bp(S)}})};g.w(rQ,g.V);rQ.prototype.eF=function(){this.W&&this.W();g.V.prototype.eF.call(this)};
rQ.prototype.Z=function(f){var I=this,G,c,P,p,e,O,N,H;return g.Z(function(x){c=(G=f.transfer)!=null?G:new Set;P=[];p=g.Y(c);for(e=p.next();!e.done;e=p.next())O=e.value,N=g.kw(O),H=N.entityId,P.push(H);return P.length===0?x.return():g.D(x,Slw(I,P),0)})};g.w(w4$,g.V);g.l=w4$.prototype;g.l.eF=function(){this.rb&&this.rb();this.It.dispose();this.G.dispose();this.hs&&g.cj(this.J.FR,this.hs);this.LZ&&g.cj(this.J.FR,this.LZ);g.V.prototype.eF.call(this)};
g.l.jDM=function(f){var I=this,G,c,P;return g.Z(function(p){switch(p.W){case 1:G=g.lB(f,"transfer");if(I.U&&G===I.U.key){Rt(I.Y,I.B,!0);I.G.stop();p.iH(0);break}return g.D(p,EZ(I.W,{mode:"readwrite",l1:!0},function(e){return dJ(e,G,"transfer").then(function(O){if(O&&O.transferState!=="TRANSFER_STATE_COMPLETE"&&O.transferState!=="TRANSFER_STATE_FAILED")return O.transferState="TRANSFER_STATE_PAUSED_BY_USER",TQ(e,O,"transfer").then(function(){return O})})}),3);
case 3:c=p.U;if(!c){p.iH(0);break}if(!f||!I.Z){p.iH(5);break}return g.D(p,Sp(f,I.Z,I.W,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.D(p,yH(I,f),7);case 7:P=p.U,qDy({videoId:f,MW:c,offlineModeType:P}),g.Bp(p)}})};
g.l.qqH=function(){var f=this;if(this.U&&this.B){Rt(this.Y,this.B,!1);var I=this.U,G=(I==null?0:I.key)?g.kw(I.key).entityId:"";G&&this.Z&&(new Promise(function(c,P){Sp(G,f.Z,f.W,"DOWNLOAD_STATE_PAUSED").catch(function(p){P(p)})})).catch(function(c){cZ("Download state setting error",c)})}this.G.stop()};
g.l.NI=function(){this.U?BU$(this,this.U):dQ(this)};
g.l.qF=function(f){var I=this;return g.Z(function(G){switch(G.W){case 1:if(!I.U){G.iH(2);break}if(I.U.transferState==="TRANSFER_STATE_COMPLETE"||I.U.transferState==="TRANSFER_STATE_FAILED"||!f.transfer||!f.transfer.has(I.U.key)){G.iH(3);break}return g.D(G,C2(I.W,I.U.key,"transfer"),4);case 4:I.U=G.U;if(I.U){G.iH(3);break}return g.D(G,LH$(I),3);case 3:if(I.U)return G.return();case 2:return g.D(G,dQ(I),0)}})};
g.l.v$=function(f,I){var G=this,c,P,p,e,O;return g.Z(function(N){switch(N.W){case 1:if(!G.U){AV(G,"onTransferFailure: "+f);N.iH(2);break}c=G.U;p=((P=c)==null?0:P.key)?g.kw(c.key).entityId:"";a:switch(f){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var H=!1;break a;default:H=!0}return H&&heu(G)?g.D(N,TE(G,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.D(N,
MaJ(G,f),5);case 5:if(!p||!G.Z){N.iH(2);break}return g.D(N,Sp(p,G.Z,G.W,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.D(N,yH(G,p),9);case 9:e=N.U;Oo({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:p,MW:c,offlineModeType:e});if(!p||!G.Z){N.iH(2);break}return g.D(N,Sp(p,G.Z,G.W,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:vZ(G),O=dQ(G,!0),I&&I(O),g.Bp(N)}})};
g.l.rU=function(f){var I=this,G,c,P,p,e,O,N,H,x,S,u,a;return g.Z(function(k){switch(k.W){case 1:if(!I.U){AV(I,"onMaybeTransferStreamsExpired");k.iH(2);break}return heu(I)?g.D(k,TE(I,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.D(k,MaJ(I,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!I.Z){k.iH(2);break}G=I.U;P=((c=G)==null?0:c.key)?g.kw(G.key).entityId:"";if(!P){k.iH(2);break}return g.D(k,Sp(P,I.Z,I.W,"DOWNLOAD_STATE_FAILED"),2);case 9:return I.U||AV(I,"onMaybeTransferStreamsExpiredRetryAttempting"),
p=I.U,O=((e=p)==null?0:e.key)?g.kw(p.key).entityId:"",g.D(k,yH(I,O),10);case 10:return N=k.U,Oo({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:O,MW:p,offlineModeType:N}),H=hjU(),g.nq(H,Fy,{isEnqueuedForExpiredStreamUrlRefetch:!0}),x=g.lB(O,"playbackData"),S={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:x,actionMetadata:H},u=$m(new lQ("playbackData",O,S)),g.D(k,m2(I.W,u,"offlineOrchestrationActionWrapperEntity"),2);case 2:vZ(I),a=dQ(I,!0),
f&&f(a),g.Bp(k)}})};
var gnw={},Duk=(gnw.TRANSFER_STATE_TRANSFERRING=1,gnw.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,gnw);g.l=n0.prototype;g.l.y0=function(){return this.B.promise};
g.l.cq=function(){if(this.W&&this.Y)return this.B.promise;gyE(this).then(this.B.resolve).catch(this.B.reject);return this.B.promise};
g.l.qd=function(f){var I={};return I.playbackData=new ley(f,this.UH,this.U),I.transfer=new g1E(f,this.UH),I.videoPlaybackPositionEntity=new o1L(f,this.UH),I};
g.l.x8=function(){var f=this;return g.Z(function(I){return f.W?g.D(I,$uk(f.W),0):I.iH(0)})};
g.l.kS=function(){var f=this,I,G;return g.Z(function(c){if(c.W==1)return f.W||f.Y?g.D(c,f.y0(),2):c.return();f.N!==void 0&&(g.Lb(f.N),f.N=void 0);f.G!==void 0&&(g.Lb(f.G),f.G=void 0);(I=f.W)==null||I.dispose();f.W=void 0;(G=f.Y)==null||G.dispose();f.Y=void 0;f.api.Xw("onOrchestrationLostLeader");f.B=new g.ag;g.Bp(c)})};
g.l.isOrchestrationLeader=function(){return this.Z.U};
g.l.lG=function(){return g.Z(function(f){return f.return(!1)})};
g.l.zy=function(f){var I=this.U;I.api.publish("offlinetransferpause",f);var G;(G=I.W)==null||G.postMessage(f)};
g.l.NI=function(f){var I,G;return g.Z(function(c){if(c.W==1)return g.D(c,b3(),2);I=c.U;if(!I)return c.return();G=g.lB(f,"transfer");return g.D(c,EZ(I,{mode:"readwrite",l1:!0},function(P){var p=dJ(P,G,"transfer"),e=dJ(P,g.lB(f,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.JF.all([p,e]).then(function(O){O=g.Y(O);var N=O.next().value;var H=O.next().value;return N&&N.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(N.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",TQ(P,N,"transfer").then(function(){Oo({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:f,MW:N,offlineModeType:H==null?void 0:H.offlineModeType});return g.JF.resolve(null)})):g.JF.resolve(null)})}),0)})};
g.l.ea=function(f){f=f===void 0?43200:f;var I=this,G,c,P,p,e,O,N,H;return g.Z(function(x){if(x.W==1)return I.J.cS()?g.D(x,b3(),2):x.return(Rek());if(x.W!=3){G=x.U;if(!G)return x.return([]);c=Date.now()/1E3;return g.D(x,QR(G,"offlineVideoPolicy"),3)}P=x.U;p=[];e=g.Y(P);for(O=e.next();!O.done;O=e.next())N=O.value,Number(N.lastUpdatedTimestampSeconds)+f<=c&&(H=g.kw(N.key).entityId,p.push(H));return p.length?x.return(so(I,p,I.T,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):x.return([])})};
g.l.deleteAll=function(){return so(this,["!*$_ALL_ENTITIES_!*$"],this.T,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.l.refreshAllStaleEntities=function(f){var I=this;return g.Z(function(G){return G.W==1?g.D(G,I.ea(f),2):G.return(G.U)})};
g.l.setUpPositionSyncInterval=function(f){var I=this;this.G!==void 0&&(g.Lb(this.G),this.G=void 0);var G=f!=null?f:864E5;this.G=g.Y0(function(){I.ll(G)},G)};
g.l.ll=function(f){var I=this,G,c,P,p,e,O;return g.Z(function(N){switch(N.W){case 1:return g.LY(N,2),g.D(N,VR.getInstance(),4);case 4:G=N.U;if(!G)throw Error("prefStorage is undefined");return g.D(N,G.get("psi"),5);case 5:c=N.U;p=((P=c)==null?0:P.kf)?Number(c.kf)/1E3:0;e=Date.now();if(!(p+f<=e)){N.iH(6);break}return g.D(N,so(I,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.KY(N,0);break;case 2:O=g.UU(N),cZ("Offline manager error",O),
g.Bp(N)}})};
g.l.LU=function(){var f=this,I,G,c,P,p,e,O;return g.Z(function(N){if(N.W==1)return g.D(N,b3(),2);if(N.W!=3)return(I=N.U)?g.D(N,QR(I,"transfer"),3):N.return([]);G=N.U;c=[];P=g.Y(G);for(p=P.next();!p.done;p=P.next())e=p.value,e.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&e.key&&(O=g.kw(e.key).entityId,c.push(O));return N.return(rhw(f,c))})};
g.l.qK=function(){return g.Z(function(f){return f.return([])})};
g.l.hM=function(){return g.Z(function(f){g.Bp(f)})};
g.l.HL=function(){return g.Z(function(f){g.Bp(f)})};g.w(vyw,hV);vyw.prototype.W=function(f){return HZ(f)?AhL(this,f):xm(f)?nyJ(this,f):iQ(f)?sx$(this,f):Promise.reject(Error("Unsupported action type: "+f.actionType))};
var Xy=[10];g.w(Qxw,hV);Qxw.prototype.W=function(f){return HZ(f)?Iuu(this,f):xm(f)?GMU(this,f):iQ(f)?cn7(this,f):Promise.reject(Error("Unsupported action type: "+f.actionType))};
var fu7=[10];g.w(pEu,hV);pEu.prototype.W=function(f){return xm(f)?tIU(this,f):Promise.reject(Error("Unsupported action type: "+f.actionType))};g.w(OOU,n0);g.l=OOU.prototype;g.l.qd=function(f){var I=n0.prototype.qd.call(this,f);I.mainVideoEntity=new Qxw(f,this.UH,this.U);I.mainPlaylistEntity=new vyw(f,this.UH,this.U);I.mainDownloadsListEntity=new pEu(f,this.UH,this.U);return I};
g.l.refreshAllStaleEntities=function(f,I){var G=this,c,P,p,e,O,N,H,x,S,u,a;return g.Z(function(k){switch(k.W){case 1:c=[];if(!G.UH.j("web_player_offline_playlist_auto_refresh")){k.iH(2);break}return g.D(k,NCU(G,f,I),3);case 3:c=k.U;case 2:return g.D(k,VR.getInstance(),4);case 4:return P=k.U,g.D(k,(p=P)==null?void 0:p.get("sdois"),5);case 5:return e=k.U,g.D(k,(O=P)==null?void 0:O.get("lmqf"),6);case 6:N=k.U;if(!e){k.iH(7);break}x=c;S=x.concat;return g.D(k,HO$(G,e,(H=N)!=null?H:"SD",f===0),8);case 8:c=
S.call(x,k.U);case 7:return u=c,a=u.concat,g.D(k,n0.prototype.refreshAllStaleEntities.call(G,f,I),9);case 9:return c=a.call(u,k.U),k.return(c)}})};
g.l.lG=function(f){var I,G,c,P,p,e,O,N;return g.Z(function(H){if(H.W==1)return g.D(H,b3(),2);if(H.W!=3)return(I=H.U)?g.D(H,C2(I,g.g9,"mainDownloadsListEntity"),3):H.return(!1);G=H.U;if((c=G)==null?0:(P=c.downloads)==null?0:P.length)for(p=g.lB(f,"mainVideoEntity"),e=g.Y(G.downloads),O=e.next();!O.done;O=e.next())if(N=O.value,N.videoItem===p)return H.return(!0);return H.return(!1)})};
g.l.qK=function(){var f=this,I,G,c,P,p,e,O,N;return g.Z(function(H){if(H.W==1)return g.D(H,b3(),2);if(H.W!=3)return(I=H.U)?g.D(H,QR(I,"downloadStatusEntity"),3):H.return([]);G=H.U;c=[];P=g.Y(G);for(p=P.next();!p.done;p=P.next())e=p.value,e.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&e.key&&(O=g.kw(e.key).entityId,c.push(O));return c.length?(N={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},H.return(so(f,c,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
N))):H.return([])})};
g.l.HL=function(){var f;return g.Z(function(I){return I.W==1?g.D(I,b3(),2):(f=I.U)?g.D(I,EZ(f,{mode:"readwrite",l1:!0},function(G){return yR(G,"mainVideoEntity").then(function(c){var P=[];c=g.Y(c);for(var p=c.next();!p.done;p=c.next()){p=p.value;var e=void 0;(e=p.userState)!=null&&e.playbackPosition||(e=g.kw(p.key).entityId,e={key:g.lB(e,"videoPlaybackPositionEntity"),videoId:e,lastPlaybackPositionSeconds:"0"},P.push(TQ(G,e,"videoPlaybackPositionEntity")),p.userState={playbackPosition:e.key},P.push(TQ(G,
p,"mainVideoEntity")))}return g.JF.all(P)})}),0):I.return()})};
g.l.hM=function(){var f,I,G,c,P,p,e,O,N,H,x,S,u,a,k,B,L,K,q,h,F,v,E,n,GT,Pp,fY,eM,C,kd,qv,FB,Y7,OJ,JT,jM,Pw,W;return g.Z(function(OU){if(OU.W==1)return g.D(OU,b3(),2);if(OU.W!=3){f=OU.U;if(!f)return OU.return();I=g.lB("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.D(OU,EZ(f,{mode:"readonly",l1:!0},function(nU){return g.JF.all([dJ(nU,I,"mainDownloadsListEntity"),dJ(nU,g.g9,"mainDownloadsListEntity"),yR(nU,"mainVideoEntity"),yR(nU,"mainPlaylistEntity")])}),3)}G=OU.U;
c=g.Y(G);P=c.next().value;p=c.next().value;e=c.next().value;O=c.next().value;N=P;H=p;x=e;S=O;u=new Set;if((a=N)==null?0:(k=a.downloads)==null?0:k.length)for(B=g.Y(N.downloads),L=B.next();!L.done;L=B.next())K=L.value,q=void 0,(h=(q=K.videoItem)!=null?q:K.playlistItem)&&u.add(h);if((F=H)==null?0:(v=F.downloads)==null?0:v.length)for(E=g.Y(H.downloads),n=E.next();!n.done;n=E.next())GT=n.value,GT.videoItem&&u.add(GT.videoItem);Pp=new Set;fY=[];eM=g.Y(S);for(C=eM.next();!C.done;C=eM.next()){kd=C.value;
if(kd.videos)for(qv=g.Y(kd.videos),FB=qv.next();!FB.done;FB=qv.next())Y7=FB.value,(OJ=JSON.parse(g.kw(Y7).entityId).videoId)&&Pp.add(OJ);kd.key&&!u.has(kd.key)&&fY.push(kd.key)}JT=g.Y(x);for(jM=JT.next();!jM.done;jM=JT.next())Pw=jM.value,Pw.key&&!u.has(Pw.key)&&(W=g.kw(Pw.key).entityId,Pp.has(W)||fY.push(Pw.key));return fY.length?g.D(OU,TlL(f,fY),0):OU.iH(0)})};g.w(xWr,hV);xWr.prototype.W=function(f){return HZ(f)?ScU(this,f):xm(f)?uNV(this,f):iQ(f)?au2(this,f):Promise.reject(Error("Unsupported action type: "+f.actionType))};
var mj=[10];g.w(luE,hV);luE.prototype.W=function(f){return HZ(f)?$WE(this,f):xm(f)?YcE(this,f):iQ(f)?BCE(this,f):Promise.reject(Error("Unsupported action type: "+f.actionType))};
var C0=[10];g.w(on$,hV);on$.prototype.W=function(f){return HZ(f)?Jny(this,f):xm(f)?UWk(this,f):iQ(f)?zKV(this,f):Promise.reject(Error("Unsupported action type: "+f.actionType))};
var KAr=[10];g.w(QH,n0);QH.prototype.qd=function(f){var I=n0.prototype.qd.call(this,f);I.musicTrack=new on$(f,this.U);I.musicPlaylist=new luE(f,this.U);I.musicAlbumRelease=new xWr(f,this.U);return I};
QH.prototype.refreshAllStaleEntities=function(f,I){var G=this,c,P,p;return g.Z(function(e){if(e.W==1)return g.D(e,MIZ(G,f,I),2);if(e.W!=3)return P=c=e.U,p=P.concat,g.D(e,n0.prototype.refreshAllStaleEntities.call(G,f,I),3);c=p.call(P,e.U);return e.return(c)})};g.w(DWV,g.w0);g.l=DWV.prototype;g.l.create=function(){var f=this;g.r(this,this.events);if(g.cb(this.UH))this.U=new OOU(this.UH,this.player);else if(g.nm(this.UH)||g.eU(this.UH)==="WEB_MUSIC_INTEGRATIONS")this.U=new QH(this.UH,this.player);this.events.C(this.player,"onPlaybackStartExternal",function(){f.bZ()});
this.events.C(this.player,"videodatachange",function(){f.bZ()});
this.UH.j("html5_offline_playback_position_sync")&&this.events.C(this.player,"presentingplayerstatechange",this.J7)};
g.l.g4=function(){return!1};
g.l.Su=function(f,I,G,c){var P=this;return g.Z(function(p){return P.U?p.return(so(P.U,f,I,G,c)):p.return(Promise.reject())})};
g.l.deleteAll=function(){return this.U.deleteAll()};
g.l.ea=function(f){return this.U.ea(f)};
g.l.refreshAllStaleEntities=function(f){return this.U.refreshAllStaleEntities(f)};
g.l.setUpPositionSyncInterval=function(f){this.U.setUpPositionSyncInterval(f)};
g.l.zy=function(f){this.U.zy(f)};
g.l.NI=function(f){return this.U.NI(f)};
g.l.bZ=function(){var f=this,I;return g.Z(function(G){I=f.player.getVideoData();return g.Cw(I)?FAJ(I)&&f.W!==I.clientPlaybackNonce?g.D(G,ZOE(f,I),0):G.iH(0):G.return()})};
g.l.J7=function(f){var I=this,G,c,P,p,e,O,N;return g.Z(function(H){if(H.W==1)return G=I.player.getVideoData(),c=G.A9,g.WC(f,2)||g.WC(f,512)?g.D(H,b3(),2):H.return();if(H.W!=3){P=H.U;if(!P)return cZ("PES is undefined"),H.return();p=G.videoId;return g.D(H,C2(P,g.lB(p,"mainVideoEntity"),"mainVideoEntity"),3)}e=H.U;if(!e)return H.return();O=Math.floor(c).toString();N={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:O}};return g.D(H,I.Su([p],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
N),0)})};
g.l.isOrchestrationLeader=function(){return this.U.isOrchestrationLeader()};
g.l.updateDownloadState=function(f,I){var G,c,P,p;return g.Z(function(e){if(e.W==1)return g.D(e,b3(),2);G=e.U;if(!G)return cZ("PES is undefined"),e.return();c=g.kw(f);P=c.entityType;p=c.entityId;return g.D(e,Sp(p,P,G,I,!0),0)})};g.ly("offline",DWV);})(_yt_player);
